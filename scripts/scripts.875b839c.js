!function(){"use strict";angular.module("pattyApp.three",[]).constant("THREE",THREE),angular.module("pattyApp.potree",[]).constant("Potree",Potree).constant("POCLoader",POCLoader),angular.module("pattyApp",["ngAnimate","ngSanitize","ngTouch","ui.bootstrap","pattyApp.logos","pattyApp.searchbox","pattyApp.minimap","pattyApp.measuring","pattyApp.settings","pattyApp.help","pattyApp.cameramodes","pattyApp.pointcloud","pattyApp.extract"]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/)}]).run(["DrivemapService",function(a){a.load()}]),angular.module("pattyApp.templates",[]),angular.module("pattyApp.logos",[]),angular.module("pattyApp.extract",["pattyApp.core","angular-loading-bar","rt.debounce"]),angular.module("pattyApp.utils",["pattyApp.templates","toastr"]),angular.module("pattyApp.core",["pattyApp.utils"]),angular.module("pattyApp.minimap",["pattyApp.core"]),angular.module("pattyApp.measuring",["pattyApp.potree","pattyApp.three"]),angular.module("pattyApp.pointcloud",["pattyApp.core","pattyApp.potree","pattyApp.three","pattyApp.measuring","cfp.loadingBar"]),angular.module("pattyApp.settings",["pattyApp.pointcloud","ngFileUpload"]),angular.module("pattyApp.help",["pattyApp.templates"]),angular.module("pattyApp.cameramodes",["pattyApp.pointcloud"]),angular.module("pattyApp.searchbox",["pattyApp.core","pattyApp.pointcloud"])}(),Potree.Measure=function(){var a=this;THREE.Object3D.call(this),this.points=[],this._showDistances=!0,this._showArea=!0,this._closed=!0,this.maxMarkers=Number.MAX_SAFE_INTEGER,this.spheres=[],this.edges=[],this.sphereLabels=[],this.edgeLabels=[],this.angleLabels=[],this.areaLabel=new Potree.TextSprite(""),this.areaLabel.setBorderColor({r:0,g:255,b:0,a:0}),this.areaLabel.setBackgroundColor({r:0,g:255,b:0,a:0}),this.areaLabel.setTextColor({r:180,g:220,b:180,a:1}),this.areaLabel.material.depthTest=!1,this.areaLabel.material.opacity=1,this.add(this.areaLabel);var b=new THREE.SphereGeometry(.4,10,10);this.color=new THREE.Color(16711680);var c=function(){var b=new THREE.MeshLambertMaterial({shading:THREE.SmoothShading,color:a.color,ambient:11184810,depthTest:!1,depthWrite:!1});return b},d=function(a){a.target.material.emissive.setHex(8947848)},e=function(a){a.target.material.emissive.setHex(0)},f=function(b){var c=b.tool,d=(c.dragstart,c.mouse,c.getMousePointCloudIntersection());if(d){var e=a.spheres.indexOf(c.dragstart.object);a.setPosition(e,d)}},g=function(){};this.addMarker=function(a){this.points.push(a);var h=new THREE.Mesh(b,c());h.addEventListener("move",d),h.addEventListener("leave",e),h.addEventListener("drag",f),h.addEventListener("drop",g),this.add(h),this.spheres.push(h);var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3,new THREE.Vector3),i.colors.push(this.color,this.color,this.color);var j=new THREE.LineBasicMaterial({linewidth:1});j.depthTest=!1;var k=new THREE.Line(i,j);k.visible=!0,this.add(k),this.edges.push(k);var l=new Potree.TextSprite(0);l.setBorderColor({r:0,g:255,b:0,a:0}),l.setBackgroundColor({r:0,g:255,b:0,a:0}),l.material.depthTest=!1,l.visible=!1,this.edgeLabels.push(l),this.add(l);var m=new Potree.TextSprite;m.setBorderColor({r:0,g:255,b:0,a:0}),m.setBackgroundColor({r:0,g:255,b:0,a:0}),m.material.depthTest=!1,m.material.opacity=1,m.visible=!1,this.angleLabels.push(m),this.add(m);var n={type:"marker_added",measurement:this};this.dispatchEvent(n),this.setPosition(this.points.length-1,a)},this.removeMarker=function(a){this.points.splice(a,1),this.remove(this.spheres[a]);var b=0==a?0:a-1;this.remove(this.edges[b]),this.edges.splice(b,1),this.remove(this.edgeLabels[b]),this.edgeLabels.splice(b,1),this.spheres.splice(a,1),this.update()},this.setPosition=function(a,b){var c=this.points[a];c.copy(b);var d={type:"marker_moved",measure:this,index:a,position:b.clone()};this.dispatchEvent(d),this.update()},this.getArea=function(){for(var a=0,b=this.points.length-1,c=0;c<this.points.length;c++){var d=this.points[c],e=this.points[b];a+=(e.x+d.x)*(d.z-e.z),b=c}return Math.abs(a/2)},this.getAngleBetweenLines=function(a,b,c){var d=(new THREE.Vector3).subVectors(b,a),e=(new THREE.Vector3).subVectors(c,a);return d.angleTo(e)},this.update=function(){if(0!==this.points.length){if(1===this.points.length){var b=this.points[0];return void this.spheres[0].position.copy(b)}for(var c=this.points.length-1,d=new THREE.Vector3,e=0;c>=e;e++){var b=this.points[e];d.add(b)}d.divideScalar(this.points.length);for(var e=0;c>=e;e++){var f=e,g=e+1>c?0:e+1,h=0===e?c:e-1,b=this.points[f],i=this.points[g],j=this.points[h],k=this.spheres[f];k.position.copy(b),k.material.color=a.color;var l=this.edges[f];l.material.color=this.color,l.geometry.vertices[0].copy(b),l.geometry.vertices[1].copy(i),l.geometry.verticesNeedUpdate=!0,l.geometry.computeBoundingSphere(),l.visible=c>f||this.closed;var m=this.edgeLabels[e],n=(new THREE.Vector3).add(b);n.add(i),n=n.multiplyScalar(.5);var o=b.distanceTo(i);m.position.copy(n),m.setText(o.toFixed(2)),m.visible=this.showDistances&&(c>f||this.closed)&&this.points.length>=2&&o>0;var p=this.angleLabels[e],q=this.getAngleBetweenLines(b,j,i),r=i.clone().sub(j);r.multiplyScalar(.5),r=j.clone().add(r).sub(b).normalize();var s=Math.min(b.distanceTo(j),b.distanceTo(i));s/=9;var t=b.clone().add(r.multiplyScalar(s));p.position.copy(t);var u=Potree.utils.addCommas((q*(180/Math.PI)).toFixed(1))+"°";p.setText(u),p.visible=this.showAngles&&(c>f||this.closed)&&this.points.length>=3&&q>0}this.areaLabel.position.copy(d),this.areaLabel.visible=this.showArea&&this.points.length>=3;var u=Potree.utils.addCommas(this.getArea().toFixed(1))+"²";this.areaLabel.setText(u)}},this.raycast=function(a,b){for(var c=0;c<this.points.length;c++){var d=this.spheres[c];d.raycast(a,b)}for(var c=0;c<b.length;c++){var e=b[c];e.distance=a.ray.origin.distanceTo(e.point)}b.sort(function(a,b){return a.distance-b.distance})}},Potree.Measure.prototype=Object.create(THREE.Object3D.prototype),Object.defineProperty(Potree.Measure.prototype,"showArea",{get:function(){return this._showArea},set:function(a){this._showArea=a,this.update()}}),Object.defineProperty(Potree.Measure.prototype,"closed",{get:function(){return this._closed},set:function(a){this._closed=a,this.update()}}),Object.defineProperty(Potree.Measure.prototype,"showDistances",{get:function(){return this._showDistances},set:function(a){this._showDistances=a,this.update()}}),Potree.MeasuringTool=function(a,b,c){function d(a){if(m===l.INSERT){var b=k.getMousePointCloudIntersection();if(b){var c=b.clone();k.activeMeasurement.addMarker(c);var a={type:"newpoint",position:c.clone()};k.dispatchEvent(a),k.activeMeasurement.points.length>k.activeMeasurement.maxMarkers&&k.finishInsertion()}}else if(m===l.EXTERNAL_REQUEST){var d=k.getMousePointCloudIntersection();k.externalRequestCallback?(k.externalRequestCallback(d),m=l.DEFAULT,k.externalRequestCallback=null):console.log("ERR: Measuring tool has No callback registered.")}}function e(a){var b=k.domElement.getBoundingClientRect();if(k.mouse.x=(a.clientX-b.left)/k.domElement.clientWidth*2-1,k.mouse.y=2*-((a.clientY-b.top)/k.domElement.clientHeight)+1,k.dragstart){var c={type:"drag",event:a,tool:k};k.dragstart.object.dispatchEvent(c)}else if(m===l.INSERT&&k.activeMeasurement){var d=k.getMousePointCloudIntersection();if(d){var e=k.activeMeasurement.points.length-1;k.activeMeasurement.setPosition(e,d)}}else if(m===l.DEFAULT||m===l.INSERT&&!k.activeMeasurement){var d=j();d?(d.object.dispatchEvent({type:"move",target:d.object,event:a}),k.hoveredElement&&k.hoveredElement!==d.object&&k.hoveredElement.dispatchEvent({type:"leave",target:k.hoveredElement,event:a}),k.hoveredElement=d.object):(k.hoveredElement&&k.hoveredElement.dispatchEvent({type:"leave",target:k.hoveredElement,event:a}),k.hoveredElement=null)}}function f(){m===l.INSERT&&k.finishInsertion()}function g(a){if(1===a.which){m!==l.DEFAULT&&a.stopImmediatePropagation();var b=j();b&&(k.dragstart={object:b.object,sceneClickPos:b.point,sceneStartPos:k.sceneRoot.position.clone(),mousePos:{x:k.mouse.x,y:k.mouse.y}},a.stopImmediatePropagation())}else 3===a.which&&f(a)}function h(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),k.activeMeasurement&&m===l.INSERT&&(k.activeMeasurement.removeMarker(k.activeMeasurement.points.length-1),k.finishInsertion())}function i(a){k.dragstart&&(k.dragstart.object.dispatchEvent({type:"drop",event:a}),k.dragstart=null)}function j(){var a=new THREE.Vector3(k.mouse.x,k.mouse.y,.5);a.unproject(k.camera);var b=new THREE.Raycaster;b.ray.set(k.camera.position,a.sub(k.camera.position).normalize());for(var c=[],d=0;d<k.measurements.length;d++)for(var e=k.measurements[d],f=0;f<e.spheres.length;f++)c.push(e.spheres[f]);var g=b.intersectObjects(c,!0);return g.length>0?g[0]:!1}var k=this;this.enabled=!1,this.scene=a,this.camera=b,this.renderer=c,this.domElement=c.domElement,this.mouse={x:0,y:0};var l={DEFAULT:0,INSERT:1,EXTERNAL_REQUEST:2},m=l.DEFAULT;this.activeMeasurement,this.measurements=[],this.sceneMeasurement=new THREE.Scene,this.sceneRoot=new THREE.Object3D,this.sceneMeasurement.add(this.sceneRoot),this.light=new THREE.DirectionalLight(16777215,1),this.light.position.set(0,0,10),this.light.lookAt(new THREE.Vector3(0,0,0)),this.sceneMeasurement.add(this.light),this.hoveredElement=null,this.externalRequestCallback=null,this.requestClickLocation=function(a){null===this.externalRequestCallback?(this.externalRequestCallback=a,m=l.EXTERNAL_REQUEST):console.log("WARN: Measuring tool already has an outstanding request. New request ignored.")},this.getState=function(){return m},this.getMousePointCloudIntersection=function(){var a=new THREE.Vector3(k.mouse.x,k.mouse.y,.5);a.unproject(k.camera);var b=a.sub(k.camera.position).normalize(),c=new THREE.Ray(k.camera.position,b),d=[];k.scene.traverse(function(a){(a instanceof Potree.PointCloudOctree||a instanceof Potree.PointCloudArena4D)&&d.push(a)});for(var e=null,f=null,g=0;g<d.length;g++){var h=d[g],i=h.pick(k.renderer,k.camera,c);if(i){var j=k.camera.position.distanceTo(i.position);(!e||f>j)&&(e=i,f=j)}}return e?e.position:null},this.startInsertion=function(a){if(m===l.DEFAULT){m=l.INSERT;var a=a||{},b="undefined"!=typeof a.showDistances?a.showDistances:!0,c="undefined"!=typeof a.showArea?a.showArea:!1,d="undefined"!=typeof a.showAngles?a.showAngles:!1,e="undefined"!=typeof a.closed?a.closed:!1,f=a.maxMarkers||Number.MAX_SAFE_INTEGER,g=new Potree.Measure;g.showDistances=b,g.showArea=c,g.showAngles=d,g.closed=e,g.maxMarkers=f,this.addMeasurement(g),g.addMarker(new THREE.Vector3(0,0,0)),this.activeMeasurement=g}},this.finishInsertion=function(){this.activeMeasurement.removeMarker(this.activeMeasurement.points.length-1);var a={type:"insertion_finished",measurement:this.activeMeasurement};this.dispatchEvent(a),this.activeMeasurement=null,m=l.DEFAULT},this.addMeasurement=function(a){this.sceneMeasurement.add(a),this.measurements.push(a),this.dispatchEvent({type:"measurement_added",measurement:a}),a.addEventListener("marker_added",function(a){k.dispatchEvent(a)}),a.addEventListener("marker_removed",function(a){k.dispatchEvent(a)}),a.addEventListener("marker_moved",function(a){k.dispatchEvent(a)})},this.removeMeasurement=function(a){this.sceneMeasurement.remove(a);var b=this.measurements.indexOf(a);b>=0&&this.measurements.splice(b,1)},this.reset=function(){for(var a=this.measurements.length-1;a>=0;a--){var b=this.measurements[a];this.removeMeasurement(b)}},this.update=function(){for(var a=[],b=0;b<this.measurements.length;b++)a.push(this.measurements[b]);this.activeMeasurement&&a.push(this.activeMeasurement);for(var b=0;b<a.length;b++){for(var d=a[b],e=0;e<d.spheres.length;e++){var f=d.spheres[e],g=k.camera.position.distanceTo(f.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=15/h;f.scale.set(i,i,i)}for(var e=0;e<d.edgeLabels.length;e++){var j=d.edgeLabels[e],g=k.camera.position.distanceTo(j.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=70/h;j.scaleFactor=i/100}for(var e=0;e<d.edgeLabels.length;e++){var j=d.angleLabels[e],g=k.camera.position.distanceTo(j.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=70/h;j.scaleFactor=i/100}var g=k.camera.position.distanceTo(d.areaLabel.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=80/h;d.areaLabel.scaleFactor=i/100}this.light.position.copy(this.camera.position),this.light.lookAt(this.camera.getWorldDirection().add(this.camera.position))},this.render=function(){this.update(),c.render(this.sceneMeasurement,this.camera)},this.domElement.addEventListener("click",d,!1),this.domElement.addEventListener("dblclick",h,!1),this.domElement.addEventListener("mousemove",e,!1),this.domElement.addEventListener("mousedown",g,!1),this.domElement.addEventListener("mouseup",i,!0)},Potree.MeasuringTool.prototype=Object.create(THREE.EventDispatcher.prototype),Potree.TextSprite=function(a){THREE.Object3D.call(this);var b=new THREE.Texture;b.minFilter=THREE.LinearFilter,b.magFilter=THREE.LinearFilter;var c=new THREE.SpriteMaterial({map:b,useScreenCoordinates:!1});this.material=c,this.sprite=new THREE.Sprite(c),this.add(this.sprite),this.borderThickness=4,this.fontface="Arial",this.fontsize=28,this.borderColor={r:0,g:0,b:0,a:1},this.backgroundColor={r:255,g:255,b:255,a:1},this.textColor={r:255,g:255,b:255,a:1},this.text="",this.scaleFactor=1,this.setText(a)},Potree.TextSprite.prototype=new THREE.Object3D,Potree.TextSprite.prototype.setText=function(a){this.text=a,this.update()},Potree.TextSprite.prototype.setTextColor=function(a){this.textColor=a,this.update()},Potree.TextSprite.prototype.setBorderColor=function(a){this.borderColor=a,this.update()},Potree.TextSprite.prototype.setBackgroundColor=function(a){this.backgroundColor=a,this.update()},Potree.TextSprite.prototype.update=function(){var a=document.createElement("canvas"),b=a.getContext("2d");b.font="Bold "+this.fontsize+"px "+this.fontface;var c=b.measureText(this.text),d=c.width,e=d+2*this.borderThickness,f=1.4*this.fontsize+2*this.borderThickness,a=document.createElement("canvas"),b=a.getContext("2d");b.canvas.width=e,b.canvas.height=f,b.font="Bold "+this.fontsize+"px "+this.fontface,b.fillStyle="rgba("+this.backgroundColor.r+","+this.backgroundColor.g+","+this.backgroundColor.b+","+this.backgroundColor.a+")",b.strokeStyle="rgba("+this.borderColor.r+","+this.borderColor.g+","+this.borderColor.b+","+this.borderColor.a+")",b.lineWidth=this.borderThickness,this.roundRect(b,this.borderThickness/2,this.borderThickness/2,d+this.borderThickness,1.4*this.fontsize+this.borderThickness,6),b.strokeStyle="rgba(0, 0, 0, 1.0)",b.strokeText(this.text,this.borderThickness,this.fontsize+this.borderThickness),b.fillStyle="rgba("+this.textColor.r+","+this.textColor.g+","+this.textColor.b+","+this.textColor.a+")",b.fillText(this.text,this.borderThickness,this.fontsize+this.borderThickness);var g=new THREE.Texture(a);g.minFilter=THREE.LinearFilter,g.magFilter=THREE.LinearFilter,g.needsUpdate=!0,this.sprite.material.map=g,this.sprite.scale.set(e*this.scaleFactor,f*this.scaleFactor,1)},Potree.TextSprite.prototype.roundRect=function(a,b,c,d,e,f){a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.closePath(),a.fill(),a.stroke()},function(){"use strict";function a(a){this.publish=function(){return a.$emit.apply(a,arguments)},this.subscribe=function(){return a.$on.apply(a,arguments)}}a.$inject=["$rootScope"],angular.module("pattyApp.utils").service("Messagebus",a)}(),function(){"use strict";function a(){return function(a,b){return b=+b,a.slice(b)}}angular.module("pattyApp.utils").filter("startFrom",a)}(),function(){"use strict";function a(a){this.bingMapsKey="Am6kAyf_AScih8y3ElNRSDpQ9xMJ8jn4yeePDKdHzhsNU4u7Jm-Ac8LJooYKmhbY",this.culture="nl",this.boundingBox={minlon:3.37,minlat:50.75,maxlon:7.21,maxlat:53.47},this.geocodeUrl=function(a){var b="http://dev.virtualearth.net/REST/v1/Locations?";return b+="jsonp=JSON_CALLBACK",b=b+"&q="+a,b=b+"&key="+this.bingMapsKey,this.culture&&(b=b+"&c="+this.culture),b},this.geocode=function(b){var c=this.geocodeUrl(b),d=this.boundingBox;return a.jsonp(c).then(function(a){var b=a.data.resourceSets[0].resources,c=b.filter(function(a){var b=a.point.coordinates[0],c=a.point.coordinates[1];return d.minlat<=b&&b<=d.maxlat&&d.minlon<=c&&c<=d.maxlon});return c})}}a.$inject=["$http"],angular.module("pattyApp.utils").service("BingGeoCoderService",a)}(),function(){"use strict";angular.module("pattyApp.core").constant("proj4",proj4).constant("ol",ol).constant("pattyConf",{DRIVEMAP_JSON_URL:"data/drivemap.json",AHN_API_ENDPOINT:"http://localhost/ahn-pointcloud-viewer/api"})}(),function(){"use strict";function a(a,b,c,d,e){var f=this;this.data={};var g=b.defer();this.ready=g.promise,this.load=function(){return a.get(e.DRIVEMAP_JSON_URL).success(this.onLoad).error(this.onLoadFailure)},this.onLoad=function(a){f.data=a,f.registerProj4(),g.resolve(a)},this.onLoadFailure=function(){c.log("Failed to load drive map!!"),g.reject.apply(this,arguments)},this.registerProj4=function(){d.defs(this.getCrs(),this.data.features[0].properties.proj4)},this.getPointcloudUrl=function(){return this.data.features[0].properties.pointcloud},this.getCameraPath=function(){return this.data.features[0].geometry.coordinates},this.getLookPath=function(){return this.data.features[0].properties.lookatpath},this.getCrs=function(){return this.data.crs.properties.name}}a.$inject=["$http","$q","$log","proj4","pattyConf"],angular.module("pattyApp.core").service("DrivemapService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/logos/logos.directive.html"}}angular.module("pattyApp.logos").directive("logoBoxDirective",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/searchbox/searchbox.directive.html",controller:"SearchPanelController",controllerAs:"sp"}}angular.module("pattyApp.searchbox").directive("pattySearchPanel",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){this.query="",this.hasGeoLocation="geolocation"in e.navigator,this.clear=function(){this.query=""},this.onLocationResponse=function(a){if(0===a.length)return void f.warning("No results","Location not found");var b=a[0];this.query=b.name.replace(", Nederland","");var c=b.point.coordinates;this.gotoLocation(c[1],c[0])},this.search=function(){a.geocode(this.query).then(this.onLocationResponse.bind(this),function(){f.error("Search failed","for some reason")})},this.onQueryKeyPress=function(a){var b=13;a.keyCode===b&&this.search()},this.gotoLocation=function(a,d){var e=0,f="EPSG:4326",i=[a,d],j="EPSG:28992",k=h(f,j,i),l=new g.Vector3(k[0],k[1],e),m=b.toLocal(l),n=0,o=-1e3,p=1e3,q=[k[0]+n,k[1]+o],r=b.toLocal(new g.Vector3(q[0],q[1],e+p));c.moveTo(r),c.lookat(m)},this.gotoCurrentLocation=function(){e.navigator.geolocation.getCurrentPosition(function(a){var b=a.coords;this.gotoLocation(b.longitude,b.latitude)}.bind(this),function(){f.error("Unable to get current location")})}}a.$inject=["BingGeoCoderService","SceneService","PathControls","Messagebus","$window","toastr","THREE","proj4"],angular.module("pattyApp.searchbox").controller("SearchPanelController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/settings/settings.directive.html",controller:"SettingsController",controllerAs:"sc"}}angular.module("pattyApp.settings").directive("pattySettings",a)}(),function(){"use strict";function a(a,b,c,d){this.showSettings=!1,this.settings=a.settings,this.PointcloudService=a,this.PathControls=c,this.RailService=d,this.measure=b}a.$inject=["PointcloudService","MeasuringService","PathControls","RailService"],angular.module("pattyApp.settings").controller("SettingsController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/help/help.directive.html",controller:"HelpController",controllerAs:"hc"}}angular.module("pattyApp.help").directive("pattyHelp",a)}(),function(){"use strict";function a(){this.showHelp=!1}angular.module("pattyApp.help").controller("HelpController",a)}(),function(){"use strict";function a(a,b,c){var d="urn:ogc:def:crs:EPSG::28992",e=null;c.ready.then(function(){e=c.getCrs()}),this.camFrustum=new a.geom.LineString([[0,0],[0,0]]);var f=new a.source.Vector({features:[new a.Feature(this.camFrustum)]});this.layer=new a.layer.Vector({source:f,style:new a.style.Style({stroke:new a.style.Stroke({color:"#FFFFFF",width:2})})}),this.getExtent=function(){return f.getExtent()},this.getCameraPosition=function(){return this.camFrustum.getFirstCoordinate()},this.onCameraMove=function(a){var c=b(e,d,[a.cam.x,a.cam.y]),f=b(e,d,[a.left.x,a.left.y]),g=b(e,d,[a.right.x,a.right.y]);this.camFrustum.setCoordinates([c,f,g,c])}}a.$inject=["ol","proj4","DrivemapService"],angular.module("pattyApp.minimap").service("CamFrustumService",a)}(),function(){"use strict";function a(){return{restrict:"E",link:function(a,b){a.vm.map.setTarget(b[0])},controller:"MinimapController",controllerAs:"vm"}}angular.module("pattyApp.minimap").directive("pattyMinimap",a)}(),function(){"use strict";function a(a,b,c,d,e){b.defs("EPSG:28992","+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs");for(var f=a.proj.get("EPSG:28992"),g=[-285401.92,22598.08,595401.9199999999,903401.9199999999],h=[3440.64,1720.32,860.16,430.08,215.04,107.52,53.76,26.88,13.44,6.72,3.36,1.68,.84,.42],i=new Array(14),j=0;15>j;++j)i[j]="EPSG:28992:"+j;for(var k=new Array(14),l=0;15>l;++l)k[l]=10>l?"0"+l:""+l;var m=a.proj.get("EPSG:28992");m.setExtent([646.36,308975.28,276050.82,636456.31]);var n=a.proj.transform([4.451,51.777],"EPSG:4326","EPSG:28992");this.osmLayer={};var o=new a.layer.Group({title:"Base maps",layers:[new a.layer.Tile({title:"NederlandBRT",type:"base",visible:!1,extent:g,source:new a.source.WMTS({url:"http://geodata.nationaalgeoregister.nl/tiles/service/wmts/brtachtergrondkaart",layer:"brtachtergrondkaart",matrixSet:"EPSG:28992",format:"image/png",projection:f,tileGrid:new a.tilegrid.WMTS({origin:a.extent.getTopLeft(g),resolutions:h,matrixIds:i})})}),this.osmLayer=new a.layer.Tile({title:"Luchtfotos",type:"base",visible:!0,source:new a.source.WMTS({url:"http://geodata1.nationaalgeoregister.nl/luchtfoto/wmts",layer:"luchtfoto",matrixSet:"nltilingschema",format:"image/jpeg",projection:f,tileGrid:new a.tilegrid.WMTS({origin:a.extent.getTopLeft(g),resolutions:h,matrixIds:k}),style:"default"})})]});this.map=new a.Map({maxExtent:g,layers:o,theme:null,maxResolution:860.16,numZoomLevels:12,units:"m",displayProjection:f,view:new a.View({center:n,zoom:14})}),this.setupResizeControl=function(){function b(b){var c=b||{},d=document.createElement("button");d.innerHTML='<span class="glyphicon glyphicon-resize-full"></span>';var e=this,f=!1,g=function(){f=!f,f?(e.getMap().getTarget().classList.add("big-minimap"),d.innerHTML='<span class="glyphicon glyphicon-resize-small"></span>'):(e.getMap().getTarget().classList.remove("big-minimap"),d.innerHTML='<span class="glyphicon glyphicon-resize-full"></span>'),e.getMap().updateSize()};d.addEventListener("click",g,!1),d.addEventListener("touchstart",g,!1);var h=document.createElement("div");h.className="resize-minimap ol-unselectable ol-control",h.appendChild(d),a.control.Control.call(this,{element:h,target:c.target})}a.inherits(b,a.control.Control),this.map.addControl(new b)},this.setupResizeControl();var p=new a.control.LayerSwitcher({tipLabel:"Legend"});this.map.addControl(p),this.map.addLayer(c.layer),this.centerMap=function(a){this.map.getView().setCenter(a)},this.updateFrustrumAndCenterMap=function(a,b){c.onCameraMove(b);var d=c.getCameraPosition();this.centerMap(d)},d.subscribe("cameraMoved",this.updateFrustrumAndCenterMap.bind(this)),e.init(this.map)}a.$inject=["ol","proj4","CamFrustumService","Messagebus","MinimapExtractionSelectionService"],angular.module("pattyApp.minimap").controller("MinimapController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(b){var c=new a.PerspectiveCamera(75,d.innerWidth/d.innerHeight,1,1e5);s=new a.Camera;var e=new a.Scene,f=".jpg",g=[b+"px"+f,b+"nx"+f,b+"py"+f,b+"ny"+f,b+"pz"+f,b+"nz"+f],h=a.ImageUtils.loadTextureCube(g,new a.CubeRefractionMapping),i=a.ShaderLib.cube;i.uniforms.tCube.value=h;var j=new a.ShaderMaterial({fragmentShader:i.fragmentShader,vertexShader:i.vertexShader,uniforms:i.uniforms,depthWrite:!1,side:a.BackSide}),k=new a.Mesh(new a.BoxGeometry(1e5,1e5,1e5),j);return e.add(k),{camera:c,scene:e}}function n(){var c=new a.Vector3(x.x,x.y,.5);c.unproject(r);var d=c.sub(r.position).normalize(),e=new a.Ray(r.position,d),f=[];t.traverse(function(a){a instanceof b.PointCloudOctree&&f.push(a)});for(var g=null,h=null,i=0;i<f.length;i++){var j=f[i],k=j.pick(q.renderer,r,e,{accuracy:.5});if(k){var l=r.position.distanceTo(k.position);(!g||h>l)&&(g=k,h=l)}}return g?g.position:null}function o(){if(q.settings.showStats){u?(q.stats.nrPoints=u.numVisiblePoints,q.stats.nrNodes=u.numVisibleNodes):(q.stats.nrPoints="none",q.stats.nrNodes="none");var a=n();if(a){var b=a;q.stats.sceneCoordinates.x=b.x.toFixed(2),q.stats.sceneCoordinates.y=b.y.toFixed(2),q.stats.sceneCoordinates.z=b.z.toFixed(2);var c=h.toGeo(b);q.stats.lasCoordinates.x=c.x.toFixed(2),q.stats.lasCoordinates.y=c.y.toFixed(2),q.stats.lasCoordinates.z=c.z.toFixed(2)}e.$digest()}}function p(a){x.x=a.clientX/q.renderer.domElement.clientWidth*2-1,x.y=2*-(a.clientY/q.renderer.domElement.clientHeight)+1}var q=this;this.elRenderArea=null,q.settings={pointCountTarget:2.5,pointSize:.01,opacity:1,showSkybox:!0,interpolate:!0,showStats:!1,highQuality:!1,showBoundingBox:!1,pointSizeType:b.PointSizeType.ADAPTIVE,pointSizeTypes:b.PointSizeType,pointColorType:b.PointColorType.HEIGHT,pointColorTypes:b.PointColorType,pointShapes:b.PointShape,pointShape:b.PointShape.CIRCLE,clipMode:b.ClipMode.HIGHLIGHT_INSIDE,clipModes:b.ClipMode,heightMin:0,heightMax:30},q.stats={nrPoints:0,nrNodes:0,sceneCoordinates:{x:0,y:0,z:0},lasCoordinates:{x:0,y:0,z:0,crs:"unknown"}},this.renderer=null;var r,s,t,u,v;q.pathMesh=null;var w=h.referenceFrame,x={x:0,y:0};this.orbitControls=null,this.isInOrbitMode=!1;var y=new b.PointCloudMaterial;this.initThree=function(){var b=d.innerWidth,c=d.innerHeight;t=h.getScene(),r=g.camera,q.renderer=new a.WebGLRenderer,q.renderer.setSize(b,c),q.renderer.autoClear=!1,q.renderer.domElement.addEventListener("mousemove",p,!1),j.init(q.renderer,t,r),v=m("images/skybox/"),q.renderer.context.getExtension("EXT_frag_depth"),f.ready.then(this.loadPointcloud)},this.loadPointcloud=function(){var d=f.getPointcloudUrl();q.stats.lasCoordinates.crs=f.getCrs(),c.load(d,function(c){u=new b.PointCloudOctree(c,y),u.material.pointSizeType=b.PointSizeType.ADAPTIVE,u.material.size=q.settings.pointSize,u.visiblePointsTarget=1e3*q.settings.pointCountTarget*1e3,w.add(u),w.updateMatrixWorld(!0),w.position.set(-u.position.x,-u.position.y,0),w.updateMatrixWorld(!0),w.applyMatrix((new a.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1)),w.updateMatrixWorld(!0),k.setCameraAndLookAtWaypoints(f.getCameraPath(),f.getLookPath());{var d=79692.68,e=96258.93,g=383917.51,l=422503.12,m=h.toLocal(new a.Vector3(d,l,0)),n=h.toLocal(new a.Vector3(e,g,0));n.x-m.x,n.z-m.z}console.log(m),console.log(n),i.init(q.elRenderArea),j.setPointcloud(u)})},this.disableDrivemap=function(){w.remove(u)},this.enableDrivemap=function(){w.add(u)},this.update=function(){if(u){u.material.clipMode=q.settings.clipMode,u.material.size=q.settings.pointSize,u.visiblePointsTarget=1e3*q.settings.pointCountTarget*1e3,u.material.opacity=q.settings.opacity,u.material.pointSizeType=q.settings.pointSizeType,u.material.pointColorType=q.settings.pointColorType,u.material.pointShape=q.settings.pointShape,u.material.interpolate=q.settings.interpolate,u.material.heightMin=q.settings.heightMin,u.material.heightMax=q.settings.heightMax,u.material.intensityMin=0,u.material.intensityMax=65e3,u.material.minSize=2,u.showBoundingBox=q.settings.showBoundingBox,u.update(r,q.renderer);var a=u.visibleNodes.length/u.visibleGeometry.length,b=l.status();1===a&&1>b?l.complete():1>a&&a!==b?(l.start(),l.set(a)):a===1/0&&1>b&&l.complete()}else l.start();q.isInOrbitMode?q.orbitControls.update():i.updateInput(),j.update(),g.update(),o()},this.render=function(){if(u){u.originalMaterial&&(u.material=u.originalMaterial);var a=d.innerWidth,b=d.innerHeight;q.renderer.setSize(a,b),q.settings.showSkybox&&(v.camera.rotation.copy(r.rotation),q.renderer.render(v.scene,v.camera)),q.renderer.render(t,r),j.render()}};var z,A,B,C=new a.WebGLRenderTarget(1024,1024,{minFilter:a.NearestFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.FloatType}),D=new a.WebGLRenderTarget(1024,1024,{minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.FloatType});this.renderHighQuality=function(){if(!z){z=new a.Scene;var c=document.getElementById("vs").innerHTML,e=document.getElementById("fs").innerHTML,f={depthMap:{type:"t",value:C},texture:{type:"t",value:D}},g=new a.ShaderMaterial({uniforms:f,vertexShader:c,fragmentShader:e}),h=new a.Mesh(new a.PlaneBufferGeometry(2,2,0),g);h.material.depthTest=!0,h.material.depthWrite=!0,h.material.transparent=!0,z.add(h),z.screenQuad=h}C&&(C.width!==d.innerWidth||C.height!==d.innerHeight)&&(C.dispose(),D.dispose(),C=new a.WebGLRenderTarget(1024,1024,{minFilter:a.NearestFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.FloatType}),D=new a.WebGLRenderTarget(1024,1024,{minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.FloatType}),z.screenQuad.material.uniforms.depthMap.value=C,z.screenQuad.material.uniforms.texture.value=D);var i=d.innerWidth,k=d.innerHeight,l=i/k;r.aspect=l,r.updateProjectionMatrix(),q.renderer.setSize(i,k),C.setSize(i,k),D.setSize(i,k),q.renderer.clear(),v.camera.rotation.copy(r.rotation),q.renderer.render(v.scene,v.camera),q.renderer.render(t,r),u&&(B||(u.originalMaterial=u.material,A=new b.PointCloudMaterial,B=new b.PointCloudMaterial),u.material=A,u.material.size=q.settings.pointSize,u.visiblePointsTarget=1e3*q.settings.pointCountTarget*1e3,u.material.opacity=q.settings.opacity,u.material.pointSizeType=q.settings.pointSizeType,u.material.pointColorType=b.PointColorType.DEPTH,u.material.pointShape=b.PointShape.CIRCLE,u.material.interpolate=!0,u.material.weighted=!1,u.material.minSize=2,u.material.screenWidth=i,u.material.screenHeight=k,u.update(r,q.renderer),q.renderer.clearTarget(C,!0,!0,!0),q.renderer.clearTarget(D,!0,!0,!0),q.renderer.render(t,r,C),u.material=B,u.material.size=q.settings.pointSize,u.visiblePointsTarget=1e3*q.settings.pointCountTarget*1e3,u.material.opacity=q.settings.opacity,u.material.pointSizeType=q.settings.pointSizeType,u.material.pointColorType=q.settings.pointColorType,u.material.pointShape=b.PointShape.CIRCLE,u.material.interpolate=!1,u.material.weighted=!0,u.material.minSize=2,u.material.depthMap=C,u.material.blendDepth=Math.min(u.material.spacing,20),u.update(r,q.renderer),q.renderer.render(t,r,D),q.renderer.render(z,s),q.renderer.clearDepth(),j.render())},this.loop=function(){requestAnimationFrame(q.loop),q.update(),q.settings.highQuality?q.renderHighQuality():q.render()},this.attachCanvas=function(a){q.elRenderArea=a,q.initThree();var b=q.renderer.domElement;a.appendChild(b),q.loop()}}a.$inject=["THREE","Potree","POCLoader","$window","$rootScope","DrivemapService","CameraService","SceneService","PathControls","MeasuringService","RailService","cfpLoadingBar"],angular.module("pattyApp.pointcloud").service("PointcloudService",a)}(),function(){"use strict";function a(a){var b=new a.Scene;this.referenceFrame=new a.Object3D,b.add(this.referenceFrame),this.getScene=function(){
return b},this.toLocal=function(a){var b=a.clone().applyMatrix4(this.referenceFrame.matrixWorld);return b},this.toGeo=function(b){var c,d=(new a.Matrix4).getInverse(this.referenceFrame.matrixWorld);if(b instanceof a.Vector3)c=b.clone().applyMatrix4(d);else if(b instanceof a.Box3){var e=b.min.clone().applyMatrix4(d),f=b.max.clone().applyMatrix4(d);c=new a.Box3(e,f)}return c}}a.$inject=["THREE"],angular.module("pattyApp.pointcloud").service("SceneService",a)}(),function(){"use strict";function a(a,b,c,d,e){var f=this,g=75,h=a.innerWidth,i=a.innerHeight,j=h/i,k=.1,l=6e5;this.camera=new c.PerspectiveCamera(g,j,k,l),a.addEventListener("resize",function(){f.onWindowResize()}),this.getCameraOrientation=function(){return(new c.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorld).determinant()};var m=this.getCameraOrientation();this.update=function(){var a=this.getCameraOrientation();a!==m&&this.update2DFrustum(),m=a},this.update2DFrustum=function(){var a=this.camera,b=a.aspect,f=Math.tan(c.Math.degToRad(.5*a.fov))*a.near,g=-f,h=b*g,i=b*f,j=new c.Vector3(0,0,0);h=new c.Vector3(h,0,-a.near).multiplyScalar(3e3),i=new c.Vector3(i,0,-a.near).multiplyScalar(3e3),j.applyMatrix4(a.matrixWorld),h.applyMatrix4(a.matrixWorld),i.applyMatrix4(a.matrixWorld),j=e.toGeo(j),h=e.toGeo(h),i=e.toGeo(i),d.publish("cameraMoved",{cam:j,left:h,right:i})},this.onWindowResize=function(){var b=a.innerWidth,c=a.innerHeight,d=b/c;this.camera.aspect=d,this.camera.updateProjectionMatrix()}}a.$inject=["$window","$log","THREE","Messagebus","SceneService"],angular.module("pattyApp.pointcloud").service("CameraService",a)}(),function(){"use strict";function a(a,b,c,d,e){this.waypoints=[],this.cameraCurve=new c.SplineCurve3,this.lookatCurve=new c.SplineCurve3,this.curveSegments=100,this.lookatDistance=100,this.dataUrl=null,this.addCameraLocation=function(){var d=a.camera,e=d.position.clone(),f=b.toGeo(e).toArray(),g=new c.Vector3(0,0,-1*this.lookatDistance).applyQuaternion(d.quaternion).add(d.position),h=b.toGeo(g).toArray();this.waypoints.push(f.concat(h)),this.waypointsChanged()},this.removeLast=function(){this.waypoints.pop(),this.waypointsChanged()},this.waypointsChanged=function(){this.updateSplines(),this.updateRailScene(),this.updateDataUrl()},this.updateSplines=function(){if(!(this.waypoints.length<2)){var a=this.waypoints.map(function(a){return b.toLocal(new c.Vector3(a[0],a[1],a[2]))}),d=new c.SplineCurve3(a);this.cameraCurve=new c.SplineCurve3(d.getSpacedPoints(this.curveSegments));var e=this.waypoints.map(function(a){return b.toLocal(new c.Vector3(a[3],a[4],a[5]))}),f=new c.SplineCurve3(e);this.lookatCurve=new c.SplineCurve3(f.getSpacedPoints(this.curveSegments))}},this.firstCameraPosition=function(){return this.cameraCurve.getPointAt(0)},this.firstLookatPosition=function(){return this.lookatCurve.getPointAt(0)},this.setWaypoints=function(a){this.waypoints=angular.copy(a),this.waypointsChanged()},this.setCameraAndLookAtWaypoints=function(a,b){this.waypoints=[];for(var c=0;c<a.length;c++)this.waypoints.push(a[c].concat(b[c]));this.waypointsChanged()},this.updateRailScene=function(){var a=this.scene.visible;b.getScene().remove(this.scene),this.createRailScene(),this.scene.visible=a},this.createRailScene=function(){if(this.scene=new c.Object3D,this.scene.name="rail",this.scene.visible=!1,this.waypoints.length>=2){var a=this.createTube(this.cameraCurve,"camera",65535,16711680);this.scene.add(a);var d=this.createTube(this.lookatCurve,"lookat",65535,65280);this.scene.add(d)}b.getScene().add(this.scene)},this.createTube=function(a,b,d,e){var f=new c.TubeGeometry(a,1024,.25,8,!1),g=c.SceneUtils.createMultiMaterialObject(f,[new c.MeshLambertMaterial({color:d}),new c.MeshBasicMaterial({color:d,opacity:.3,wireframe:!1,transparent:!1})]);g.name=b;var h=new c.SphereGeometry(.5,32,32),i=new c.MeshBasicMaterial({color:e});return a.points.map(function(a){var b=new c.Mesh(h,i);b.position.copy(a),g.add(b)}.bind(this)),g},this.updateDataUrl=function(){var a=JSON.stringify(this.waypoints),b=new Blob([a],{type:"application/json"});this.dataUrl&&e.URL.revokeObjectURL(this.dataUrl),this.dataUrl=e.URL.createObjectURL(b)},this.onFileUpload=function(a){this.filereader.readyState===FileReader.DONE?(this.setWaypoints(JSON.parse(a.target.result)),d.success("Upload of demo waypoints completed")):d.error("Upload of demo waypoints failed")},this.upload=function(a){if(!(a.length<1)){var b=a[0];this.filereader.readAsText(b)}},this.clear=function(){this.waypoints=[],this.waypointsChanged()},this.filereader=new FileReader,this.filereader.onloadend=this.onFileUpload.bind(this),this.filereader.onerror=function(){d.error("Upload of demo waypoints failed")},this.createRailScene(),this.updateDataUrl()}a.$inject=["CameraService","SceneService","THREE","toastr","$window"],angular.module("pattyApp.pointcloud").service("RailService",a)}(),function(){"use strict";function a(a,b){var c,d=Number.MAX_VALUE,e=0,f=0;for(c=0;c<a.points.length;c++)e=b.distanceTo(a.points[c]),d>e&&(d=e,f=c);return f}function b(b,c){var d=a(b,c),e=Number.MAX_VALUE,f=Number.MAX_VALUE,g=1;0!==d&&(e=c.distanceTo(b.points[d-1])),d<b.points.length-1&&(f=c.distanceTo(b.points[d+1])),e>f?g=d+1:(d-=1,g=d+1);var h=c.clone();h.sub(b.points[d]);var i=b.points[g].clone();i.sub(b.points[d].clone()),i.normalize();var j=h.dot(i)/h.length();return(d+j)/b.points.length*M}function c(a){return Math.min(Math.max(a,0),1)}function d(a){var b=new x.Vector3(Math.sin(B),Math.sin(-C),Math.cos(B));return b.multiplyScalar(-a)}function e(a){var b=new x.Vector3(Math.cos(-B),0,Math.sin(-B));return b.multiplyScalar(-a)}function f(){C=Math.max(Math.min(C,D),E),t.rotation.set(C,B,0,"YXZ")}function g(a){(I[87]||I[38])&&(L+=a),(I[83]||I[40])&&(L-=a),L%=M,0>L&&(L=M+L);var b=y.cameraCurve;t.position.copy(b.getPointAt(L/M))}function h(a){(I[87]||I[119]||I[38])&&w.add(d(a)),(I[83]||I[115]||I[40])&&w.sub(d(a))}function i(a){(I[90]||I[122])&&(w.y-=a),(I[81]||I[113])&&(w.y+=a)}function j(a){(I[65]||I[97]||I[37])&&w.add(a),(I[68]||I[100]||I[39])&&w.sub(a)}function k(a){h(a),i(a),j(e(a))}function l(){var a=1,c=y.lookatCurve,d=b(c,w)/c.points.length,e=y.cameraCurve,f=b(e,w)/e.points.length;return 0!==f&&0!==d&&(a=Math.max(f,d)/Math.min(f,d)),a}function m(a){I[a.keyCode]=!0;var b=32;a.keyCode===b&&a.preventDefault()}function n(a){I[a.keyCode]=!1}function o(){z=!1;var a;for(a=0;a<I.length;a++)I[a]=!1}function p(a){2===a.button&&(document.activeElement!==v&&v.focus(),a.preventDefault(),F=a.pageX,G=a.pageY,z=!0)}function q(a){2===a.button&&(a.preventDefault(),z=!1)}function r(a){z&&(B-=H*(a.pageX-F)/window.innerWidth,C-=H*(a.pageY-G)/window.innerHeight,F=a.pageX,G=a.pageY)}function s(a){a.preventDefault(),a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail),0>b?J+=2.5:J-=2.5,J>K&&(J=K),5>J&&(J=5),t.fov=J,t.updateProjectionMatrix()}var t,u,v,w,x,y,z=!1,A=1.08,B=0,C=0,D=.95*Math.PI/2,E=-.95*Math.PI/2,F=window.innerWidth/2,G=window.innerHeight/2,H=8,I=[],J=45,K=45,L=0,M=240,N=function(a,b,c){x=a,y=b,this.NORMAL_MOVEMENT_SPEED_MULTIPLIER=30,this.FAST_MOVEMENT_SPEED_MULTIPLIER=50,this.cameraEasing=10;for(var d=0;130>d;d++)I.push(!1);t=c.camera,u=new x.Clock,this.modes={ONRAILS:"onrails",FLY:"fly",DEMO:"demo",OFF:"off"},this.mode=this.modes.FLY};N.prototype.initCamera=function(a){t.position.copy(a),t.up.set(0,1,0),t.rotation.order="YXZ",w=t.position,J=t.fov,K=t.fov},N.prototype.initListeners=function(a){v=a,a.setAttribute("tabindex",1),a.addEventListener("keydown",m,!1),a.addEventListener("keyup",n,!1),a.addEventListener("mouseleave",o,!1),a.addEventListener("mouseout",o,!1),a.addEventListener("mousemove",r,!1),a.addEventListener("mousedown",p,!1),a.addEventListener("mouseup",q,!1),a.addEventListener("mousewheel",s,!1),a.addEventListener("DOMMouseScroll",s,!1)},N.prototype.disableListeners=function(a){a.removeEventListener("keydown",m,!1),a.removeEventListener("keyup",n,!1),a.removeEventListener("mouseleave",o,!1),a.removeEventListener("mouseout",o,!1),a.removeEventListener("mousemove",r,!1),a.removeEventListener("mousedown",p,!1),a.removeEventListener("mouseup",q,!1),a.removeEventListener("mousewheel",s,!1),a.removeEventListener("DOMMouseScroll",s,!1)},N.prototype.init=function(a){this.initCamera(y.firstCameraPosition()),this.lookat(y.firstLookatPosition()),t.updateProjectionMatrix(),this.initListeners(a)},N.prototype.goToPointOnRoad=function(a){var c=y.cameraCurve;L=b(c,a),w.copy(c.getPointAt(L/M))},N.prototype.lookat=function(a){t.up=new x.Vector3(0,1,0),t.lookAt(a),B=t.rotation.y,C=t.rotation.x},N.prototype.moveTo=function(a){w.copy(a)},N.prototype.updateDemoMode=function(a){L+=a,L%=M,0>L&&(L=M+L);var b=y.cameraCurve;t.position.copy(b.getPointAt(L/M)),A=(1-a/this.cameraEasing)*A+a/this.cameraEasing*l();var d=y.lookatCurve,e=L/M*(d.getLength()/b.getLength())*A,f=d.getPointAt(c(e));this.lookat(f)},N.prototype.updateInput=function(){var a=y.cameraCurve;if(a){var b=u.getDelta();b*=this.NORMAL_MOVEMENT_SPEED_MULTIPLIER,I[32]&&(b*=this.FAST_MOVEMENT_SPEED_MULTIPLIER),f(),this.mode===this.modes.DEMO?this.updateDemoMode(b):this.mode===this.modes.FLY?k(10*b):this.mode===this.modes.ONRAILS?g(b):this.mode===this.modes.OFF||console.log("error: unknown control mode in path.controls")}},N.prototype.enableFlightMode=function(){this.mode=this.modes.FLY},N.prototype.transitionFromFlightMode=function(){this.mode===this.modes.FLY&&this.goToPointOnRoad(w)},N.prototype.enableRailsMode=function(){this.transitionFromFlightMode(),this.mode=this.modes.ONRAILS},N.prototype.enableDemoMode=function(){this.transitionFromFlightMode(),this.mode=this.modes.DEMO},angular.module("pattyApp.pointcloud").service("PathControls",["THREE","RailService","CameraService",N])}(),function(){"use strict";function a(){return{restrict:"E",link:function(a,b){a.vm.attachCanvas(b[0])},controller:"PointcloudCanvasController",controllerAs:"vm"}}angular.module("pattyApp.pointcloud").directive("pattyPointcloudCanvas",a)}(),function(){"use strict";function a(a){this.attachCanvas=function(b){a.attachCanvas(b)}}a.$inject=["PointcloudService"],angular.module("pattyApp.pointcloud").controller("PointcloudCanvasController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/pointcloud/pointcloud-stats.directive.html",controller:"PointcloudStatsController",controllerAs:"pcs"}}angular.module("pattyApp.pointcloud").directive("pattyPointcloudStats",a)}(),function(){"use strict";function a(a){this.stats=a.stats,this.settings=a.settings}a.$inject=["PointcloudService"],angular.module("pattyApp.pointcloud").controller("PointcloudStatsController",a)}(),function(){"use strict";function a(a,b,c,d){this.tools={measuring:null,volume:null,heightprofile:null,clipvolume:null,transformation:null},this.transformationTools={TRANSLATE:0,ROTATE:1,SCALE:2},this.activeTransformationTool=this.transformationTools.ROTATE,this.pointcloud=null,this.sitePointcloud=null,this.profileWidth=.1,this.initialized=!1,this.onKeyDown=function(b){69===b.keyCode?(this.activeTransformationTool=this.transformationTools.SCALE,a.$digest(),this.tools.transformation.scale()):82===b.keyCode?(this.activeTransformationTool=this.transformationTools.ROTATE,a.$digest(),this.tools.transformation.rotate()):84===b.keyCode&&(this.activeTransformationTool=this.transformationTools.TRANSLATE,a.$digest(),this.tools.transformation.translate())},this.clear=function(){this.clearStandardPotreeMeasurementTool(this.tools.measuring),this.clearVolumes(),this.clearProfile()},this.clearStandardPotreeMeasurementTool=function(a){a.measurements=[],a.sceneMeasurement=new c.Scene,a.sceneRoot=new c.Object3D,a.sceneMeasurement.add(a.sceneRoot),a.light=new c.DirectionalLight(16777215,1),a.light.position.set(0,0,10),a.light.lookAt(new c.Vector3(0,0,0)),a.sceneMeasurement.add(a.light)},this.clearVolumes=function(){this.tools.volume.volumes=[],this.tools.volume.sceneVolume=new c.Scene},this.clearProfile=function(){this.tools.heightprofile.profiles=[],this.tools.heightprofile.sceneProfile=new c.Scene,this.tools.heightprofile.sceneRoot=new c.Object3D,this.tools.heightprofile.sceneProfile.add(this.tools.heightprofile.sceneRoot)},this.init=function(a,c,e){this.tools.measuring=new b.MeasuringTool(c,e,a),this.tools.volume=new b.VolumeTool(c,e,a),this.tools.heightprofile=new b.ProfileTool(c,e,a),this.tools.transformation=new b.TransformationTool(c,e,a),d.transformationTool=this.tools.transformation,d.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.initialized=!0},this.setPointcloud=function(a){this.pointcloud=a},this.setSitePointcloud=function(a){this.sitePointcloud=a},this.startDistance=function(){this.tools.measuring&&this.tools.measuring.startInsertion({showDistances:!0,showArea:!1,closed:!1})},this.startAngle=function(){this.tools.measuring&&this.tools.measuring.startInsertion({showDistances:!1,showAngles:!0,showArea:!1,closed:!0,maxMarkers:3})},this.startArea=function(){this.tools.measuring&&this.tools.measuring.startInsertion({showDistances:!0,showArea:!0,closed:!0})},this.startVolume=function(){this.tools.volume&&this.tools.volume.startInsertion()},this.startHeighProfile=function(){this.tools.heightprofile&&this.tools.heightprofile.startInsertion({width:this.profileWidth})},this.startClipVolume=function(){this.tools.volume&&this.tools.volume.startInsertion({clip:!0})},this.render=function(){this.initialized&&(this.tools.heightprofile.render(),this.tools.volume.render(),this.tools.measuring.renderer.clearDepth(),this.tools.measuring.render(),this.tools.transformation.render())},this.update=function(){if(this.initialized){this.tools.volume.update(),this.tools.transformation.update(),this.tools.heightprofile.update();for(var a=[],b=0;b<this.tools.heightprofile.profiles.length;b++)for(var d=this.tools.heightprofile.profiles[b],e=0;e<d.boxes.length;e++){var f=d.boxes[e];f.updateMatrixWorld();var g=(new c.Matrix4).getInverse(f.matrixWorld);a.push(g)}for(var h=0;h<this.tools.volume.volumes.length;h++){var i=this.tools.volume.volumes[h];if(i.clip){i.updateMatrixWorld();var j=(new c.Matrix4).getInverse(i.matrixWorld);a.push(j)}}this.pointcloud&&this.pointcloud.material.setClipBoxes(a),this.sitePointcloud&&this.sitePointcloud.material.setClipBoxes(a)}}}a.$inject=["$rootScope","Potree","THREE","$window"],angular.module("pattyApp.measuring").service("MeasuringService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/measuring/measuring.directive.html",controller:"MeasuringController",controllerAs:"measuring"}}angular.module("pattyApp.measuring").directive("measuringDirective",a)}(),function(){"use strict";function a(a){this.showToolboxTray=!1,this.showTransformationToolboxTray=!1,this.distanceActive=!1,this.angleActive=!1,this.areaActive=!1,this.volumeActive=!1,this.heightProfileActive=!1,this.clipVolumeActive=!1,this.measuringService=a,this.toggleToolbox=function(){this.resetState(),this.showToolboxTray=!this.showToolboxTray,this.measuringService.clear()},this.resetState=function(){this.distanceActive=!1,this.angleActive=!1,this.areaActive=!1,this.volumeActive=!1,this.heightProfileActive=!1,this.clipVolumeActive=!1,this.showTransformationToolboxTray=!1},this.isTransformationRotate=function(){var a=!1;return this.measuringService.activeTransformationTool===this.measuringService.transformationTools.ROTATE&&(a=!0),a},this.isTransformationTranslate=function(){var a=!1;return this.measuringService.activeTransformationTool===this.measuringService.transformationTools.TRANSLATE&&(a=!0),a},this.isTransformationScale=function(){var a=!1;return this.measuringService.activeTransformationTool===this.measuringService.transformationTools.SCALE&&(a=!0),a},this.startDistance=function(){this.resetState(),this.distanceActive=!0,this.measuringService.startDistance()},this.startAngle=function(){this.resetState(),this.angleActive=!0,this.measuringService.startAngle()},this.startArea=function(){this.resetState(),this.areaActive=!0,this.measuringService.startArea()},this.startAngle=function(){this.resetState(),this.angleActive=!0,this.measuringService.startAngle()},this.startVolume=function(){this.resetState(),this.volumeActive=!0,this.showTransformationToolboxTray=!0,this.measuringService.startVolume()},this.startHeightProfile=function(){this.resetState(),this.heightProfileActive=!0,this.measuringService.startHeightProfile()},this.startClipVolume=function(){this.resetState(),this.clipVolumeActive=!0,this.showTransformationToolboxTray=!0,this.measuringService.startClipVolume()},this.toggleRotate=function(){this.measuringService.activeTransformationTool=this.measuringService.transformationTools.ROTATE,this.resetState(),this.showTransformationToolboxTray=!0,this.measuringService.tools.transformation.rotate()},this.toggleTranslate=function(){this.measuringService.activeTransformationTool=this.measuringService.transformationTools.TRANSLATE,this.resetState(),this.showTransformationToolboxTray=!0,this.measuringService.tools.transformation.translate()},this.toggleScale=function(){this.measuringService.activeTransformationTool=this.measuringService.transformationTools.SCALE,this.resetState(),this.showTransformationToolboxTray=!0,this.measuringService.tools.transformation.scale()}}a.$inject=["MeasuringService"],angular.module("pattyApp.measuring").controller("MeasuringController",a)}(),function(){"use strict";function a(a,b){this._active=!1,this._left=93720.22,this._bottom=436899.97,this._right=94428.37,this._top=438334.32,this.sendUpdate=b(50,function(){a.publish("extractionSelectionChanged",this.toRequest())}.bind(this)),this.updateValue=function(a,b){b!==this[a]&&(this[a]=b,this.checkSwapCoordinates(),this.sendUpdate())},Object.defineProperty(this,"active",{get:function(){return this._active},set:function(b){b!==this._active&&a.publish("extractionSelectionActivationChanged",b),this._active=b}}),Object.defineProperty(this,"left",{get:function(){return this._left},set:function(a){this.updateValue("_left",a)}}),Object.defineProperty(this,"top",{get:function(){return this._top},set:function(a){this.updateValue("_top",a)}}),Object.defineProperty(this,"right",{get:function(){return this._right},set:function(a){this.updateValue("_right",a)}}),Object.defineProperty(this,"bottom",{get:function(){return this._bottom},set:function(a){this.updateValue("_bottom",a)}}),this.checkSwapCoordinates=function(){var a=-1;this._bottom>this._top&&(a=this._top,this._top=this._bottom,this._bottom=a),this._left>this._right&&(a=this._right,this._right=this._left,this._left=a)},this.setBottomLeftCoordinates=function(a){this.bottom=a.lat,this.left=a.lon},this.setTopRightCoordinates=function(a){this.top=a.lat,this.right=a.lon},this.toRequest=function(){var a={left:this._left,bottom:this._bottom,right:this._right,top:this._top};return a}}a.$inject=["Messagebus","debounce"],angular.module("pattyApp.extract").service("ExtractionSelectionService",a)}(),function(){"use strict";function a(a,b,c,d){this.source=new b.source.Vector({wrapX:!1}),this.layer=new b.layer.Vector({source:this.source,style:new b.style.Style({fill:new b.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new b.style.Stroke({color:"#0f0",width:2})}),visible:!1}),this.drawing=!1,this.geometryFunction=function(a,c){c||(c=new b.geom.Polygon(null));var d=a[0],e=a[1];return c.setCoordinates([[d,[d[0],e[1]],e,[e[0],d[1]],d]]),c},this.drawer=new b.interaction.Draw({source:this.source,type:"LineString",geometryFunction:this.geometryFunction,maxPoints:2,style:new b.style.Style({fill:new b.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new b.style.Stroke({color:"#0f0",width:3}),image:new b.style.RegularShape({stroke:new b.style.Stroke({color:"#0f0",width:2}),points:4,radius:10,radius2:0,angle:0})})}),this.onDrawStart=function(){this.source.clear(),this.drawing=!0},this.onDrawEnd=function(b){function c(a){return Math.round(100*a)/100}var d=b.feature.getGeometry().getCoordinates(),e={lon:c(d[0][3][0]),lat:c(d[0][3][1])},f={lon:c(d[0][1][0]),lat:c(d[0][1][1])};a.setTopRightCoordinates(e),a.setBottomLeftCoordinates(f),this.drawing=!1},this.remoteSelectionChanged=function(a,b){this.drawing||this.drawSelection(b)},this.drawSelection=function(a){var c=[[[a.left,a.top],[a.left,a.bottom],[a.right,a.bottom],[a.right,a.top],[a.left,a.top]]],d=this.source.getFeatures()[0];if(d){var e=d.getGeometry();e.setCoordinates(c)}else d=new b.Feature({geometry:new b.geom.Polygon(c)}),this.source.addFeature(d)},this.activationChanged=function(b,c){this.layer.setVisible(c),this.drawer.setActive(c),c&&this.drawSelection(a)},this.init=function(a){a.addLayer(this.layer),a.addInteraction(this.drawer)},this.drawer.setActive(!1),this.drawer.on("drawstart",this.onDrawStart.bind(this)),this.drawer.on("drawend",this.onDrawEnd.bind(this)),d.subscribe("extractionSelectionChanged",this.remoteSelectionChanged.bind(this)),d.subscribe("extractionSelectionActivationChanged",this.activationChanged.bind(this))}a.$inject=["ExtractionSelectionService","ol","proj4","Messagebus"],angular.module("pattyApp.extract").service("MinimapExtractionSelectionService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/extract/extraction.directive.html",controller:"ExtractionController",controllerAs:"ec"}}angular.module("pattyApp.extract").directive("extractionPanel",a)}(),function(){"use strict";function a(a,b,c,d){this.selection=a,this.email="",this.size={},this.count=function(){var a=this.selection.toRequest(),d=b.AHN_API_ENDPOINT,e=d+"/size";c.post(e,a).success(function(a){this.size=a}.bind(this)).error(function(){console.log(arguments)})},this.submit=function(){var a=this.selection.toRequest();a.email=this.email,a.level=this.size.level||13;var e=b.AHN_API_ENDPOINT,f=e+"/laz";c.post(f,a).success(function(b){this.size=b,d.success('Will send e-mail to "'+a.email+'" when completed',"Point extraction job submitted")}.bind(this)).error(function(){console.log(arguments),d.error("Submit failed","for some reason")}),this.showForm=!1}}a.$inject=["ExtractionSelectionService","pattyConf","$http","toastr"],angular.module("pattyApp.extract").controller("ExtractionController",a)}(),angular.module("pattyApp.templates").run(["$templateCache",function(a){"use strict";a.put("scripts/extract/extraction.directive.html",'<button ng-click="ec.selection.active=!ec.selection.active" ng-class="{active: ec.selection.active}" class="icon-big extract-icon" title="Extract points"></button>\n<div collapse=\'!ec.selection.active\' class="panel panel-default extract-panel">\n  <div class="panel-heading">Extract points\n    <button ng-click="ec.selection.active=!ec.selection.active" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  </div>\n  <div class="panel-body">\n    <form class="form-inline" role="search" name="extractForm">\n      <div class="form-group">\n        <label for="email">Email</label>\n        <input type="email" required ng-minlength="4" class="form-control" name="email" placeholder="" ng-model="ec.email" compute-selection-size>\n      </div>\n      <fieldset>\n        <div class="form-group">\n          <label for="left">Left</label>\n          <input required type="number" step=0.01 class="form-control" name="left" placeholder="" ng-model="ec.selection.left" ng-model-options="{ debounce: 1000 }">\n        </div>\n        <div class="form-group">\n          <label for="top">Top</label>\n          <input required type="number" step=0.01 class="form-control" name="top" placeholder="" ng-model="ec.selection.top" ng-model-options="{ debounce: 1000 }">\n        </div>\n        <button ng-click="ec.setBottomLeft()" type="submit" class="btn btn-default">set</button>\n      </fieldset>\n      <fieldset>\n        <div class="form-group">\n          <label for="right">Right</label>\n          <input required type="number" step=0.01 class="form-control" name="right" placeholder="" ng-model="ec.selection.right" ng-model-options="{ debounce: 1000 }">\n        </div>\n        <div class="form-group">\n          <label for="bottom">Bottom</label>\n          <input required type="number" step=0.01 class="form-control" name="bottom" placeholder="" ng-model="ec.selection.bottom" ng-model-options="{ debounce: 1000 }">\n        </div>\n        <button ng-click="ec.setTopRight()" type="submit" class="btn btn-default">set</button>\n      </fieldset>\n      <div >\n        Selected number of points:\n        <span>{{ec.size.points}}</span>\n        Level:\n        <span>{{ec.size.level}}</span>\n        Coverage (%):\n        <span>{{ec.size.coverage}}</span>\n      </div>\n      <button ng-click="ec.count()" type="submit" class="btn btn-default">Count points</button>\n      <button ng-disabled="extractForm.$invalid" ng-click="ec.submit()" type="submit" class="btn btn-primary">Submit</button>\n    </form>\n  </div>\n</div>\n'),a.put("scripts/help/help.directive.html",'<button class="icon-big help-icon" ng-class="{active: hc.showHelp}" ng-click="hc.showHelp=!hc.showHelp" title="Help"></button>\n<div class="panel panel-default help-panel" collapse=\'!hc.showHelp\'>\n    <div class="panel-heading">Help</div>\n    <div class="panel-body">\n        <p>\n            Pointcloud visualization of the\n            <a href="http://www.ahn.nl/">Actuele Hoogtekaart Nederland (2)</a>.\n        </p>\n        <p>\n            The viewer consists of several elements:\n        </p>\n        <ul>\n            <li>Center, point cloud visualization</li>\n            <li>Top-left,\n                <a href="#search">search location</a>\n            </li>\n            <li>Top-right,\n                <a href="#minimap">minimap</a>\n            </li>\n            <li>Bottom-left,\n                <a href="#extract">extract points</a>,\n                <a name="#settings">settings</a>\n                and help</li>\n            <li>Bottom-right, to\n                <a href="#measure">measure</a>\n            </li>\n        </ul>\n\n        <h2>Navigation</h2>\n        <div>\n            <ul>\n                <li>Right click mouse, rotates camera</li>\n                <li>a/s/d/w keys or arrow keys, to move left, backward, right or forward</li>\n                <li>q/z keys, to move up or down</li>\n                <li>Mouse scrollwheel, increases or decreases field of view</li>\n                <li>Hold spacebar, to move faster</li>\n            </ul>\n        </div>\n\n        <h2 id="extract">\n            <span class="glyphicon glyphicon-download inverted-glyphicon"></span>\n            Extract points</h2>\n        <div>\n            Download the selected points as a laz-file. The download url will be mailed when it is ready. The selection of points can done in several ways:\n            <ol>\n                <li>By clicking 2 points in the minimap</li>\n                <li>Filling in coordinates into the form</li>\n            </ol>\n            The coordinates are in\n            <a href="http://epsg.io/28992">Amersfoort/RD new</a>\n            coordinate system.\n        </div>\n\n        <h2 id="settings">\n            <div class="icon-inline gear-icon"></div>\n            Settings</h2>\n        <div>\n            Settings are grouped in tabs.\n            <h4>Point</h4>\n            Here you can configure the look and feel of points of the point cloud.\n            <h4>Measurement</h4>\n            Adjust how measurements are performed.\n            <h4>Demo</h4>\n            Pressing play will automatically move the camera along a set of predefined waypoints. The waypoints can be added, deleted, downloaded or uploaded.\n            <h4>Miscellaneous</h4>\n            For miscellaneous settings.\n        </div>\n\n        <h2 id="search">Search Location</h2>\n        <p>\n            Locate a landmark or adress by\n            <span class="glyphicon glyphicon-search inverted-glyphicon"></span>\n            (searching) for it. Or use the\n            <span class="glyphicon glyphicon-home inverted-glyphicon"></span>\n            to locate your location.\n        </p>\n\n        <h2 id="minimap">Minimap</h2>\n        <p>\n            Shows the location of camera and it\'s field of view as a white triangle. By default aerial photos are shown, change to road map using the layer switcher in the top right corner. Click\n            <span class="glyphicon glyphicon-resize-full"></span>\n            to enlarge minimap.\n        </p>\n\n        <h2 id="measure">Measurement</h2>\n        <div>\n            <div>\n                <div class="icon-inline toolbox-icon"></div>\n                Toolkit\n            </div>\n            Click to open measuring instruments\n        </div>\n        <div>\n            <div>\n                <div class="icon-inline distance-icon"></div>\n                Distance\n            </div>\n            Left Mouse: Insert Measurement Point Right Mouse: Finish insertion Drag&Drop: Move Measurement Points Distance between measurement points will be displayed on the edge.\n\n        </div>\n        <div>\n            <div>\n                <div class="icon-inline area-icon"></div>\n                Surface Area\n            </div>\n            Left Mouse: Insert Measurement Point Right Mouse: Finish insertion Drag&Drop: Move Measurement Points Distance between measurement points will be displayed on the edge and the total area on the centroid. The area is calculated on the ground plane. The height does not affect the result. Crossings should be avoided.\n        </div>\n        <div>\n            <div>\n                <div class="icon-inline volume-icon"></div>\n                Volume\n            </div>\n            Left Mouse: Insert Volume or Select Inserted Volume Switch between translation (icon), scale (icon) and rotation (icon) mode Keyboard shortcut: T, E, R Volume will be displayed on the objects centroid.\n        </div>\n        <div>\n            <div>\n                <div class="icon-inline heightprofile-icon"></div>\n                Height Profile\n            </div>\n            Left Mouse: Insert Profile Marker Right Mouse: Finish insertion Drag&amp;Drop: Move Profile Marker ctrl + Drag&amp;Drop: Drag upwards to increase or downwards to decrease the profile width Depending on the Clip Mode, points inside the profile will be highlighted or points outside the profile will be clipped.\n        </div>\n        <div>\n            <div>\n                <div class="icon-inline clipvolume-icon"></div>\n                Clip Volume\n            </div>\n            Left Mouse: Insert Volume or Select Inserted Volume Switch between translation (icon), scale (icon) and rotation (icon) mode Keyboard shortcut: T, E, R\n        </div>\n\n    </div>\n\n</div>\n'),a.put("scripts/logos/logos.directive.html",'<div class="logobox">\n  <a href="http://www.ahn.nl">\n    <img src="images/logos/ahn.png" title="Actueel Hoogtebestand Nederland" width="160"/>\n  </a>\n  <a href="http://www.esciencecenter.nl">\n    <img src="images/logos/nlesc.png" title="Netherlands eScience Center" width="200"/>\n  </a>\n  <a href="http://www.potree.org">\n    <img src="images/logos/potree.jpg" title="potree" width="50"/>\n  </a>\n  <a href="http://www.tudelft.nl">\n    <img src="images/logos/tudelft.png" title="TU Delft" width="200">\n  </a>\n</div>\n'),a.put("scripts/measuring/measuring.directive.html",'<div class="toolbox">\n  <button ng-click="measuring.toggleToolbox()" class="icon-big toolbox-icon" ng-class="{active: measuring.showToolboxTray}"></button>\n</div>\n\n<div class="toolbox-tray tool-icon" collapse=\'!measuring.showToolboxTray\'>\n  <button ng-click="measuring.toggleToolbox()" class="icon-big toolbox-tray-top-icon"></button>\n  <div class="toolbox-tools">\n    <button ng-click="measuring.startDistance()" ng-class="{active: measuring.distanceActive}" class="icon-small distance-icon" title="Start distance measurement"></button>\n    <button ng-click="measuring.startAngle()" ng-class="{active: measuring.angleActive}" class="icon-small angle-icon" title="Start angle measurement"></button>\n    <button ng-click="measuring.startArea()" ng-class="{active: measuring.areaActive}" class="icon-small area-icon" title="Start area measurement"></button>\n    <button ng-click="measuring.startVolume()" ng-class="{active: measuring.volumeActive}" class="icon-small volume-icon" title="Start volume measurement"></button>\n    <button ng-click="measuring.startHeightProfile()" ng-class="{active: measuring.heightProfileActive}" class="icon-small heightprofile-icon" title="Start heightprofile measurement"></button>\n    <button ng-click="measuring.startClipVolume()" ng-class="{active: measuring.clipVolumeActive}" class="icon-small clipvolume-icon" title="Start clip volume measurement"></button>\n  </div>\n</div>\n\n<div class="transformation-toolbox-tray" collapse=\'!measuring.showTransformationToolboxTray\'>\n  <button ng-click="measuring.toggleRotate()" ng-class="{active: measuring.isTransformationRotate()}" class="icon-tiny rotate-icon" title="Change the rotation of the selected area (\'R\' key)"></button>\n  <button ng-click="measuring.toggleTranslate()" ng-class="{active: measuring.isTransformationTranslate()}" class="icon-tiny translate-icon" title="Change the translation of the selected area (\'T\' key)"></button>\n  <button ng-click="measuring.toggleScale()" ng-class="{active: measuring.isTransformationScale()}" class="icon-tiny scale-icon" title="Change the scale of the selected area (\'E\' key)"></button>\n</div>\n'),
a.put("scripts/pointcloud/pointcloud-stats.directive.html","<div ng-show='pcs.settings.showStats'>\n<div>Visible points: {{ pcs.stats.nrPoints }}</div>\n<div>Visible nodes: {{ pcs.stats.nrNodes }}</div>\n<div>3D Scene coordinates (x/y/z): {{ pcs.stats.sceneCoordinates.x }}/{{ pcs.stats.sceneCoordinates.y }}/{{ pcs.stats.sceneCoordinates.z }}</div>\n<div>{{ pcs.stats.lasCoordinates.crs }} coordinates (x/y/z): {{ pcs.stats.lasCoordinates.x }}/{{ pcs.stats.lasCoordinates.y }}/{{ pcs.stats.lasCoordinates.z }}</div>\n</div>\n"),a.put("scripts/searchbox/searchbox.directive.html",'<div class="form-group clickable">\n    <div class="input-group">\n        <input type="search" class="form-control" placeholder="Search location..." ng-model="sp.query" ng-keypress="sp.onQueryKeyPress($event)">\n        <span class="input-group-btn">\n          <button class="btn btn-default" type="button" ng-click="sp.clear()" ng-show="sp.query" title="Clear"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>\n          <button class="btn btn-default" type="button" ng-click="sp.search()" ng-disabled="!sp.query" title="Search"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>\n          <button class="btn btn-default" type="button" ng-click="sp.gotoCurrentLocation()" ng-show="sp.hasGeoLocation" title="Current location"><span class="glyphicon glyphicon-home" aria-hidden="true"></span></button>\n        </span>\n    </div>\n</div>\n'),a.put("scripts/settings/settings.directive.html",'<button class="icon-big gear-icon" ng-class="{active: sc.showSettings}" ng-click="sc.showSettings=!sc.showSettings" title="Settings"/>\n<div class="panel panel-default settings-panel" collapse=\'!sc.showSettings\'>\n  <div class="panel-heading">\n    Settings</div>\n  <div class="panel-body">\n    <tabset>\n      <tab heading="Point">\n        <form class="form-horizontal">\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="pointCountTarget">\n              Points(m)\n            </label>\n            <div class="col-sm-8">\n              <input class="form-control" id="pointCountTarget" max="10.0" min="0.1" ng-model="sc.settings.pointCountTarget" step="0.1" type="number"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="pointSize">\n              PointSize\n            </label>\n            <div class="col-sm-8">\n              <input class="form-control" id="pointSize" max="3.0" min="0.01" ng-model="sc.settings.pointSize" step="0.01" type="number"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="pointCountTarget">\n              Opacity\n            </label>\n            <div class="col-sm-8">\n              <input class="form-control" id="pointCountTarget" max="2.0" min="0.0" ng-model="sc.settings.opacity" step="0.1" type="number"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="pointSizeType">\n              Size type\n            </label>\n            <div class="col-sm-8">\n              <select class="form-control" id="pointSizeType" ng-model="sc.settings.pointSizeType" ng-options="value as key|lowercase for (key, value) in sc.settings.pointSizeTypes | orderBy:value"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="pointColorType">\n              Color type\n            </label>\n            <div class="col-sm-8">\n              <select class="form-control" id="pointColorType" ng-model="sc.settings.pointColorType" ng-options="value as key|lowercase for (key, value) in sc.settings.pointColorTypes | orderBy:value"/>\n            </div>\n          </div>\n          <div class="form-group" ng-show="sc.settings.pointColorType != \'HEIGHT\'">\n            <label class="col-sm-4 control-label" for="heightMin">\n              Height range\n            </label>\n            <div class="col-sm-4">\n              <input class="form-control" id="pc-height-min" ng-model="sc.settings.heightMin" type="number">\n            </div>\n            <div class="col-sm-4">\n              <input class="form-control" id="pc-height-max" ng-model="sc.settings.heightMax" type="number">\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="pointShape">\n              Shape\n            </label>\n            <div class="col-sm-8">\n              <select class="form-control" id="pointShape" ng-model="sc.settings.pointShape" ng-options="value as key|lowercase for (key, value) in sc.settings.pointShapes | orderBy:value"/>\n            </div>\n          </div>\n        </form>\n      </tab>\n      <tab heading="Measurement">\n        <form class="form-horizontal">\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="clipMode">\n              Clip mode\n            </label>\n            <div class="col-sm-8">\n              <select class="form-control" id="clipMode" ng-model="sc.settings.clipMode" ng-options="value as key|lowercase for (key, value) in sc.settings.clipModes | orderBy:value"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="profileWidth">Profile width\n            </label>\n            <div class="col-sm-8">\n              <input class="form-control" id="profileWidth" max="50" min="0.1" ng-model="sc.measure.profileWidth" step="0.1" type="number"/>\n            </div>\n          </div>\n        </form>\n      </tab>\n      <tab heading="Demo">\n        <form class="form-horizontal demo">\n          <div class="form-group">\n            <label class="col-sm-3 control-label">\n              Play\n            </label>\n            <div class="col-sm-7">\n              <button ng-disabled="sc.PathControls.mode == sc.PathControls.modes.DEMO" class="btn btn-default glyphicon glyphicon-play" ng-click="sc.PathControls.enableDemoMode()" title="Play demo"/>\n              <button ng-disabled="sc.PathControls.mode != sc.PathControls.modes.DEMO" class="btn btn-default glyphicon glyphicon-stop" ng-click="sc.PathControls.enableFlightMode()" title="Stop demo"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-3 control-label" for="show-demo-path">\n              Show</label>\n            <div class="col-sm-9">\n              <input id="show-demo-path" ng-model="sc.RailService.scene.visible" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-3 control-label">\n              Edit\n            </label>\n            <div class="col-sm-9">\n              <button class="btn btn-default glyphicon glyphicon-plus" ng-click="sc.RailService.addCameraLocation()" title="Add current camera location"/>\n              <button class="btn btn-default glyphicon glyphicon-minus" ng-click="sc.RailService.removeLast()" title="Remove last location"/>\n              <button class="btn btn-default glyphicon glyphicon-trash" ng-click="sc.RailService.clear()" title="Clear"/>\n              <a class="btn btn-default" role="button" title="Download" download="demo-waypoints.json" draggable="true" data-downloadurl="demo-waypoints.json" target="_blank" ng-href="{{sc.RailService.dataUrl}}"><span class="glyphicon glyphicon-download"></span><a/>\n              <button ngf-select class="btn btn-default glyphicon glyphicon-upload" title="Upload" ngf-change="sc.RailService.upload($files, $event)"/>\n            </div>\n          </div>\n        <div class="form-group">\n          <label class="col-sm-3 control-label" for="look-at-distance">\n            Look at distance</label>\n          <div class="col-sm-9">\n            <input id="look-at-distance" ng-model="sc.RailService.lookatDistance" type="number">\n          </div>\n        </div>\n      <div class="form-group">\n        <label class="col-sm-3 control-label" for="camera-easing" title="How fast the camera rotates to the next location">\n          Camera easing</label>\n        <div class="col-sm-9">\n          <input id="camera-easing" ng-model="sc.PathControls.cameraEasing" type="number">\n        </div>\n      </div>\n        </form>\n      </tab>\n      <tab heading="Misc">\n        <form class="form-horizontal misc">\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="showSkybox">Sky box\n            </label>\n            <div class="col-sm-4">\n              <input id="showSkybox" ng-model="sc.settings.showSkybox" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="highQuality">\n              High Quality\n            </label>\n            <div class="col-sm-4">\n              <input id="highQuality" ng-model="sc.settings.highQuality" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="showStats">\n              Show statistics\n            </label>\n            <div class="col-sm-4">\n              <input id="showStats" ng-model="sc.settings.showStats" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="showBoundingBox" title="Show bounding box of pointcloud octree nodes">\n              Bounding boxes\n            </label>\n            <div class="col-sm-4">\n              <input id="showBoundingBox" ng-model="sc.settings.showBoundingBox" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="normalSpeedMultiplier">\n              Normal Movement Speed multipier\n            </label>\n            <div class="col-sm-4">\n              <input class="form-control" id="normalSpeedMultiplier" ng-model="sc.PathControls.NORMAL_MOVEMENT_SPEED_MULTIPLIER" type="number"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="fastSpeedMultiplier">\n              Fast Movement Speed multipier\n            </label>\n            <div class="col-sm-4">\n              <input class="form-control" id="fastSpeedMultiplier" ng-model="sc.PathControls.FAST_MOVEMENT_SPEED_MULTIPLIER" type="number"/>\n            </div>\n          </div>\n        </form>\n      </tab>\n    </tabs>\n  </div>\n</div>\n')}]);