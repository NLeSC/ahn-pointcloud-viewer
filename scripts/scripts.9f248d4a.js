!function(){"use strict";angular.module("pattyApp.three",[]).constant("THREE",THREE),angular.module("pattyApp.potree",[]).constant("Potree",Potree),angular.module("pattyApp",["ngAnimate","ngSanitize","ngTouch","ui.bootstrap","pattyApp.logos","pattyApp.searchbox","pattyApp.minimap","pattyApp.measuring","pattyApp.settings","pattyApp.helpModal","pattyApp.help","pattyApp.cameramodes","pattyApp.pointcloud","pattyApp.extract","pattyApp.biglegend","pattyApp.earthcontrols","pattyApp.gradients"]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/)}]).run(["DrivemapService",function(a){a.load()}]),angular.module("pattyApp.templates",[]),angular.module("pattyApp.logos",[]),angular.module("pattyApp.extract",["pattyApp.core","angular-loading-bar","rt.debounce"]),angular.module("pattyApp.utils",["pattyApp.templates","toastr"]),angular.module("pattyApp.core",["pattyApp.utils"]),angular.module("pattyApp.minimap",["pattyApp.core","pattyApp.three"]),angular.module("pattyApp.measuring",["pattyApp.potree","pattyApp.three","pattyApp.utils"]),angular.module("pattyApp.gradients",[]),angular.module("pattyApp.pointcloud",["pattyApp.core","pattyApp.potree","pattyApp.three","pattyApp.measuring","cfp.loadingBar","pattyApp.extract","pattyApp.earthcontrols","pattyApp.utils","pattyApp.gradients"]),angular.module("pattyApp.settings",["pattyApp.pointcloud","ngFileUpload"]),angular.module("pattyApp.help",["pattyApp.templates"]),angular.module("pattyApp.helpModal",[]),angular.module("pattyApp.cameramodes",["pattyApp.pointcloud"]),angular.module("pattyApp.searchbox",["pattyApp.core","pattyApp.pointcloud"]),angular.module("pattyApp.biglegend",["pattyApp.utils"]),angular.module("pattyApp.earthcontrols",["pattyApp.utils","pattyApp.three","pattyApp.pointcloud"])}(),Potree.Measure=function(){var a=this;THREE.Object3D.call(this),this.points=[],this._showDistances=!0,this._showArea=!0,this._closed=!0,this.maxMarkers=Number.MAX_SAFE_INTEGER,this.spheres=[],this.edges=[],this.sphereLabels=[],this.edgeLabels=[],this.angleLabels=[],this.areaLabel=new Potree.TextSprite(""),this.areaLabel.setBorderColor({r:0,g:255,b:0,a:0}),this.areaLabel.setBackgroundColor({r:0,g:255,b:0,a:0}),this.areaLabel.setTextColor({r:180,g:220,b:180,a:1}),this.areaLabel.material.depthTest=!1,this.areaLabel.material.opacity=1,this.add(this.areaLabel);var b=new THREE.SphereGeometry(.4,10,10);this.color=new THREE.Color(16711680);var c=function(){var b=new THREE.MeshLambertMaterial({shading:THREE.SmoothShading,color:a.color,ambient:11184810,depthTest:!1,depthWrite:!1});return b},d=function(a){a.target.material.emissive.setHex(8947848)},e=function(a){a.target.material.emissive.setHex(0)},f=function(b){var c=b.tool,d=(c.dragstart,c.mouse,c.getMousePointCloudIntersection());if(d){var e=a.spheres.indexOf(c.dragstart.object);a.setPosition(e,d)}},g=function(){};this.addMarker=function(a){this.points.push(a);var h=new THREE.Mesh(b,c());h.addEventListener("move",d),h.addEventListener("leave",e),h.addEventListener("drag",f),h.addEventListener("drop",g),this.add(h),this.spheres.push(h);var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3,new THREE.Vector3),i.colors.push(this.color,this.color,this.color);var j=new THREE.LineBasicMaterial({linewidth:1});j.depthTest=!1;var k=new THREE.Line(i,j);k.visible=!0,this.add(k),this.edges.push(k);var l=new Potree.TextSprite(0);l.setBorderColor({r:0,g:255,b:0,a:0}),l.setBackgroundColor({r:0,g:255,b:0,a:0}),l.material.depthTest=!1,l.visible=!1,this.edgeLabels.push(l),this.add(l);var m=new Potree.TextSprite;m.setBorderColor({r:0,g:255,b:0,a:0}),m.setBackgroundColor({r:0,g:255,b:0,a:0}),m.material.depthTest=!1,m.material.opacity=1,m.visible=!1,this.angleLabels.push(m),this.add(m);var n={type:"marker_added",measurement:this};this.dispatchEvent(n),this.setPosition(this.points.length-1,a)},this.removeMarker=function(a){this.points.splice(a,1),this.remove(this.spheres[a]);var b=0==a?0:a-1;this.remove(this.edges[b]),this.edges.splice(b,1),this.remove(this.edgeLabels[b]),this.edgeLabels.splice(b,1),this.spheres.splice(a,1),this.update()},this.setPosition=function(a,b){var c=this.points[a];c.copy(b);var d={type:"marker_moved",measure:this,index:a,position:b.clone()};this.dispatchEvent(d),this.update()},this.getArea=function(){for(var a=0,b=this.points.length-1,c=0;c<this.points.length;c++){var d=this.points[c],e=this.points[b];a+=(e.x+d.x)*(d.z-e.z),b=c}return Math.abs(a/2)},this.getAngleBetweenLines=function(a,b,c){var d=(new THREE.Vector3).subVectors(b,a),e=(new THREE.Vector3).subVectors(c,a);return d.angleTo(e)},this.update=function(){if(0!==this.points.length){if(1===this.points.length){var b=this.points[0];return void this.spheres[0].position.copy(b)}for(var c=this.points.length-1,d=new THREE.Vector3,e=0;c>=e;e++){var b=this.points[e];d.add(b)}d.divideScalar(this.points.length);for(var e=0;c>=e;e++){var f=e,g=e+1>c?0:e+1,h=0===e?c:e-1,b=this.points[f],i=this.points[g],j=this.points[h],k=this.spheres[f];k.position.copy(b),k.material.color=a.color;var l=this.edges[f];l.material.color=this.color,l.geometry.vertices[0].copy(b),l.geometry.vertices[1].copy(i),l.geometry.verticesNeedUpdate=!0,l.geometry.computeBoundingSphere(),l.visible=c>f||this.closed;var m=this.edgeLabels[e],n=(new THREE.Vector3).add(b);n.add(i),n=n.multiplyScalar(.5);var o=b.distanceTo(i);m.position.copy(n),m.setText(o.toFixed(2)),m.visible=this.showDistances&&(c>f||this.closed)&&this.points.length>=2&&o>0;var p=this.angleLabels[e],q=this.getAngleBetweenLines(b,j,i),r=i.clone().sub(j);r.multiplyScalar(.5),r=j.clone().add(r).sub(b).normalize();var s=Math.min(b.distanceTo(j),b.distanceTo(i));s/=9;var t=b.clone().add(r.multiplyScalar(s));p.position.copy(t);var u=Potree.utils.addCommas((q*(180/Math.PI)).toFixed(1))+"°";p.setText(u),p.visible=this.showAngles&&(c>f||this.closed)&&this.points.length>=3&&q>0}this.areaLabel.position.copy(d),this.areaLabel.visible=this.showArea&&this.points.length>=3;var u=Potree.utils.addCommas(this.getArea().toFixed(1))+"²";this.areaLabel.setText(u)}},this.raycast=function(a,b){for(var c=0;c<this.points.length;c++){var d=this.spheres[c];d.raycast(a,b)}for(var c=0;c<b.length;c++){var e=b[c];e.distance=a.ray.origin.distanceTo(e.point)}b.sort(function(a,b){return a.distance-b.distance})}},Potree.Measure.prototype=Object.create(THREE.Object3D.prototype),Object.defineProperty(Potree.Measure.prototype,"showArea",{get:function(){return this._showArea},set:function(a){this._showArea=a,this.update()}}),Object.defineProperty(Potree.Measure.prototype,"closed",{get:function(){return this._closed},set:function(a){this._closed=a,this.update()}}),Object.defineProperty(Potree.Measure.prototype,"showDistances",{get:function(){return this._showDistances},set:function(a){this._showDistances=a,this.update()}}),Potree.MeasuringTool=function(a,b,c){function d(a){if(m===l.INSERT){var b=k.getMousePointCloudIntersection();if(b){var c=b.clone();k.activeMeasurement.addMarker(c);var a={type:"newpoint",position:c.clone()};k.dispatchEvent(a),k.activeMeasurement.points.length>k.activeMeasurement.maxMarkers&&k.finishInsertion()}}else if(m===l.EXTERNAL_REQUEST){var d=k.getMousePointCloudIntersection();k.externalRequestCallback?(k.externalRequestCallback(d),m=l.DEFAULT,k.externalRequestCallback=null):console.log("ERR: Measuring tool has No callback registered.")}}function e(a){var b=k.domElement.getBoundingClientRect();if(k.mouse.x=(a.clientX-b.left)/k.domElement.clientWidth*2-1,k.mouse.y=2*-((a.clientY-b.top)/k.domElement.clientHeight)+1,k.dragstart){var c={type:"drag",event:a,tool:k};k.dragstart.object.dispatchEvent(c)}else if(m===l.INSERT&&k.activeMeasurement){var d=k.getMousePointCloudIntersection();if(d){var e=k.activeMeasurement.points.length-1;k.activeMeasurement.setPosition(e,d)}}else if(m===l.DEFAULT||m===l.INSERT&&!k.activeMeasurement){var d=j();d?(d.object.dispatchEvent({type:"move",target:d.object,event:a}),k.hoveredElement&&k.hoveredElement!==d.object&&k.hoveredElement.dispatchEvent({type:"leave",target:k.hoveredElement,event:a}),k.hoveredElement=d.object):(k.hoveredElement&&k.hoveredElement.dispatchEvent({type:"leave",target:k.hoveredElement,event:a}),k.hoveredElement=null)}}function f(){m===l.INSERT&&k.finishInsertion()}function g(a){if(1===a.which){m!==l.DEFAULT&&a.stopImmediatePropagation();var b=j();b&&(k.dragstart={object:b.object,sceneClickPos:b.point,sceneStartPos:k.sceneRoot.position.clone(),mousePos:{x:k.mouse.x,y:k.mouse.y}},a.stopImmediatePropagation())}else 3===a.which&&f(a)}function h(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),k.activeMeasurement&&m===l.INSERT&&(k.activeMeasurement.removeMarker(k.activeMeasurement.points.length-1),k.finishInsertion())}function i(a){k.dragstart&&(k.dragstart.object.dispatchEvent({type:"drop",event:a}),k.dragstart=null)}function j(){var a=new THREE.Vector3(k.mouse.x,k.mouse.y,.5);a.unproject(k.camera);var b=new THREE.Raycaster;b.ray.set(k.camera.position,a.sub(k.camera.position).normalize());for(var c=[],d=0;d<k.measurements.length;d++)for(var e=k.measurements[d],f=0;f<e.spheres.length;f++)c.push(e.spheres[f]);var g=b.intersectObjects(c,!0);return g.length>0?g[0]:!1}var k=this;this.enabled=!1,this.scene=a,this.camera=b,this.renderer=c,this.domElement=c.domElement,this.mouse={x:0,y:0};var l={DEFAULT:0,INSERT:1,EXTERNAL_REQUEST:2},m=l.DEFAULT;this.activeMeasurement,this.measurements=[],this.sceneMeasurement=new THREE.Scene,this.sceneRoot=new THREE.Object3D,this.sceneMeasurement.add(this.sceneRoot),this.light=new THREE.DirectionalLight(16777215,1),this.light.position.set(0,0,10),this.light.lookAt(new THREE.Vector3(0,0,0)),this.sceneMeasurement.add(this.light),this.hoveredElement=null,this.externalRequestCallback=null,this.requestClickLocation=function(a){null===this.externalRequestCallback?(this.externalRequestCallback=a,m=l.EXTERNAL_REQUEST):console.log("WARN: Measuring tool already has an outstanding request. New request ignored.")},this.getState=function(){return m},this.getMousePointCloudIntersection=function(){var a=new THREE.Vector3(k.mouse.x,k.mouse.y,.5);a.unproject(k.camera);var b=a.sub(k.camera.position).normalize(),c=new THREE.Ray(k.camera.position,b),d=[];k.scene.traverse(function(a){(a instanceof Potree.PointCloudOctree||a instanceof Potree.PointCloudArena4D)&&d.push(a)});for(var e=null,f=null,g=0;g<d.length;g++){var h=d[g],i=h.pick(k.renderer,k.camera,c);if(i){var j=k.camera.position.distanceTo(i.position);(!e||f>j)&&(e=i,f=j)}}return e?e.position:null},this.startInsertion=function(a){if(m===l.DEFAULT){m=l.INSERT;var a=a||{},b="undefined"!=typeof a.showDistances?a.showDistances:!0,c="undefined"!=typeof a.showArea?a.showArea:!1,d="undefined"!=typeof a.showAngles?a.showAngles:!1,e="undefined"!=typeof a.closed?a.closed:!1,f=a.maxMarkers||Number.MAX_SAFE_INTEGER,g=new Potree.Measure;g.showDistances=b,g.showArea=c,g.showAngles=d,g.closed=e,g.maxMarkers=f,this.addMeasurement(g),g.addMarker(new THREE.Vector3(0,0,0)),this.activeMeasurement=g}},this.finishInsertion=function(){this.activeMeasurement.removeMarker(this.activeMeasurement.points.length-1);var a={type:"insertion_finished",measurement:this.activeMeasurement};this.dispatchEvent(a),this.activeMeasurement=null,m=l.DEFAULT},this.addMeasurement=function(a){this.sceneMeasurement.add(a),this.measurements.push(a),this.dispatchEvent({type:"measurement_added",measurement:a}),a.addEventListener("marker_added",function(a){k.dispatchEvent(a)}),a.addEventListener("marker_removed",function(a){k.dispatchEvent(a)}),a.addEventListener("marker_moved",function(a){k.dispatchEvent(a)})},this.removeMeasurement=function(a){this.sceneMeasurement.remove(a);var b=this.measurements.indexOf(a);b>=0&&this.measurements.splice(b,1)},this.reset=function(){for(var a=this.measurements.length-1;a>=0;a--){var b=this.measurements[a];this.removeMeasurement(b)}},this.update=function(){for(var a=[],b=0;b<this.measurements.length;b++)a.push(this.measurements[b]);this.activeMeasurement&&a.push(this.activeMeasurement);for(var b=0;b<a.length;b++){for(var d=a[b],e=0;e<d.spheres.length;e++){var f=d.spheres[e],g=k.camera.position.distanceTo(f.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=15/h;f.scale.set(i,i,i)}for(var e=0;e<d.edgeLabels.length;e++){var j=d.edgeLabels[e],g=k.camera.position.distanceTo(j.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=70/h;j.scaleFactor=i/100}for(var e=0;e<d.edgeLabels.length;e++){var j=d.angleLabels[e],g=k.camera.position.distanceTo(j.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=70/h;j.scaleFactor=i/100}var g=k.camera.position.distanceTo(d.areaLabel.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=80/h;d.areaLabel.scaleFactor=i/100}this.light.position.copy(this.camera.position),this.light.lookAt(this.camera.getWorldDirection().add(this.camera.position))},this.render=function(){this.update(),c.render(this.sceneMeasurement,this.camera)},this.domElement.addEventListener("click",d,!1),this.domElement.addEventListener("dblclick",h,!1),this.domElement.addEventListener("mousemove",e,!1),this.domElement.addEventListener("mousedown",g,!1),this.domElement.addEventListener("mouseup",i,!0)},Potree.MeasuringTool.prototype=Object.create(THREE.EventDispatcher.prototype),Potree.TextSprite=function(a){THREE.Object3D.call(this);var b=new THREE.Texture;b.minFilter=THREE.LinearFilter,b.magFilter=THREE.LinearFilter;var c=new THREE.SpriteMaterial({map:b,useScreenCoordinates:!1});this.material=c,this.sprite=new THREE.Sprite(c),this.add(this.sprite),this.borderThickness=4,this.fontface="Arial",this.fontsize=28,this.borderColor={r:0,g:0,b:0,a:1},this.backgroundColor={r:255,g:255,b:255,a:1},this.textColor={r:255,g:255,b:255,a:1},this.text="",this.scaleFactor=.01,this.setText(a)},Potree.TextSprite.prototype=new THREE.Object3D,Potree.TextSprite.prototype.setText=function(a){this.text=a,this.update()},Potree.TextSprite.prototype.setTextColor=function(a){this.textColor=a,this.update()},Potree.TextSprite.prototype.setBorderColor=function(a){this.borderColor=a,this.update()},Potree.TextSprite.prototype.setBackgroundColor=function(a){this.backgroundColor=a,this.update()},Potree.TextSprite.prototype.update=function(){var a=document.createElement("canvas"),b=a.getContext("2d");b.font="Bold "+this.fontsize+"px "+this.fontface;var c=b.measureText(this.text),d=c.width,e=d+2*this.borderThickness,f=1.4*this.fontsize+2*this.borderThickness,a=document.createElement("canvas"),b=a.getContext("2d");b.canvas.width=e,b.canvas.height=f,b.font="Bold "+this.fontsize+"px "+this.fontface,b.fillStyle="rgba("+this.backgroundColor.r+","+this.backgroundColor.g+","+this.backgroundColor.b+","+this.backgroundColor.a+")",b.strokeStyle="rgba("+this.borderColor.r+","+this.borderColor.g+","+this.borderColor.b+","+this.borderColor.a+")",b.lineWidth=this.borderThickness,this.roundRect(b,this.borderThickness/2,this.borderThickness/2,d+this.borderThickness,1.4*this.fontsize+this.borderThickness,6),b.strokeStyle="rgba(0, 0, 0, 1.0)",b.strokeText(this.text,this.borderThickness,this.fontsize+this.borderThickness),b.fillStyle="rgba("+this.textColor.r+","+this.textColor.g+","+this.textColor.b+","+this.textColor.a+")",b.fillText(this.text,this.borderThickness,this.fontsize+this.borderThickness);var g=new THREE.Texture(a);g.minFilter=THREE.LinearFilter,g.magFilter=THREE.LinearFilter,g.needsUpdate=!0,this.sprite.material.map=g,this.sprite.scale.set(e*this.scaleFactor,f*this.scaleFactor,1)},Potree.TextSprite.prototype.roundRect=function(a,b,c,d,e,f){a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.closePath(),a.fill(),a.stroke()},function(){"use strict";function a(a){this.publish=function(){return a.$emit.apply(a,arguments)},this.subscribe=function(){return a.$on.apply(a,arguments)}}a.$inject=["$rootScope"],angular.module("pattyApp.utils").service("Messagebus",a)}(),function(){"use strict";function a(){return function(a,b){return b=+b,a.slice(b)}}angular.module("pattyApp.utils").filter("startFrom",a)}(),function(){"use strict";function a(a){this.bingMapsKey="Am6kAyf_AScih8y3ElNRSDpQ9xMJ8jn4yeePDKdHzhsNU4u7Jm-Ac8LJooYKmhbY",this.culture="nl",this.boundingBox={minlon:3.37,minlat:50.75,maxlon:7.21,maxlat:53.47},this.geocodeUrl=function(a){var b="http://dev.virtualearth.net/REST/v1/Locations?";return b+="jsonp=JSON_CALLBACK",b=b+"&q="+a,b=b+"&key="+this.bingMapsKey,this.culture&&(b=b+"&c="+this.culture),b},this.geocode=function(b){var c=this.geocodeUrl(b),d=this.boundingBox;return a.jsonp(c).then(function(a){var b=a.data.resourceSets[0].resources,c=b.filter(function(a){var b=a.point.coordinates[0],c=a.point.coordinates[1];return d.minlat<=b&&b<=d.maxlat&&d.minlon<=c&&c<=d.maxlon});return c})}}a.$inject=["$http"],angular.module("pattyApp.utils").service("BingGeoCoderService",a)}(),function(){"use strict";angular.module("pattyApp.core").constant("proj4",proj4).constant("ol",ol).constant("pattyConf",{DRIVEMAP_JSON_URL:"data/drivemap.json",AHN_API_ENDPOINT:"http://ahn2.pointclouds.nl/api"})}(),function(){"use strict";function a(a,b,c,d,e){var f=this;this.data={};var g=b.defer();this.ready=g.promise,this.load=function(){return a.get(e.DRIVEMAP_JSON_URL).success(this.onLoad).error(this.onLoadFailure)},this.onLoad=function(a){f.data=a,f.registerProj4(),g.resolve(a)},this.onLoadFailure=function(){c.log("Failed to load drive map!!"),g.reject.apply(this,arguments)},this.registerProj4=function(){d.defs(this.getCrs(),this.data.features[0].properties.proj4)},this.getPointcloudUrl=function(){return this.data.features[0].properties.pointcloud},this.getCameraPath=function(){return this.data.features[0].geometry.coordinates},this.getLookPath=function(){return this.data.features[0].properties.lookatpath},this.getCrs=function(){return this.data.crs.properties.name}}a.$inject=["$http","$q","$log","proj4","pattyConf"],angular.module("pattyApp.core").service("DrivemapService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/logos/logos.directive.html"}}angular.module("pattyApp.logos").directive("logoBoxDirective",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/searchbox/searchbox.directive.html",controller:"SearchPanelController",controllerAs:"sp"}}angular.module("pattyApp.searchbox").directive("pattySearchPanel",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){this.query="",this.hasGeoLocation="geolocation"in e.navigator,this.clear=function(){this.query=""},this.onLocationResponse=function(a){if(0===a.length)return void f.warning("No results","Location not found");var b=a[0];this.query=b.name.replace(", Nederland","");var c=b.point.coordinates;this.gotoLocation(c[1],c[0])},this.search=function(){a.geocode(this.query).then(this.onLocationResponse.bind(this),function(){f.error("Search failed","for some reason")})},this.onQueryKeyPress=function(a){var b=13;a.keyCode===b&&this.search()},this.gotoLocation=function(a,d){var e=0,f="EPSG:4326",i=[a,d],j="EPSG:28992",k=h(f,j,i),l=new g.Vector3(k[0],k[1],e),m=b.toLocal(l),n=0,o=-1e3,p=1e3,q=[k[0]+n,k[1]+o],r=b.toLocal(new g.Vector3(q[0],q[1],e+p));c.moveTo(r),c.lookat(m)},this.gotoCurrentLocation=function(){e.navigator.geolocation.getCurrentPosition(function(a){var b=a.coords;this.gotoLocation(b.longitude,b.latitude)}.bind(this),function(){f.error("Unable to get current location")})}}a.$inject=["BingGeoCoderService","SceneService","PathControls","Messagebus","$window","toastr","THREE","proj4"],angular.module("pattyApp.searchbox").controller("SearchPanelController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/settings/settings.directive.html",controller:"SettingsController",controllerAs:"sc"}}angular.module("pattyApp.settings").directive("pattySettings",a)}(),function(){"use strict";function a(a,b,c,d,e){this.showSettings=!1,this.PointcloudService=a,this.PathControls=d,this.RailService=e,this.measure=b,this.ld=!1,this.sd=!0,this.md=!1,this.hd=!1,this.toggleSettings=function(){this.showSettings?this.showSettings=!1:(c.publish("closeOtherPanels","settings"),this.showSettings=!0)},this.panelClose=function(a,b){"settings"!==b&&(this.showSettings=!1)}.bind(this),c.subscribe("closeOtherPanels",this.panelClose),this.settingsChanged=function(){this.ld=!1,this.sd=!1,this.md=!1,this.hd=!1,this.PointcloudService.settings===this.PointcloudService.predefinedSettings.LOW?this.ld=!0:this.PointcloudService.settings===this.PointcloudService.predefinedSettings.STANDARD?this.sd=!0:this.PointcloudService.settings===this.PointcloudService.predefinedSettings.HIGH?this.md=!0:this.PointcloudService.settings===this.PointcloudService.predefinedSettings.ULTRA&&(this.hd=!0)}.bind(this)}a.$inject=["PointcloudService","MeasuringService","Messagebus","PathControls","RailService"],angular.module("pattyApp.settings").controller("SettingsController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/help/help.directive.html",controller:"HelpController",controllerAs:"hc"}}angular.module("pattyApp.help").directive("pattyHelp",a)}(),function(){"use strict";function a(){}angular.module("pattyApp.help").controller("HelpController",a)}(),function(){"use strict";function a(a,b){this.camFrustum=new a.geom.LineString([[0,0],[1,0],[0,1]]);var c=new a.source.Vector({features:[new a.Feature(this.camFrustum)]});this.layer=new a.layer.Vector({source:c,style:new a.style.Style({stroke:new a.style.Stroke({color:"red",width:2})})}),this.setColor=function(a){this.layer.style.stroke.color=a},this.getExtent=function(){return c.getExtent()},this.getCameraPosition=function(){var a=1e5,c=this.camFrustum.getCoordinates(),d=new b.Vector3(c[0][0],c[0][1],0),e=new b.Vector3(c[1][0],c[1][1],0),f=new b.Vector3(c[2][0],c[2][1],0),g=new b.Vector3(c[3][0],c[3][1],0),h=d.clone().lerp(e,.5),i=f.clone().lerp(g,.5),j=h.clone().sub(i).length();j>a&&(j=a);var k=1-j/a,l=h.clone().lerp(i,k);return l.toArray().slice(0,2)},this.onCameraMove=function(a,b){var c=a.map(function(a){return[a.x,a.y]});this.layer.getStyle().getStroke().setLineDash(b?[]:[6]),c.push(c[0]),this.camFrustum.setCoordinates(c)}}a.$inject=["ol","THREE"],angular.module("pattyApp.minimap").service("CamFrustumService",a)}(),function(){"use strict";function a(){return{restrict:"E",link:function(a,b){a.vm.map.setTarget(b[0])},controller:"MinimapController",controllerAs:"vm"}}angular.module("pattyApp.minimap").directive("pattyMinimap",a)}(),function(){"use strict";function a(a,b,c,d,e){b.defs("EPSG:28992","+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs");for(var f=a.proj.get("EPSG:28992"),g=[-285401.92,22598.08,595401.9199999999,903401.9199999999],h=[3440.64,1720.32,860.16,430.08,215.04,107.52,53.76,26.88,13.44,6.72,3.36,1.68,.84,.42],i=new Array(14),j=0;15>j;++j)i[j]="EPSG:28992:"+j;for(var k=new Array(14),l=0;15>l;++l)k[l]=10>l?"0"+l:""+l;var m=a.proj.get("EPSG:28992");m.setExtent([646.36,308975.28,276050.82,636456.31]);var n=a.proj.transform([4.451,51.777],"EPSG:4326","EPSG:28992");this.osmLayer={};var o=new a.layer.Group({title:"Base maps",layers:[new a.layer.Tile({title:"NederlandBRT",type:"base",visible:!0,extent:g,source:new a.source.WMTS({url:"http://geodata.nationaalgeoregister.nl/tiles/service/wmts/brtachtergrondkaart",layer:"brtachtergrondkaart",matrixSet:"EPSG:28992",format:"image/png",projection:f,tileGrid:new a.tilegrid.WMTS({origin:a.extent.getTopLeft(g),resolutions:h,matrixIds:i})})}),this.osmLayer=new a.layer.Tile({title:"Aerial photos",type:"base",visible:!1,source:new a.source.WMTS({url:"http://geodata1.nationaalgeoregister.nl/luchtfoto/wmts",layer:"luchtfoto",matrixSet:"nltilingschema",format:"image/jpeg",projection:f,tileGrid:new a.tilegrid.WMTS({origin:a.extent.getTopLeft(g),resolutions:h,matrixIds:k}),style:"default"})})]});this.map=new a.Map({maxExtent:g,layers:o,theme:null,maxResolution:860.16,numZoomLevels:12,units:"m",displayProjection:f,view:new a.View({center:n,zoom:12,minZoom:6})}),this.setupResizeControl=function(){function b(b){var c=b||{},d=document.createElement("button");d.innerHTML='<span class="glyphicon glyphicon-resize-full"></span>';var e=this,f=!1,g=function(){f=!f,f?(e.getMap().getTarget().classList.add("big-minimap"),d.innerHTML='<span class="glyphicon glyphicon-resize-small"></span>'):(e.getMap().getTarget().classList.remove("big-minimap"),d.innerHTML='<span class="glyphicon glyphicon-resize-full"></span>'),e.getMap().updateSize()};d.addEventListener("click",g,!1),d.addEventListener("touchstart",g,!1);var h=document.createElement("div");h.className="resize-minimap ol-unselectable ol-control",h.appendChild(d),a.control.Control.call(this,{element:h,target:c.target})}a.inherits(b,a.control.Control),this.map.addControl(new b)},this.setupResizeControl();var p=new a.control.LayerSwitcher({tipLabel:"Legend"});this.map.addControl(p),this.map.addLayer(c.layer),this.centerMap=function(a){this.map.getView().setCenter(a)},this.updateFrustrumAndCenterMap=function(a,b,d){c.onCameraMove(b,d);var e=c.getExtent();this.map.getView().fit(e,this.map.getSize(),{padding:[20,20,20,20]});var f=c.getCameraPosition();this.centerMap(f)},d.subscribe("cameraMoved",this.updateFrustrumAndCenterMap.bind(this)),e.init(this.map)}a.$inject=["ol","proj4","CamFrustumService","Messagebus","MinimapExtractionSelectionService"],angular.module("pattyApp.minimap").controller("MinimapController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){var c=new a.Vector3(A.x,A.y,.5);c.unproject(v);var d=c.sub(v.position).normalize(),e=new a.Ray(v.position,d),f=[];w.traverse(function(a){a instanceof b.PointCloudOctree&&f.push(a)});for(var g=null,h=null,i=0;i<f.length;i++){var j=f[i],k=j.pick(u.renderer,v,e,{accuracy:.5});if(k){var l=v.position.distanceTo(k.position);(!g||h>l)&&(g=k,h=l)}}return g?g.position:null}function r(){if(u.settings.showStats){x?(u.stats.nrPoints=x.numVisiblePoints,u.stats.nrNodes=x.numVisibleNodes):(u.stats.nrPoints="none",u.stats.nrNodes="none");var a=q();if(a){var b=a;u.stats.sceneCoordinates.x=b.x.toFixed(2),u.stats.sceneCoordinates.y=b.y.toFixed(2),u.stats.sceneCoordinates.z=b.z.toFixed(2);var c=h.toGeo(b);u.stats.lasCoordinates.x=c.x.toFixed(2),u.stats.lasCoordinates.y=c.y.toFixed(2),u.stats.lasCoordinates.z=c.z.toFixed(2)}d.$digest()}}function s(a){A.x=a.clientX/u.renderer.domElement.clientWidth*2-1,A.y=2*-(a.clientY/u.renderer.domElement.clientHeight)+1}var t={Splats:"Splats",Low:"Circle"},u=this;this.elRenderArea=null,u.settings={pointCountTarget:2.5,pointSize:2,opacity:1,showSkybox:!1,interpolate:!1,showStats:!1,highQuality:!1,showBoundingBox:!1,pointColorTypes:b.PointColorType,clipModes:b.ClipMode,pointSizeType:b.PointSizeType.FIXED,pointColorType:b.PointColorType.HEIGHT,pointShape:b.PointShape.SQUARE,clipMode:b.ClipMode.HIGHLIGHT_INSIDE,quality:t.Low,qualities:t,useDEMCollisions:!1,minNodeSize:100,heightMin:-5,heightMax:45,useEDL:!1},u.predefinedSettings={LOW:{pointCountTarget:2.5,pointSize:2,opacity:1,showSkybox:!1,interpolate:!1,showStats:!1,highQuality:!1,showBoundingBox:!1,pointColorTypes:b.PointColorType,clipModes:b.ClipMode,pointSizeType:b.PointSizeType.FIXED,pointColorType:b.PointColorType.HEIGHT,pointShape:b.PointShape.SQUARE,clipMode:b.ClipMode.HIGHLIGHT_INSIDE,quality:t.Low,qualities:t,useDEMCollisions:!1,minNodeSize:100,heightMin:-5,heightMax:45,useEDL:!1},STANDARD:{pointCountTarget:5,pointSize:1,opacity:1,showSkybox:!0,interpolate:!1,showStats:!1,highQuality:!1,showBoundingBox:!1,pointColorTypes:b.PointColorType,clipModes:b.ClipMode,pointSizeType:b.PointSizeType.ATTENUATED,pointColorType:b.PointColorType.HEIGHT,pointShape:b.PointShape.CIRCLE,clipMode:b.ClipMode.HIGHLIGHT_INSIDE,quality:t.Low,qualities:t,useDEMCollisions:!1,minNodeSize:100,heightMin:-5,heightMax:45,useEDL:!1},HIGH:{pointCountTarget:5,pointSize:1,opacity:1,showSkybox:!0,interpolate:!0,showStats:!1,highQuality:!0,showBoundingBox:!1,pointColorTypes:b.PointColorType,clipModes:b.ClipMode,pointSizeType:b.PointSizeType.ATTENUATED,pointColorType:b.PointColorType.HEIGHT,pointShape:b.PointShape.CIRCLE,clipMode:b.ClipMode.HIGHLIGHT_INSIDE,quality:t.Splats,qualities:t,useDEMCollisions:!1,minNodeSize:100,heightMin:-5,heightMax:45,useEDL:!1},ULTRA:{pointCountTarget:10,pointSize:.5,opacity:1,showSkybox:!0,interpolate:!0,showStats:!1,highQuality:!1,showBoundingBox:!1,pointColorTypes:b.PointColorType,clipModes:b.ClipMode,pointSizeType:b.PointSizeType.ATTENUATED,pointColorType:b.PointColorType.HEIGHT,pointShape:b.PointShape.CIRCLE,clipMode:b.ClipMode.HIGHLIGHT_INSIDE,quality:t.Splats,qualities:t,useDEMCollisions:!1,minNodeSize:100,heightMin:-5,heightMax:45,useEDL:!0}},u.settings=u.predefinedSettings.STANDARD,u.stats={nrPoints:0,nrNodes:0,sceneCoordinates:{x:0,y:0,z:0},lasCoordinates:{x:0,y:0,z:0,crs:"unknown"}},u.renderer=null;var v,w,x,y;u.pathMesh=null;var z=h.referenceFrame,A={x:0,y:0};this.orbitControls=null,this.isInOrbitMode=!1;var B,C=new b.PointCloudMaterial;C.gradient=b.Gradients.VIRIDIS,this.initThree=function(){var d=c.innerWidth,e=c.innerHeight;w=h.getScene(),v=g.camera,u.renderer=new a.WebGLRenderer,u.renderer.setSize(d,e),u.renderer.autoClear=!1,u.elRenderArea.appendChild(u.renderer.domElement),u.renderer.domElement.addEventListener("mousemove",s,!1),B=new a.DirectionalLight(16777215,.5),B.position.set(10,10,10),B.lookAt(new a.Vector3(0,0,0)),w.add(B);var i=new a.AmbientLight(5592405);w.add(i),j.init(u.renderer,w,v),n.init(u.renderer,w,v),m.init(u.renderer,w,v),y=b.utils.loadSkybox("images/skybox/"),u.renderer.context.getExtension("EXT_frag_depth"),f.ready.then(this.loadPointcloud)},this.loadPointcloud=function(){var c=f.getPointcloudUrl();u.stats.lasCoordinates.crs=f.getCrs(),b.POCLoader.load(c,function(c){x=new b.PointCloudOctree(c,C),x.material.pointSizeType=b.PointSizeType.ADAPTIVE,x.material.size=u.settings.pointSize,x.visiblePointsTarget=1e3*u.settings.pointCountTarget*1e3,z.add(x),z.updateMatrixWorld(!0),z.position.set(-x.position.x,-x.position.y,0),z.updateMatrixWorld(!0),z.applyMatrix((new a.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1)),z.updateMatrixWorld(!0);var d=e.search();if(d.hasOwnProperty("camera_x")){var g=new a.Vector3(parseFloat(d.camera_x),parseFloat(d.camera_y),parseFloat(d.camera_z)),h=new a.Vector3(parseFloat(d.lookat_x),parseFloat(d.lookat_y),parseFloat(d.lookat_z)),m=h.clone();m.sub(g);var n=g.clone().add(m),o=h.clone().add(m),q=[[g.x,g.y,g.z],[n.x,n.y,n.z]],r=[[h.x,h.y,h.z],[o.x,o.y,o.z]];l.setCameraAndLookAtWaypoints(q,r)}else l.setCameraAndLookAtWaypoints(f.getCameraPath(),f.getLookPath());i.init(u.elRenderArea),j.setPointcloud(x),k.init(v,u.renderer,w,x,u.elRenderArea),p.publish("legendTexture change",b.Gradients.VIRIDIS)})},this.disableDrivemap=function(){z.remove(x)},this.enableDrivemap=function(){z.add(x)};var D=new a.Vector3,E=0;this.update=function(){if(b.pointLoadLimit=2*u.settings.pointCountTarget*1e3*1e3,u.settings.useEDL&&(B.position.copy(v.position),B.lookAt(D.set(0,0,0).addVectors(v.position,v.getWorldDirection()))),x){if(x.material.clipMode=u.settings.clipMode,x.material.heightMin=u.settings.heightMin,x.material.heightMax=u.settings.heightMax,x.material.intensityMin=0,x.material.intensityMax=65e3,x.showBoundingBox=u.settings.showBoundingBox,x.generateDEM=u.settings.useDEMCollisions,x.minimumNodePixelSize=u.settings.minNodeSize,x.update(v,u.renderer),E++,E>100){var a=x.visibleNodes.length/x.visibleGeometry.length,c=o.status();1===a&&1>c?o.complete():1>a&&a!==c?(o.start(),o.set(a)):a===1/0&&1>c&&o.complete(),E=0}}else o.start();j.update(),g.update(),x&&(k.enabled?k.update():i.updateInput()),r()};var F=function(){var a=function(a,b){
var c=a/b;v.aspect=c,v.updateProjectionMatrix(),u.renderer.setSize(a,b)};this.render=function(){a(u.elRenderArea.clientWidth,u.elRenderArea.clientHeight),u.settings.showSkybox&&(y.camera.rotation.copy(v.rotation),u.renderer.render(y.scene,y.camera)),x&&(x.originalMaterial&&(x.material=x.originalMaterial),x.visiblePointsTarget=1e3*u.settings.pointCountTarget*1e3,x.material.size=u.settings.pointSize,x.material.opacity=u.settings.opacity,x.material.pointColorType=u.settings.pointColorType,x.material.pointSizeType=u.settings.pointSizeType,x.material.pointShape=u.settings.PointShape,x.material.interpolate=u.settings.interpolate,x.material.weighted=!1,x.material.gradient=b.Gradients.VIRIDIS),u.renderer.render(w,v),j.tools.heightprofile.render(),j.tools.volume.render(),u.renderer.clearDepth(),j.tools.measuring.render(),j.tools.transformation.render()}},G=new F,H=null,I=function(){var c,d,e=null,f=null,g=null,h=function(){if(null===e){e=new b.PointCloudMaterial,f=new b.PointCloudMaterial,e.pointColorType=b.PointColorType.DEPTH,e.pointShape=b.PointShape.CIRCLE,e.interpolate=!1,e.weighted=!1,e.minSize=2,f.pointShape=b.PointShape.CIRCLE,f.gradient=b.Gradients.VIRIDIS,f.interpolate=!1,f.weighted=!0,f.minSize=2,c=new a.WebGLRenderTarget(1024,1024,{minFilter:a.NearestFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.FloatType}),d=new a.WebGLRenderTarget(1024,1024,{minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.FloatType});var h={depthMap:{type:"t",value:c},texture:{type:"t",value:d}};g=new a.ShaderMaterial({uniforms:h,vertexShader:b.Shaders["normalize.vs"],fragmentShader:b.Shaders["normalize.fs"]})}},i=function(a,b){(c.width!==a||c.height!==b)&&(c.dispose(),d.dispose(),v.aspect=a/b,v.updateProjectionMatrix(),u.renderer.setSize(a,b),c.setSize(a,b),d.setSize(a,b))};this.render=function(a){var k=u.elRenderArea.clientWidth,l=u.elRenderArea.clientHeight;if(h(),i(k,l),a.clear(),u.settings.showSkybox&&(y.camera.rotation.copy(v.rotation),a.render(y.scene,y.camera)),a.render(w,v),x){e.uniforms.octreeSize.value=x.pcoGeometry.boundingBox.size().x,f.uniforms.octreeSize.value=x.pcoGeometry.boundingBox.size().x,x.visiblePointsTarget=1e3*u.settings.pointCountTarget*1e3;var m=x.material;e.size=u.settings.pointSize,e.pointSizeType=u.settings.pointSizeType,e.screenWidth=k,e.screenHeight=l,e.uniforms.visibleNodes.value=x.material.visibleNodesTexture,e.uniforms.octreeSize.value=x.pcoGeometry.boundingBox.size().x,e.fov=v.fov*(Math.PI/180),e.spacing=x.pcoGeometry.spacing,e.near=v.near,e.far=v.far,e.heightMin=u.settings.heightMin,e.heightMax=u.settings.heightMax,e.uniforms.visibleNodes.value=x.material.visibleNodesTexture,e.uniforms.octreeSize.value=x.pcoGeometry.boundingBox.size().x,e.bbSize=x.material.bbSize,e.treeType=x.material.treeType,w.overrideMaterial=e,a.clearTarget(c,!0,!0,!0),a.render(w,v,c),w.overrideMaterial=null,f.size=u.settings.pointSize,f.pointSizeType=u.settings.pointSizeType,f.screenWidth=k,f.screenHeight=l,f.pointColorType=u.settings.pointColorType,f.depthMap=c,f.uniforms.visibleNodes.value=x.material.visibleNodesTexture,f.uniforms.octreeSize.value=x.pcoGeometry.boundingBox.size().x,f.fov=v.fov*(Math.PI/180),f.spacing=x.pcoGeometry.spacing,f.near=v.near,f.far=v.far,f.heightMin=u.settings.heightMin,f.heightMax=u.settings.heightMax,f.intensityMin=x.material.intensityMin,f.intensityMax=x.material.intensityMax,f.setClipBoxes(x.material.clipBoxes),f.clipMode=x.material.clipMode,f.bbSize=x.material.bbSize,f.treeType=x.material.treeType,w.overrideMaterial=f,a.clearTarget(d,!0,!0,!0),a.render(w,v,d),w.overrideMaterial=null,g.uniforms.depthMap.value=c,g.uniforms.texture.value=d,b.utils.screenPass.render(a,g),x.material=m,j.tools.volume.render(),u.renderer.clearDepth(),j.tools.heightprofile.render(),j.tools.measuring.render(),j.tools.transformation.render()}}},J=null,K=function(){var c=null,d=null,e=null,f=function(){null===c&&(c=new b.EyeDomeLightingMaterial,d=new b.PointCloudMaterial,d.gradient=b.Gradients.VIRIDIS,d.pointShape=b.PointShape.CIRCLE,d.interpolate=!1,d.weighted=!1,d.useLogarithmicDepthBuffer=!1,d.useEDL=!0,e=new a.WebGLRenderTarget(1024,1024,{minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.FloatType}))},g=function(){var a=u.elRenderArea.clientWidth,b=u.elRenderArea.clientHeight,c=a/b,d=e.width!==a||e.height!==b;d&&e.dispose(),v.aspect=c,v.updateProjectionMatrix(),u.renderer.setSize(a,b),e.setSize(a,b)};this.render=function(){if(f(),g(),u.renderer.clear(),u.settings.showSkybox&&(y.camera.rotation.copy(v.rotation),u.renderer.render(y.scene,y.camera)),u.renderer.render(w,v),x){var a=u.elRenderArea.clientWidth,h=u.elRenderArea.clientHeight,i=x.pcoGeometry.boundingBox.size().x;x.visiblePointsTarget=1e3*u.settings.pointCountTarget*1e3,d.size=u.settings.pointSize,d.pointSizeType=u.settings.pointSizeType,d.screenWidth=a,d.screenHeight=h,d.pointColorType=u.settings.pointColorType,d.uniforms.visibleNodes.value=x.material.visibleNodesTexture,d.uniforms.octreeSize.value=i,d.fov=v.fov*(Math.PI/180),d.spacing=x.pcoGeometry.spacing,d.near=v.near,d.far=v.far,d.heightMin=u.settings.heightMin,d.heightMax=u.settings.heightMax,d.intensityMin=x.material.intensityMin,d.intensityMax=x.material.intensityMax,d.setClipBoxes(x.material.clipBoxes),d.clipMode=x.material.clipMode,d.bbSize=x.material.bbSize,d.treeType=x.material.treeType,w.overrideMaterial=d,u.renderer.clearTarget(e,!0,!0,!0),u.renderer.render(w,v,e),w.overrideMaterial=null,c.uniforms.screenWidth.value=a,c.uniforms.screenHeight.value=h,c.uniforms.near.value=v.near,c.uniforms.far.value=v.far,c.uniforms.colorMap.value=e,c.uniforms.expScale.value=v.far,b.utils.screenPass.render(u.renderer,c),u.renderer.render(w,v),j.tools.heightprofile.render(),j.tools.volume.render(),u.renderer.clearDepth(),j.tools.measuring.render(),j.tools.transformation.render()}}};this.loop=function(){requestAnimationFrame(u.loop),u.update(),u.settings.useEDL?(J||(J=new K),J.render(u.renderer)):"Splats"===u.settings.quality?(H||(H=new I),H.render(u.renderer)):G.render()},this.attachCanvas=function(a){u.elRenderArea=a,u.initThree();var b=u.renderer.domElement;a.appendChild(b),u.loop()}}a.$inject=["THREE","Potree","$window","$rootScope","$location","DrivemapService","CameraService","SceneService","PathControls","MeasuringService","EarthcontrolsService","RailService","ExtractionDrawingService","PointcloudExtractionSelectionService","cfpLoadingBar","Messagebus","GradientsService"],angular.module("pattyApp.pointcloud").service("PointcloudService",a)}(),function(){"use strict";function a(a){var b=new a.Scene;this.referenceFrame=new a.Object3D,b.add(this.referenceFrame),this.getScene=function(){return b},this.toLocal=function(a){var b=a.clone().applyMatrix4(this.referenceFrame.matrixWorld);return b};var c=new a.Matrix4,d=new a.Box3;this.toGeo=function(b){var e,f=c.identity().getInverse(this.referenceFrame.matrixWorld);if(b instanceof a.Vector3)e=b.clone().applyMatrix4(f);else if(b instanceof a.Box3){var g=b.min.clone().applyMatrix4(f),h=b.max.clone().applyMatrix4(f);e=d.set(g,h)}return e}}a.$inject=["THREE"],angular.module("pattyApp.pointcloud").service("SceneService",a)}();var thecamera;!function(){"use strict";function a(a,b,c,d,e,f,g){var h=this,i=75,j=b.innerWidth,k=b.innerHeight,l=j/k,m=.1,n=6e5;this.camera=new e.PerspectiveCamera(i,l,m,n),this.floor=new e.Plane(new e.Vector3(0,1,0),0),b.addEventListener("resize",function(){h.onWindowResize()});var o=new e.Matrix4;this.getCameraOrientation=function(){return o.identity().multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorld).determinant()};var p=this.getCameraOrientation();this.update=function(){var a=this.getCameraOrientation();a!==p&&this.update2DFrustum(),p=a}.bind(this);var q=new e.Vector3,r=new e.Vector3,s=new e.Vector3,t=new e.Vector3,u=new e.Ray,v=new e.Vector3,w=new e.Vector3,x=new e.Vector3,y=new e.Vector3;this.update2DFrustum=function(){q=q.set(1,-1,1).unproject(this.camera).normalize(),r=r.set(-1,-1,1).unproject(this.camera).normalize(),s=s.set(-1,1,1).unproject(this.camera).normalize(),t=t.set(1,1,1).unproject(this.camera).normalize();var a,b,c=[null,null,null,null],d=!0;if(b=this.camera.position.clone(),b.y=-b.y,u=u.set(this.camera.position,q),a=u.intersectPlane(this.floor),a&&(c[0]=a,u=u.set(this.camera.position,r),a=u.intersectPlane(this.floor),c[1]=a),u=u.set(this.camera.position,s),a=u.intersectPlane(this.floor),a&&(c[2]=a,u=u.set(this.camera.position,t),a=u.intersectPlane(this.floor),c[3]=a),null===c[0])null===c[3]?(u=u.set(b,q),a=u.intersectPlane(this.floor),c[2]=a,u=u.set(b,r),a=u.intersectPlane(this.floor),c[3]=a,u=u.set(b,s),a=u.intersectPlane(this.floor),c[0]=a,u=u.set(b,t),a=u.intersectPlane(this.floor),c[1]=a,d=!1):(c[0]=c[2].clone(),c[1]=c[3].clone(),x=x.set(0,0,0).subVectors(c[2],this.camera.position),y=y.set(0,0,0).subVectors(c[3],this.camera.position),c[2]=y.multiplyScalar(1e3),c[3]=x.multiplyScalar(1e3),c[2].y=0,c[3].y=0);else if(null===c[3])v=v.set(0,0,0).subVectors(c[0],this.camera.position),w=w.set(0,0,0).subVectors(c[1],this.camera.position),c[2]=w.multiplyScalar(1e3),c[3]=v.multiplyScalar(1e3),c[2].y=0,c[3].y=0;else if(this.camera.position.y<0){var e=c[0],h=c[1];c[0]=c[2],c[1]=c[3],c[2]=e,c[3]=h}var i=c.map(function(a){return g.toGeo(a)});f.publish("cameraMoved",i,d)},this.onWindowResize=function(){var a=b.innerWidth,c=b.innerHeight,d=a/c;this.camera.aspect=d,this.camera.updateProjectionMatrix()}}a.$inject=["$rootScope","$window","$log","$location","THREE","Messagebus","SceneService"],angular.module("pattyApp.pointcloud").service("CameraService",a)}(),function(){"use strict";function a(a,b,c,d,e){this.waypoints=[],this.cameraCurve=new c.SplineCurve3,this.lookatCurve=new c.SplineCurve3,this.curveSegments=100,this.lookatDistance=100,this.dataUrl=null,this.addCameraLocation=function(){var d=a.camera,e=d.position.clone(),f=b.toGeo(e).toArray(),g=new c.Vector3(0,0,-1*this.lookatDistance).applyQuaternion(d.quaternion).add(d.position),h=b.toGeo(g).toArray();this.waypoints.push(f.concat(h)),this.waypointsChanged()},this.getCameraAndLookatLocation=function(){var d=a.camera,e=d.position.clone(),f=new c.Vector3(0,0,-1*this.lookatDistance).applyQuaternion(d.quaternion).add(d.position),g=b.toGeo(e).toArray(),h=b.toGeo(f).toArray();return{cameraPosition:g,lookatPosition:h}},this.removeLast=function(){this.waypoints.pop(),this.waypointsChanged()},this.waypointsChanged=function(){this.updateSplines(),this.updateRailScene(),this.updateDataUrl()},this.updateSplines=function(){if(!(this.waypoints.length<2)){var a=this.waypoints.map(function(a){return b.toLocal(new c.Vector3(a[0],a[1],a[2]))}),d=new c.SplineCurve3(a);this.cameraCurve=new c.SplineCurve3(d.getSpacedPoints(this.curveSegments));var e=this.waypoints.map(function(a){return b.toLocal(new c.Vector3(a[3],a[4],a[5]))}),f=new c.SplineCurve3(e);this.lookatCurve=new c.SplineCurve3(f.getSpacedPoints(this.curveSegments))}},this.firstCameraPosition=function(){return this.cameraCurve.getPointAt(0)},this.firstLookatPosition=function(){return this.lookatCurve.getPointAt(0)},this.setWaypoints=function(a){this.waypoints=angular.copy(a),this.waypointsChanged()},this.setCameraAndLookAtWaypoints=function(a,b){this.waypoints=[];for(var c=0;c<a.length;c++)this.waypoints.push(a[c].concat(b[c]));this.waypointsChanged()},this.updateRailScene=function(){var a=this.scene.visible;b.getScene().remove(this.scene),this.createRailScene(),this.scene.visible=a},this.createRailScene=function(){if(this.scene=new c.Object3D,this.scene.name="rail",this.scene.visible=!1,this.waypoints.length>=2){var a=this.createTube(this.cameraCurve,"camera",65535,16711680);this.scene.add(a);var d=this.createTube(this.lookatCurve,"lookat",65535,65280);this.scene.add(d)}b.getScene().add(this.scene)},this.createTube=function(a,b,d,e){var f=new c.TubeGeometry(a,1024,.25,8,!1),g=c.SceneUtils.createMultiMaterialObject(f,[new c.MeshLambertMaterial({color:d}),new c.MeshBasicMaterial({color:d,opacity:.3,wireframe:!1,transparent:!1})]);g.name=b;var h=new c.SphereGeometry(.5,32,32),i=new c.MeshBasicMaterial({color:e});return a.points.map(function(a){var b=new c.Mesh(h,i);b.position.copy(a),g.add(b)}.bind(this)),g},this.updateDataUrl=function(){var a=JSON.stringify(this.waypoints),b=new Blob([a],{type:"application/json"});this.dataUrl&&e.URL.revokeObjectURL(this.dataUrl),this.dataUrl=e.URL.createObjectURL(b)},this.onFileUpload=function(a){this.filereader.readyState===FileReader.DONE?(this.setWaypoints(JSON.parse(a.target.result)),d.success("Upload of demo waypoints completed")):d.error("Upload of demo waypoints failed")},this.upload=function(a){if(!(a.length<1)){var b=a[0];this.filereader.readAsText(b)}},this.clear=function(){this.waypoints=[],this.waypointsChanged()},this.filereader=new FileReader,this.filereader.onloadend=this.onFileUpload.bind(this),this.filereader.onerror=function(){d.error("Upload of demo waypoints failed")},this.createRailScene(),this.updateDataUrl()}a.$inject=["CameraService","SceneService","THREE","toastr","$window"],angular.module("pattyApp.pointcloud").service("RailService",a)}(),function(){"use strict";function a(a,b){var c,d=Number.MAX_VALUE,e=0,f=0;for(c=0;c<a.points.length;c++)e=b.distanceTo(a.points[c]),d>e&&(d=e,f=c);return f}function b(b,c){var d=a(b,c),e=Number.MAX_VALUE,f=Number.MAX_VALUE,g=1;0!==d&&(e=c.distanceTo(b.points[d-1])),d<b.points.length-1&&(f=c.distanceTo(b.points[d+1])),e>f?g=d+1:(d-=1,g=d+1);var h=c.clone();h.sub(b.points[d]);var i=b.points[g].clone();i.sub(b.points[d].clone()),i.normalize();var j=h.dot(i)/h.length();return(d+j)/b.points.length*N}function c(a){return Math.min(Math.max(a,0),1)}function d(a){var b=new x.Vector3(Math.sin(C),Math.sin(-D),Math.cos(C));return b.multiplyScalar(-a)}function e(a){var b=new x.Vector3(Math.cos(-C),0,Math.sin(-C));return b.multiplyScalar(-a)}function f(){D=Math.max(Math.min(D,E),F),t.rotation.set(D,C,0,"YXZ")}function g(a){(J[87]||J[38])&&(M+=a),(J[83]||J[40])&&(M-=a),M%=N,0>M&&(M=N+M);var b=y.cameraCurve;t.position.copy(b.getPointAt(M/N))}function h(a){(J[87]||J[119]||J[38])&&w.add(d(a)),(J[83]||J[115]||J[40])&&w.sub(d(a))}function i(a){(J[90]||J[122])&&(w.y-=a),(J[81]||J[113])&&(w.y+=a)}function j(a){(J[65]||J[97]||J[37])&&w.add(a),(J[68]||J[100]||J[39])&&w.sub(a)}function k(a){h(a),i(a),j(e(a))}function l(){var a=1,c=y.lookatCurve,d=b(c,w)/c.points.length,e=y.cameraCurve,f=b(e,w)/e.points.length;return 0!==f&&0!==d&&(a=Math.max(f,d)/Math.min(f,d)),a}function m(a){J[a.keyCode]=!0;var b=32;a.keyCode===b&&a.preventDefault()}function n(a){J[a.keyCode]=!1}function o(){A=!1;var a;for(a=0;a<J.length;a++)J[a]=!1}function p(a){z.mode!==z.modes.OFF&&2===a.button&&(document.activeElement!==v&&v.focus(),a.preventDefault(),G=a.pageX,H=a.pageY,A=!0)}function q(a){z.mode!==z.modes.OFF&&2===a.button&&(a.preventDefault(),A=!1)}function r(a){if(z.mode!==z.modes.OFF){if(!A)return;C-=I*(a.pageX-G)/window.innerWidth,D-=I*(a.pageY-H)/window.innerHeight,G=a.pageX,H=a.pageY}}function s(a){if(z.mode!==z.modes.OFF){a.preventDefault(),a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail),0>b?K+=2.5:K-=2.5,K>L&&(K=L),5>K&&(K=5),t.fov=K,t.updateProjectionMatrix()}}var t,u,v,w,x,y,z,A=!1,B=1.08,C=0,D=0,E=.95*Math.PI/2,F=-.95*Math.PI/2,G=window.innerWidth/2,H=window.innerHeight/2,I=8,J=[],K=45,L=45,M=0,N=240,O=function(a,b,c){z=this,x=a,y=b,this.NORMAL_MOVEMENT_SPEED_MULTIPLIER=30,this.FAST_MOVEMENT_SPEED_MULTIPLIER=50,this.cameraEasing=10;for(var d=0;130>d;d++)J.push(!1);t=c.camera,u=new x.Clock,this.modes={ONRAILS:"onrails",FLY:"fly",DEMO:"demo",OFF:"off"},this.mode=this.modes.FLY};O.prototype.initCamera=function(a){t.position.copy(a),t.up.set(0,1,0),t.rotation.order="YXZ",w=t.position,K=t.fov,L=t.fov},O.prototype.initListeners=function(a){v=a,a.setAttribute("tabindex",1),a.addEventListener("keydown",m,!1),a.addEventListener("keyup",n,!1),a.addEventListener("mouseleave",o,!1),a.addEventListener("mouseout",o,!1),a.addEventListener("mousemove",r,!1),a.addEventListener("mousedown",p,!1),a.addEventListener("mouseup",q,!1),a.addEventListener("mousewheel",s,!1),a.addEventListener("DOMMouseScroll",s,!1)},O.prototype.disableListeners=function(a){a.removeEventListener("keydown",m,!1),a.removeEventListener("keyup",n,!1),a.removeEventListener("mouseleave",o,!1),a.removeEventListener("mouseout",o,!1),a.removeEventListener("mousemove",r,!1),a.removeEventListener("mousedown",p,!1),a.removeEventListener("mouseup",q,!1),a.removeEventListener("mousewheel",s,!1),a.removeEventListener("DOMMouseScroll",s,!1)},O.prototype.init=function(a){this.initCamera(y.firstCameraPosition()),this.lookat(y.firstLookatPosition()),t.updateProjectionMatrix(),this.initListeners(a)},O.prototype.goToPointOnRoad=function(a){var c=y.cameraCurve;M=b(c,a),w.copy(c.getPointAt(M/N))},O.prototype.lookat=function(a){t.up=new x.Vector3(0,1,0),t.lookAt(a),C=t.rotation.y,D=t.rotation.x},O.prototype.moveTo=function(a){w.copy(a)},O.prototype.updateDemoMode=function(a){M+=a,M%=N,0>M&&(M=N+M);var b=y.cameraCurve;t.position.copy(b.getPointAt(M/N)),B=(1-a/this.cameraEasing)*B+a/this.cameraEasing*l();var d=y.lookatCurve,e=M/N*(d.getLength()/b.getLength())*B,f=d.getPointAt(c(e));this.lookat(f)},O.prototype.updateInput=function(){var a=y.cameraCurve;if(a){var b=u.getDelta();b*=this.NORMAL_MOVEMENT_SPEED_MULTIPLIER,J[32]&&(b*=this.FAST_MOVEMENT_SPEED_MULTIPLIER),z.mode!==z.modes.OFF&&f(),this.mode===this.modes.DEMO?this.updateDemoMode(b):this.mode===this.modes.FLY?k(10*b):this.mode===this.modes.ONRAILS?g(b):this.mode===this.modes.OFF||console.log("error: unknown control mode in path.controls")}},O.prototype.enableFlightMode=function(){this.mode=this.modes.FLY},O.prototype.transitionFromFlightMode=function(){this.mode===this.modes.FLY&&this.goToPointOnRoad(w)},O.prototype.enableRailsMode=function(){this.transitionFromFlightMode(),this.mode=this.modes.ONRAILS},O.prototype.enableDemoMode=function(){this.transitionFromFlightMode(),this.mode=this.modes.DEMO},O.prototype.disable=function(){this.previousMode=this.mode,this.mode=this.modes.OFF},O.prototype.enable=function(){this.mode=this.previousMode},angular.module("pattyApp.pointcloud").service("PathControls",["THREE","RailService","CameraService",O])}(),function(){"use strict";function a(){return{restrict:"E",link:function(a,b){a.vm.attachCanvas(b[0])},controller:"PointcloudCanvasController",controllerAs:"vm"}}angular.module("pattyApp.pointcloud").directive("pattyPointcloudCanvas",a)}(),function(){"use strict";function a(a){this.attachCanvas=function(b){a.attachCanvas(b)}}a.$inject=["PointcloudService"],angular.module("pattyApp.pointcloud").controller("PointcloudCanvasController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/pointcloud/pointcloud-stats.directive.html",controller:"PointcloudStatsController",controllerAs:"pcs"}}angular.module("pattyApp.pointcloud").directive("pattyPointcloudStats",a)}(),function(){"use strict";function a(a){this.stats=a.stats,this.PointcloudService=a,this.settings=a.settings}a.$inject=["PointcloudService"],angular.module("pattyApp.pointcloud").controller("PointcloudStatsController",a)}(),function(){"use strict";function a(a,b,c,d){this.tools={measuring:null,volume:null,heightprofile:null,clipvolume:null,transformation:null},this.transformationTools={TRANSLATE:0,ROTATE:1,SCALE:2},this.activeTransformationTool=this.transformationTools.ROTATE,this.pointcloud=null,this.sitePointcloud=null,this.profileWidth=.1,this.initialized=!1,this.onKeyDown=function(b){69===b.keyCode?(this.activeTransformationTool=this.transformationTools.SCALE,a.$digest(),this.tools.transformation.scale()):82===b.keyCode?(this.activeTransformationTool=this.transformationTools.ROTATE,a.$digest(),this.tools.transformation.rotate()):84===b.keyCode&&(this.activeTransformationTool=this.transformationTools.TRANSLATE,a.$digest(),this.tools.transformation.translate())},this.clear=function(){this.clearStandardPotreeMeasurementTool(this.tools.measuring),this.clearVolumes(),this.clearProfile()},this.clearStandardPotreeMeasurementTool=function(a){a.measurements=[],a.sceneMeasurement=new c.Scene,a.sceneRoot=new c.Object3D,a.sceneMeasurement.add(a.sceneRoot),a.light=new c.DirectionalLight(16777215,1),a.light.position.set(0,0,10),a.light.lookAt(new c.Vector3(0,0,0)),a.sceneMeasurement.add(a.light)},this.clearVolumes=function(){this.tools.volume.volumes=[],this.tools.volume.sceneVolume=new c.Scene},this.clearProfile=function(){this.tools.heightprofile.profiles=[],this.tools.heightprofile.sceneProfile=new c.Scene,this.tools.heightprofile.sceneRoot=new c.Object3D,this.tools.heightprofile.sceneProfile.add(this.tools.heightprofile.sceneRoot)},this.init=function(a,c,e){this.tools.measuring=new b.MeasuringTool(c,e,a),this.tools.volume=new b.VolumeTool(c,e,a),this.tools.heightprofile=new b.ProfileTool(c,e,a),this.tools.transformation=new b.TransformationTool(c,e,a),d.transformationTool=this.tools.transformation,d.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.initialized=!0},this.setPointcloud=function(a){this.pointcloud=a},this.setSitePointcloud=function(a){this.sitePointcloud=a},this.startDistance=function(){this.tools.measuring&&this.tools.measuring.startInsertion({showDistances:!0,showArea:!1,closed:!1})},this.startAngle=function(){this.tools.measuring&&this.tools.measuring.startInsertion({showDistances:!1,showAngles:!0,showArea:!1,closed:!0,maxMarkers:3})},this.startArea=function(){this.tools.measuring&&this.tools.measuring.startInsertion({showDistances:!0,showArea:!0,closed:!0})},this.startVolume=function(){this.tools.volume&&this.tools.volume.startInsertion()},this.startHeighProfile=function(){this.tools.heightprofile&&this.tools.heightprofile.startInsertion({width:this.profileWidth})},this.startClipVolume=function(){this.tools.volume&&this.tools.volume.startInsertion({clip:!0})},this.render=function(){this.initialized&&(this.tools.heightprofile.render(),this.tools.volume.render(),this.tools.measuring.renderer.clearDepth(),this.tools.measuring.render(),this.tools.transformation.render())};var e=new c.Matrix4;this.update=function(){if(this.initialized){this.tools.volume.update(),this.tools.transformation.update(),this.tools.heightprofile.update();for(var a=[],b=0;b<this.tools.heightprofile.profiles.length;b++)for(var c=this.tools.heightprofile.profiles[b],d=0;d<c.boxes.length;d++){var f=c.boxes[d];f.updateMatrixWorld();var g=e.identity().getInverse(f.matrixWorld);a.push(g)}for(var h=0;h<this.tools.volume.volumes.length;h++){var i=this.tools.volume.volumes[h];if(i.clip){i.updateMatrixWorld();var j=e.identity().getInverse(i.matrixWorld);a.push(j)}}this.pointcloud&&this.pointcloud.material.setClipBoxes(a),this.sitePointcloud&&this.sitePointcloud.material.setClipBoxes(a)}}}a.$inject=["$rootScope","Potree","THREE","$window"],angular.module("pattyApp.measuring").service("MeasuringService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/measuring/measuring.directive.html",controller:"MeasuringController",controllerAs:"measuring"}}angular.module("pattyApp.measuring").directive("measuringDirective",a)}(),function(){"use strict";function a(a,b){this.showToolboxTray=!1,this.showTransformationToolboxTray=!1,this.distanceActive=!1,this.angleActive=!1,this.areaActive=!1,this.volumeActive=!1,this.heightProfileActive=!1,this.clipVolumeActive=!1,this.measuringService=a,this.toggleToolbox=function(){this.resetState(),this.showToolboxTray?this.showToolboxTray=!1:(b.publish("closeOtherPanels","toolbox"),this.showToolboxTray=!0)},this.panelClose=function(a,b){"toolbox"!==b&&(this.resetState(),this.showToolboxTray=!1)}.bind(this),b.subscribe("closeOtherPanels",this.panelClose),this.resetState=function(){this.distanceActive=!1,this.angleActive=!1,this.areaActive=!1,this.volumeActive=!1,this.heightProfileActive=!1,this.clipVolumeActive=!1,this.showTransformationToolboxTray=!1,this.measuringService.clear()},this.isTransformationRotate=function(){var a=!1;return this.measuringService.activeTransformationTool===this.measuringService.transformationTools.ROTATE&&(a=!0),a},this.isTransformationTranslate=function(){var a=!1;return this.measuringService.activeTransformationTool===this.measuringService.transformationTools.TRANSLATE&&(a=!0),a},this.isTransformationScale=function(){var a=!1;return this.measuringService.activeTransformationTool===this.measuringService.transformationTools.SCALE&&(a=!0),a},this.startDistance=function(){this.resetState(),this.distanceActive=!0,this.measuringService.startDistance()},this.startAngle=function(){this.resetState(),this.angleActive=!0,this.measuringService.startAngle()},this.startArea=function(){this.resetState(),this.areaActive=!0,this.measuringService.startArea()},this.startAngle=function(){this.resetState(),this.angleActive=!0,this.measuringService.startAngle()},this.startVolume=function(){this.resetState(),this.volumeActive=!0,this.showTransformationToolboxTray=!0,this.measuringService.startVolume()},this.startHeightProfile=function(){this.resetState(),this.heightProfileActive=!0,this.measuringService.startHeightProfile()},this.startClipVolume=function(){this.resetState(),this.clipVolumeActive=!0,this.showTransformationToolboxTray=!0,this.measuringService.startClipVolume()},this.toggleRotate=function(){this.measuringService.activeTransformationTool=this.measuringService.transformationTools.ROTATE,this.resetState(),this.showTransformationToolboxTray=!0,this.measuringService.tools.transformation.rotate()},this.toggleTranslate=function(){this.measuringService.activeTransformationTool=this.measuringService.transformationTools.TRANSLATE,this.resetState(),this.showTransformationToolboxTray=!0,this.measuringService.tools.transformation.translate()},this.toggleScale=function(){this.measuringService.activeTransformationTool=this.measuringService.transformationTools.SCALE,this.resetState(),this.showTransformationToolboxTray=!0,this.measuringService.tools.transformation.scale()}}a.$inject=["MeasuringService","Messagebus"],angular.module("pattyApp.measuring").controller("MeasuringController",a)}(),function(){"use strict";function a(a,b){this._active=!1,this._left=93720.22,this._bottom=436899.97,this._right=94428.37,this._top=438334.32,this.debouncedSendUpdate=function(){this.checkSwapCoordinates(),a.publish("extractionSelectionChanged",this.toRequest())}.bind(this),this.sendUpdate=b(500,this.debouncedSendUpdate),this.updateValue=function(a,b){b!==this[a]&&(this[a]=b,this.sendUpdate())},Object.defineProperty(this,"active",{get:function(){return this._active},set:function(b){b!==this._active&&a.publish("extractionSelectionActivationChanged",b),this._active=b}}),Object.defineProperty(this,"left",{get:function(){return this._left},set:function(a){this.updateValue("_left",a)}}),Object.defineProperty(this,"top",{get:function(){return this._top},set:function(a){this.updateValue("_top",a)}}),Object.defineProperty(this,"right",{get:function(){return this._right},set:function(a){this.updateValue("_right",a)}}),Object.defineProperty(this,"bottom",{get:function(){return this._bottom},set:function(a){this.updateValue("_bottom",a)}}),this.checkSwapCoordinates=function(){var a=-1;this._bottom>this._top&&(a=this._top,this._top=this._bottom,this._bottom=a),this._left>this._right&&(a=this._right,this._right=this._left,this._left=a)},this.setBottomLeftCoordinates=function(a){this.bottom=a.lat,this.left=a.lon},this.setTopRightCoordinates=function(a){this.top=a.lat,this.right=a.lon},this.toRequest=function(){var a={left:this._left,bottom:this._bottom,right:this._right,top:this._top};return a}}a.$inject=["Messagebus","debounce"],angular.module("pattyApp.extract").service("ExtractionSelectionService",a)}(),function(){"use strict";function a(a,b,c){this.source=new b.source.Vector({wrapX:!1}),this.layer=new b.layer.Vector({source:this.source,style:new b.style.Style({fill:new b.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new b.style.Stroke({color:"#f00",width:2})}),visible:!1}),this.drawing=!1,this.geometryFunction=function(a,c){c||(c=new b.geom.Polygon(null));var d=a[0],e=a[1];return c.setCoordinates([[d,[d[0],e[1]],e,[e[0],d[1]],d]]),c},this.drawer=new b.interaction.Draw({source:this.source,type:"LineString",geometryFunction:this.geometryFunction,maxPoints:2,style:new b.style.Style({fill:new b.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new b.style.Stroke({color:"#f00",width:3}),image:new b.style.RegularShape({stroke:new b.style.Stroke({color:"#f00",width:2}),points:4,radius:10,radius2:0,angle:0})})}),this.onDrawStart=function(){this.source.clear(),this.drawing=!0},this.onDrawEnd=function(b){function c(a){return Math.round(100*a)/100}var d=b.feature.getGeometry().getCoordinates(),e={lon:c(d[0][3][0]),lat:c(d[0][3][1])},f={lon:c(d[0][1][0]),lat:c(d[0][1][1])};a.setTopRightCoordinates(e),a.setBottomLeftCoordinates(f),this.drawing=!1},this.remoteSelectionChanged=function(a,b){this.drawing||this.drawSelection(b)},this.drawSelection=function(a){var c=[[[a.left,a.top],[a.left,a.bottom],[a.right,a.bottom],[a.right,a.top],[a.left,a.top]]],d=this.source.getFeatures()[0];if(d){var e=d.getGeometry();e.setCoordinates(c)}else d=new b.Feature({geometry:new b.geom.Polygon(c)}),this.source.addFeature(d)},this.activationChanged=function(b,c){this.layer.setVisible(c),this.drawer.setActive(c),c&&this.drawSelection(a)},this.init=function(a){a.addLayer(this.layer),a.addInteraction(this.drawer)},this.drawer.setActive(!1),this.drawer.on("drawstart",this.onDrawStart.bind(this)),this.drawer.on("drawend",this.onDrawEnd.bind(this)),c.subscribe("extractionSelectionChanged",this.remoteSelectionChanged.bind(this)),c.subscribe("extractionSelectionActivationChanged",this.activationChanged.bind(this))}a.$inject=["ExtractionSelectionService","ol","Messagebus"],angular.module("pattyApp.extract").service("MinimapExtractionSelectionService",a)}(),function(){"use strict";function a(a,b,c,d,e,f){function g(a){j.selectionActive&&1===a.which&&(j.mouseDownLocalPoint=k.getMousePointCloudIntersection(),j.mouseDownLocalPoint&&(j.mouseDownPoint=b.toGeo(j.mouseDownLocalPoint)))}function h(a){if(j.selectionActive&&1===a.which){var d=k.getMousePointCloudIntersection();if(d){j.otherPoint=b.toGeo(d);var e={lat:j.mouseDownPoint.y,lon:j.mouseDownPoint.x},f={lat:j.otherPoint.y,lon:j.otherPoint.x};c.setTopRightCoordinates(e),c.setBottomLeftCoordinates(f),j.mouseDownLocalPoint=null}}}function i(a){if(j.selectionActive){j.mouse.x=a.clientX/j.renderer.domElement.clientWidth*2-1,j.mouse.y=2*-(a.clientY/j.renderer.domElement.clientHeight)+1;var b=k.getMousePointCloudIntersection();j.mouseDownLocalPoint&&b?d.setIntermediate(j.mouseDownLocalPoint,b):d.removeIntermediate()}}var j=this;this.selectionActive=!1,this.mouseDownPoint=null,this.mouseDownLocalPoint=null,this.otherPoint=null,this.renderer=null,this.scene=null,this.camera=null,this.mesh=null,this.mouse={x:0,y:0},this.init=function(a,b,c){this.renderer=a,this.scene=b,this.camera=c,j.renderer.domElement.addEventListener("mousemove",i,!1),j.renderer.domElement.addEventListener("mousedown",g,!1),j.renderer.domElement.addEventListener("mouseup",h,!0)},this.getMousePointCloudIntersection=function(){var b=new a.Vector3(j.mouse.x,j.mouse.y,.5);b.unproject(j.camera);var c=b.sub(j.camera.position).normalize(),d=new a.Ray(j.camera.position,c),e=[];j.scene.traverse(function(a){a instanceof f.PointCloudOctree&&e.push(a)});for(var g=null,h=null,i=0;i<e.length;i++){var k=e[i],l=k.pick(j.renderer,j.camera,d,{accuracy:.5});if(l){var m=j.camera.position.distanceTo(l.position);(!g||h>m)&&(g=l,h=m)}}return g?g.position:null};var k=this;this.activationChanged=function(a,b){this.selectionActive=b,e.publish("earthcontrols suspended",b)},e.subscribe("extractionSelectionActivationChanged",this.activationChanged.bind(this))}a.$inject=["THREE","SceneService","ExtractionSelectionService","ExtractionDrawingService","Messagebus","Potree"],angular.module("pattyApp.extract").service("PointcloudExtractionSelectionService",a);

}(),function(){"use strict";function a(a,b,c){this.color=new a.Color(16777215),this.renderer=null,this.scene=null,this.camera=null,this.selectionMesh=null,this.intermediateMesh=null,this.init=function(a,b,c){this.renderer=a,this.scene=b,this.camera=c},this.remoteSelectionChanged=function(c,d){this.scene.remove(this.selectionMesh);var e=b.toLocal(new a.Vector3(d.left,d.top,0)),f=b.toLocal(new a.Vector3(d.right,d.top,0)),g=b.toLocal(new a.Vector3(d.right,d.bottom,0)),h=b.toLocal(new a.Vector3(d.left,d.bottom,0));this.selectionMesh=this.buildSelectionGeometry(e,f,g,h,16711680),this.scene.add(this.selectionMesh)},c.subscribe("extractionSelectionChanged",this.remoteSelectionChanged.bind(this)),this.setIntermediate=function(b,c){this.scene.remove(this.selectionMesh),this.scene.remove(this.intermediateMesh);var d=new a.Vector3(b.x,0,b.z),e=new a.Vector3(c.x,0,b.z),f=new a.Vector3(c.x,0,c.z),g=new a.Vector3(b.x,0,c.z);this.intermediateMesh=this.buildSelectionGeometry(d,e,f,g,16711680),this.scene.add(this.intermediateMesh)},this.removeIntermediate=function(){this.scene.remove(this.intermediateMesh)},this.buildSelectionGeometry=function(b,c,d,e,f){var g=new a.MeshBasicMaterial({color:f,side:a.DoubleSide,transparent:!0,wireframe:!1,opacity:1}),h=new a.Geometry,i=null,j=new a.BoxGeometry(c.x-b.x+50,25,25);i=(new a.Matrix4).setPosition(new a.Vector3(b.x+.5*(c.x-b.x),45,b.z+12)),j.applyMatrix(i);var k=new a.BoxGeometry(25,25,c.z-d.z+50);i=(new a.Matrix4).setPosition(new a.Vector3(d.x+12,45,d.z+.5*(c.z-d.z))),k.applyMatrix(i);var l=new a.BoxGeometry(d.x-e.x+50,25,25);i=(new a.Matrix4).setPosition(new a.Vector3(e.x+.5*(d.x-e.x),45,e.z-12)),l.applyMatrix(i);var m=new a.BoxGeometry(25,25,b.z-e.z+50);i=(new a.Matrix4).setPosition(new a.Vector3(b.x-12,45,e.z+.5*(b.z-e.z))),m.applyMatrix(i),h.merge(j),h.merge(k),h.merge(l),h.merge(m);var n=new a.Mesh(h,g);return n},this.activationChanged=function(a,b){b?(null!==this.selectionMesh&&this.scene.add(this.selectionMesh),null!==this.intermediateMesh&&this.scene.add(this.intermediateMesh),this.show=!0):(this.scene.remove(this.selectionMesh),this.scene.remove(this.intermediateMesh),this.show=!1)},c.subscribe("extractionSelectionActivationChanged",this.activationChanged.bind(this))}a.$inject=["THREE","SceneService","Messagebus"],angular.module("pattyApp.extract").service("ExtractionDrawingService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/extract/extraction.directive.html",controller:"ExtractionController",controllerAs:"ec"}}angular.module("pattyApp.extract").directive("extractionPanel",a)}(),function(){"use strict";function a(a,b,c,d,e){this.selection=a,this.email="",this.size={coverage:1,returnedPoints:0,rawPoints:0,level:14},this.selection.active=!1,this.togglePanel=function(){this.selection.active?this.selection.active=!1:(c.publish("closeOtherPanels","extraction"),this.selection.active=!0)},this.panelClose=function(a,b){"extraction"!==b&&(this.selection.active=!1)}.bind(this),c.subscribe("closeOtherPanels",this.panelClose),this.count=function(){var a=this.selection.toRequest(),c=b.AHN_API_ENDPOINT,e=c+"/size";d.post(e,a).success(function(a){this.size=a}.bind(this)).error(function(){console.log(arguments)})},this.submit=function(){var a=this.selection.toRequest();a.email=this.email;var c=b.AHN_API_ENDPOINT,f=c+"/laz";d.post(f,a).success(function(b){this.size=b,e.success('Will send e-mail to "'+a.email+'" when completed',"Point extraction job submitted")}.bind(this)).error(function(){console.log(arguments),e.error("Submit failed","for some reason")}),this.showForm=!1}}a.$inject=["ExtractionSelectionService","pattyConf","Messagebus","$http","toastr"],angular.module("pattyApp.extract").controller("ExtractionController",a)}(),function(){"use strict";function a(){function a(a,b,c){return"undefined"==typeof c||0===+c?Math[a](b):(b=+b,c=+c,isNaN(b)||"number"!=typeof c||c%1!==0?0/0:(b=b.toString().split("e"),b=Math[a](+(b[0]+"e"+(b[1]?+b[1]-c:-c))),b=b.toString().split("e"),+(b[0]+"e"+(b[1]?+b[1]+c:c))))}Math.round10||(Math.round10=function(b,c){return a("round",b,c)}),Math.floor10||(Math.floor10=function(b,c){return a("floor",b,c)}),Math.ceil10||(Math.ceil10=function(b,c){return a("ceil",b,c)}),Math.log10||(Math.log10=Math.log10||function(a){return Math.log(a)/Math.LN10})}angular.module("pattyApp.utils").service("DecimalAdjust",a)}(),function(){"use strict";function a(a){this.isMobile={Android:function(){return a.navigator.userAgent.match(/Android/i)},BlackBerry:function(){return a.navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return a.navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return a.navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return a.navigator.userAgent.match(/IEMobile/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}},this.mobile=this.isMobile.any()?!0:!1}a.$inject=["$window"],angular.module("pattyApp.utils").service("UserAgent",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/biglegend/biglegend.directive.html",controller:"BigLegendController",controllerAs:"blc"}}angular.module("pattyApp.biglegend").directive("bigLegendDirective",a)}(),function(){"use strict";function a(a,b,c,d,e){this.PointcloudService=e,this.mobile=d.mobile,this.logarithmic=!1,c.subscribe("logarithmicChange",function(a,b){this.logarithmic=b,this.setLegendText()}.bind(this)),this.legendText=[40,30,20,10],this.legendMin=e.settings.heightMin,a.$watch("blc.legendMin",function(a,b){a===b||(this.setLegendText(),e.settings.heightMin=a)}.bind(this)),this.legendMax=e.settings.heightMax,a.$watch("blc.legendMax",function(a,b){a===b||(this.setLegendText(),e.settings.heightMax=a)}.bind(this)),c.subscribe("ncwmsPaletteSelected",function(a,b){this.setOnload(b.graphic)}.bind(this)),this.selectedUnits="m a.s.l.",c.subscribe("ncwmsUnitsChange",function(a,b){this.selectedUnits=b}.bind(this)),this.setLegendText=function(){var a=this.legendMax-this.legendMin,b=.2*a;if(this.logarithmic){var c=Math.log10(this.legendMin),d=Math.log10(this.legendMax);this.legendText[3]=Math.round10(Math.pow(10,.8*c+.2*d),-2),this.legendText[2]=Math.round10(Math.pow(10,.6*c+.4*d),-2),this.legendText[1]=Math.round10(Math.pow(10,.4*c+.6*d),-2),this.legendText[0]=Math.round10(Math.pow(10,.2*c+.8*d),-2)}else this.legendText[3]=Math.round10(this.legendMin+b,-2),this.legendText[2]=Math.round10(this.legendMin+2*b,-2),this.legendText[1]=Math.round10(this.legendMin+3*b,-2),this.legendText[0]=Math.round10(this.legendMin+4*b,-2)}.bind(this),this.setOnload=function(a){var b=document.getElementById("bigLegendCanvas").getContext("2d"),c=new Image;c.src=a,c.onload=function(){b.canvas.width=5,b.canvas.height=255,b.drawImage(c,0,0)}},this.generateLegendTexture=function(a,b,c){var d=document.createElement("canvas");d.width=b,d.height=c;var e=d.getContext("2d");e.rect(0,0,b,c);for(var f=e.createLinearGradient(0,c,b,0),g=0;g<a.length;g++){var h=a[g];f.addColorStop(h[0],"#"+h[1].getHexString())}return e.fillStyle=f,e.fill(),e},this.setTexture=function(a){var b=document.getElementById("bigLegendCanvas").getContext("2d"),c=new Image,d=this.generateLegendTexture(a,1,255);c.src=d.canvas.toDataURL(),c.onload=function(){b.canvas.width=1,b.canvas.height=255,b.drawImage(c,0,0)}},c.subscribe("legendTexture change",function(a,b){this.setTexture(b)}.bind(this))}a.$inject=["$scope","DecimalAdjust","Messagebus","UserAgent","PointcloudService"],angular.module("pattyApp.biglegend").controller("BigLegendController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/earthcontrols/earthcontrols.directive.html",controller:"EarthcontrolsController",controllerAs:"earthcontrols"}}angular.module("pattyApp.earthcontrols").directive("earthcontrolsDirective",a)}(),function(){"use strict";function a(a){this.enabled=!0,this.toggleEarthcontrols=function(){this.enabled=!this.enabled,a.publish("earthcontrols enabled",this.enabled)}}a.$inject=["Messagebus"],angular.module("pattyApp.earthcontrols").controller("EarthcontrolsController",a)}(),function(){"use strict";function a(a,b,c,d,e,f){this.enabled=!0,this.earthControls=null,this.pathcontrols=e,this.elementRenderArea=null;var g=new d.Clock;this.init=function(a,b,c,e,f){this.earthControls=new d.EarthControls(a,b,c),this.earthControls.addEventListener("proposeTransform",function(){}),this.earthControls.pointclouds.push(e),this.enabled?this.pathcontrols.disable():this.pathcontrols.enable(),this.elementRenderArea=f,this.elementRenderArea.addEventListener("mousedown",this.mousedown.bind(this),!1)},this.update=function(){this.enabled&&this.earthControls.update(g.getDelta());var c=f.getCameraAndLookatLocation();b.search({camera_x:c.cameraPosition[0],camera_y:c.cameraPosition[1],camera_z:c.cameraPosition[2],lookat_x:c.lookatPosition[0],lookat_y:c.lookatPosition[1],lookat_z:c.lookatPosition[2]}).replace(),a.$applyAsync()},this.mousedown=function(){document.activeElement!==this.elementRenderArea&&this.elementRenderArea.focus()},c.subscribe("earthcontrols suspended",function(a,b){this.earthControls.enabled=!b}.bind(this)),c.subscribe("earthcontrols enabled",function(a,b){this.enabled=b,b?this.pathcontrols.disable():this.pathcontrols.enable(),this.earthControls.enabled=b}.bind(this))}a.$inject=["$rootScope","$location","Messagebus","THREE","PathControls","RailService"],angular.module("pattyApp.earthcontrols").service("EarthcontrolsService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/helpModal/helpModal.directive.html",link:function(a){a.helpModal.init()},controller:"HelpModalController",controllerAs:"helpModal"}}angular.module("pattyApp.helpModal").directive("helpModalDirective",a)}(),function(){"use strict";function a(a,b){this.mobile=b.mobile,this.doNotShow=!1,this.dontShowClicked=function(){this.doNotShow?(console.log("dont show clicked"),a.localStorage.message="Do not show settings"):(console.log("show clicked"),a.localStorage.message="")},this.checkBrowser=function(){var b=a.navigator.userAgent,c={chrome:/chrome/i,edge:/edge/i,safari:/safari/i,firefox:/firefox/i,ie:/internet explorer/i};for(var d in c)if(c[d].test(b))return d;return"unknown"},this.init=function(){console.log("$window.localStorage.message : "+a.localStorage.message),"Do not show settings"===a.localStorage.message?this.doNotShow=!0:(this.doNotShow=!1,angular.element("#helpModal").modal({show:"true"}))},this.onClose=function(){},this.mobile||(this.chrome="chrome"===this.checkBrowser()||"edge"===this.checkBrowser())}a.$inject=["$window","UserAgent","Messagebus"],angular.module("pattyApp.helpModal").controller("HelpModalController",a)}(),function(){"use strict";function a(){Potree.Gradients.VIRIDIS=[[0,new THREE.Color(.267,.0049,.3294)],[.0039,new THREE.Color(.2685,.0096,.3354)],[.0078,new THREE.Color(.2699,.0146,.3414)],[.0118,new THREE.Color(.2713,.0199,.3473)],[.0157,new THREE.Color(.2726,.0256,.3531)],[.0196,new THREE.Color(.2738,.0315,.3589)],[.0235,new THREE.Color(.275,.0378,.3645)],[.0275,new THREE.Color(.276,.0442,.3702)],[.0314,new THREE.Color(.277,.0503,.3757)],[.0353,new THREE.Color(.2779,.0563,.3812)],[.0392,new THREE.Color(.2788,.0621,.3866)],[.0431,new THREE.Color(.2796,.0678,.3919)],[.0471,new THREE.Color(.2803,.0734,.3972)],[.051,new THREE.Color(.2809,.0789,.4023)],[.0549,new THREE.Color(.2814,.0843,.4074)],[.0588,new THREE.Color(.2819,.0897,.4124)],[.0627,new THREE.Color(.2823,.095,.4173)],[.0667,new THREE.Color(.2827,.1002,.4222)],[.0706,new THREE.Color(.2829,.1054,.4269)],[.0745,new THREE.Color(.2831,.1106,.4316)],[.0784,new THREE.Color(.2832,.1157,.4361)],[.0824,new THREE.Color(.2832,.1208,.4406)],[.0863,new THREE.Color(.2832,.1258,.445)],[.0902,new THREE.Color(.2831,.1309,.4492)],[.0941,new THREE.Color(.2829,.1359,.4534)],[.098,new THREE.Color(.2826,.1409,.4575)],[.102,new THREE.Color(.2823,.1459,.4615)],[.1059,new THREE.Color(.2819,.1509,.4654)],[.1098,new THREE.Color(.2814,.1558,.4692)],[.1137,new THREE.Color(.2809,.1608,.4729)],[.1176,new THREE.Color(.2803,.1657,.4765)],[.1216,new THREE.Color(.2796,.1706,.48)],[.1255,new THREE.Color(.2788,.1755,.4834)],[.1294,new THREE.Color(.278,.1804,.4867)],[.1333,new THREE.Color(.2771,.1852,.4899)],[.1373,new THREE.Color(.2762,.1901,.493)],[.1412,new THREE.Color(.2752,.1949,.496)],[.1451,new THREE.Color(.2741,.1997,.4989)],[.149,new THREE.Color(.273,.2045,.5017)],[.1529,new THREE.Color(.2718,.2093,.5044)],[.1569,new THREE.Color(.2706,.2141,.5071)],[.1608,new THREE.Color(.2693,.2188,.5096)],[.1647,new THREE.Color(.268,.2235,.512)],[.1686,new THREE.Color(.2666,.2283,.5143)],[.1725,new THREE.Color(.2651,.233,.5166)],[.1765,new THREE.Color(.2637,.2376,.5188)],[.1804,new THREE.Color(.2621,.2423,.5208)],[.1843,new THREE.Color(.2606,.2469,.5228)],[.1882,new THREE.Color(.259,.2515,.5247)],[.1922,new THREE.Color(.2573,.2561,.5266)],[.1961,new THREE.Color(.2556,.2607,.5283)],[.2,new THREE.Color(.2539,.2653,.53)],[.2039,new THREE.Color(.2522,.2698,.5316)],[.2078,new THREE.Color(.2504,.2743,.5331)],[.2118,new THREE.Color(.2486,.2788,.5346)],[.2157,new THREE.Color(.2468,.2832,.5359)],[.2196,new THREE.Color(.245,.2877,.5373)],[.2235,new THREE.Color(.2431,.2921,.5385)],[.2275,new THREE.Color(.2412,.2965,.5397)],[.2314,new THREE.Color(.2393,.3009,.5408)],[.2353,new THREE.Color(.2374,.3052,.5419)],[.2392,new THREE.Color(.2355,.3095,.5429)],[.2431,new THREE.Color(.2336,.3138,.5439)],[.2471,new THREE.Color(.2317,.3181,.5448)],[.251,new THREE.Color(.2297,.3224,.5457)],[.2549,new THREE.Color(.2278,.3266,.5465)],[.2588,new THREE.Color(.2259,.3308,.5473)],[.2627,new THREE.Color(.2239,.335,.5481)],[.2667,new THREE.Color(.222,.3392,.5488)],[.2706,new THREE.Color(.2201,.3433,.5494)],[.2745,new THREE.Color(.2181,.3474,.55)],[.2784,new THREE.Color(.2162,.3515,.5506)],[.2824,new THREE.Color(.2143,.3556,.5512)],[.2863,new THREE.Color(.2124,.3597,.5517)],[.2902,new THREE.Color(.2105,.3637,.5522)],[.2941,new THREE.Color(.2086,.3678,.5527)],[.298,new THREE.Color(.2068,.3718,.5531)],[.302,new THREE.Color(.2049,.3757,.5535)],[.3059,new THREE.Color(.2031,.3797,.5539)],[.3098,new THREE.Color(.2012,.3837,.5543)],[.3137,new THREE.Color(.1994,.3876,.5546)],[.3176,new THREE.Color(.1976,.3915,.555)],[.3216,new THREE.Color(.1959,.3954,.5553)],[.3255,new THREE.Color(.1941,.3993,.5556)],[.3294,new THREE.Color(.1924,.4032,.5558)],[.3333,new THREE.Color(.1906,.4071,.5561)],[.3373,new THREE.Color(.1889,.4109,.5563)],[.3412,new THREE.Color(.1872,.4147,.5565)],[.3451,new THREE.Color(.1856,.4186,.5568)],[.349,new THREE.Color(.1839,.4224,.5569)],[.3529,new THREE.Color(.1823,.4262,.5571)],[.3569,new THREE.Color(.1806,.43,.5573)],[.3608,new THREE.Color(.179,.4338,.5574)],[.3647,new THREE.Color(.1774,.4375,.5576)],[.3686,new THREE.Color(.1758,.4413,.5577)],[.3725,new THREE.Color(.1743,.445,.5578)],[.3765,new THREE.Color(.1727,.4488,.5579)],[.3804,new THREE.Color(.1712,.4525,.558)],[.3843,new THREE.Color(.1696,.4563,.558)],[.3882,new THREE.Color(.1681,.46,.5581)],[.3922,new THREE.Color(.1666,.4637,.5581)],[.3961,new THREE.Color(.1651,.4674,.5581)],[.4,new THREE.Color(.1636,.4711,.5581)],[.4039,new THREE.Color(.1621,.4748,.5581)],[.4078,new THREE.Color(.1607,.4785,.5581)],[.4118,new THREE.Color(.1592,.4822,.5581)],[.4157,new THREE.Color(.1577,.4859,.558)],[.4196,new THREE.Color(.1563,.4896,.5579)],[.4235,new THREE.Color(.1548,.4933,.5578)],[.4275,new THREE.Color(.1534,.497,.5577)],[.4314,new THREE.Color(.1519,.5007,.5576)],[.4353,new THREE.Color(.1505,.5044,.5574)],[.4392,new THREE.Color(.149,.5081,.5573)],[.4431,new THREE.Color(.1476,.5117,.557)],[.4471,new THREE.Color(.1462,.5154,.5568)],[.451,new THREE.Color(.1448,.5191,.5566)],[.4549,new THREE.Color(.1433,.5228,.5563)],[.4588,new THREE.Color(.1419,.5265,.556)],[.4627,new THREE.Color(.1405,.5301,.5557)],[.4667,new THREE.Color(.1391,.5338,.5553)],[.4706,new THREE.Color(.1378,.5375,.5549)],[.4745,new THREE.Color(.1364,.5412,.5545)],[.4784,new THREE.Color(.1351,.5449,.554)],[.4824,new THREE.Color(.1337,.5485,.5535)],[.4863,new THREE.Color(.1324,.5522,.553)],[.4902,new THREE.Color(.1312,.5559,.5525)],[.4941,new THREE.Color(.1299,.5596,.5519)],[.498,new THREE.Color(.1287,.5633,.5512)],[.502,new THREE.Color(.1276,.5669,.5506)],[.5059,new THREE.Color(.1265,.5706,.5498)],[.5098,new THREE.Color(.1254,.5743,.5491)],[.5137,new THREE.Color(.1244,.578,.5483)],[.5176,new THREE.Color(.1235,.5817,.5474)],[.5216,new THREE.Color(.1226,.5854,.5466)],[.5255,new THREE.Color(.1218,.5891,.5456)],[.5294,new THREE.Color(.1211,.5927,.5446)],[.5333,new THREE.Color(.1206,.5964,.5436)],[.5373,new THREE.Color(.1201,.6001,.5425)],[.5412,new THREE.Color(.1197,.6038,.5414)],[.5451,new THREE.Color(.1195,.6075,.5402)],[.549,new THREE.Color(.1194,.6111,.539)],[.5529,new THREE.Color(.1195,.6148,.5377)],[.5569,new THREE.Color(.1197,.6185,.5363)],[.5608,new THREE.Color(.1201,.6222,.5349)],[.5647,new THREE.Color(.1206,.6258,.5335)],[.5686,new THREE.Color(.1214,.6295,.532)],[.5725,new THREE.Color(.1223,.6332,.5304)],[.5765,new THREE.Color(.1234,.6368,.5288)],[.5804,new THREE.Color(.1248,.6405,.5271)],[.5843,new THREE.Color(.1263,.6441,.5253)],[.5882,new THREE.Color(.1281,.6477,.5235)],[.5922,new THREE.Color(.1301,.6514,.5216)],[.5961,new THREE.Color(.1323,.655,.5197)],[.6,new THREE.Color(.1347,.6586,.5176)],[.6039,new THREE.Color(.1373,.6623,.5156)],[.6078,new THREE.Color(.1402,.6659,.5134)],[.6118,new THREE.Color(.1433,.6695,.5112)],[.6157,new THREE.Color(.1466,.673,.5089)],[.6196,new THREE.Color(.1501,.6766,.5066)],[.6235,new THREE.Color(.1539,.6802,.5042)],[.6275,new THREE.Color(.1579,.6838,.5017)],[.6314,new THREE.Color(.162,.6873,.4991)],[.6353,new THREE.Color(.1664,.6909,.4965)],[.6392,new THREE.Color(.1709,.6944,.4938)],[.6431,new THREE.Color(.1757,.6979,.491)],[.6471,new THREE.Color(.1807,.7014,.4882)],[.651,new THREE.Color(.1858,.7049,.4853)],[.6549,new THREE.Color(.1911,.7084,.4823)],[.6588,new THREE.Color(.1966,.7118,.4792)],[.6627,new THREE.Color(.2022,.7153,.4761)],[.6667,new THREE.Color(.208,.7187,.4729)],[.6706,new THREE.Color(.214,.7221,.4696)],[.6745,new THREE.Color(.2201,.7255,.4662)],[.6784,new THREE.Color(.2264,.7289,.4628)],[.6824,new THREE.Color(.2328,.7322,.4593)],[.6863,new THREE.Color(.2394,.7356,.4557)],[.6902,new THREE.Color(.2461,.7389,.452)],[.6941,new THREE.Color(.2529,.7422,.4483)],[.698,new THREE.Color(.2599,.7455,.4445)],[.702,new THREE.Color(.2669,.7488,.4406)],[.7059,new THREE.Color(.2741,.752,.4366)],[.7098,new THREE.Color(.2815,.7552,.4326)],[.7137,new THREE.Color(.2889,.7584,.4284)],[.7176,new THREE.Color(.2965,.7616,.4242)],[.7216,new THREE.Color(.3041,.7647,.4199)],[.7255,new THREE.Color(.3119,.7678,.4156)],[.7294,new THREE.Color(.3198,.7709,.4112)],[.7333,new THREE.Color(.3278,.774,.4066)],[.7373,new THREE.Color(.3359,.777,.402)],[.7412,new THREE.Color(.3441,.78,.3974)],[.7451,new THREE.Color(.3524,.783,.3926)],[.749,new THREE.Color(.3607,.786,.3878)],[.7529,new THREE.Color(.3692,.7889,.3829)],[.7569,new THREE.Color(.3778,.7918,.3779)],[.7608,new THREE.Color(.3864,.7946,.3729)],[.7647,new THREE.Color(.3952,.7975,.3678)],[.7686,new THREE.Color(.404,.8003,.3626)],[.7725,new THREE.Color(.4129,.803,.3573)],[.7765,new THREE.Color(.4219,.8058,.3519)],[.7804,new THREE.Color(.431,.8085,.3465)],[.7843,new THREE.Color(.4401,.8111,.341)],[.7882,new THREE.Color(.4494,.8138,.3354)],[.7922,new THREE.Color(.4587,.8164,.3297)],[.7961,new THREE.Color(.4681,.8189,.324)],[.8,new THREE.Color(.4775,.8214,.3182)],[.8039,new THREE.Color(.487,.8239,.3123)],[.8078,new THREE.Color(.4966,.8264,.3064)],[.8118,new THREE.Color(.5063,.8288,.3004)],[.8157,new THREE.Color(.516,.8312,.2943)],[.8196,new THREE.Color(.5258,.8335,.2881)],[.8235,new THREE.Color(.5356,.8358,.2819)],[.8275,new THREE.Color(.5455,.838,.2756)],[.8314,new THREE.Color(.5555,.8403,.2693)],[.8353,new THREE.Color(.5655,.8424,.2629)],[.8392,new THREE.Color(.5756,.8446,.2564)],[.8431,new THREE.Color(.5857,.8467,.2499)],[.8471,new THREE.Color(.5958,.8487,.2433)],[.851,new THREE.Color(.606,.8507,.2367)],[.8549,new THREE.Color(.6163,.8527,.2301)],[.8588,new THREE.Color(.6266,.8546,.2234)],[.8627,new THREE.Color(.6369,.8565,.2166)],[.8667,new THREE.Color(.6473,.8584,.2099)],[.8706,new THREE.Color(.6576,.8602,.2031)],[.8745,new THREE.Color(.6681,.862,.1963)],[.8784,new THREE.Color(.6785,.8637,.1895)],[.8824,new THREE.Color(.6889,.8654,.1827)],[.8863,new THREE.Color(.6994,.8671,.176)],[.8902,new THREE.Color(.7099,.8688,.1693)],[.8941,new THREE.Color(.7204,.8704,.1626)],[.898,new THREE.Color(.7309,.8719,.156)],[.902,new THREE.Color(.7414,.8734,.1496)],[.9059,new THREE.Color(.7519,.875,.1432)],[.9098,new THREE.Color(.7624,.8764,.1371)],[.9137,new THREE.Color(.7729,.8779,.1311)],[.9176,new THREE.Color(.7833,.8793,.1254)],[.9216,new THREE.Color(.7938,.8807,.12)],[.9255,new THREE.Color(.8042,.882,.115)],[.9294,new THREE.Color(.8146,.8834,.1103)],[.9333,new THREE.Color(.8249,.8847,.1062)],[.9373,new THREE.Color(.8353,.886,.1026)],[.9412,new THREE.Color(.8456,.8873,.0997)],[.9451,new THREE.Color(.8558,.8886,.0975)],[.949,new THREE.Color(.866,.8899,.096)],[.9529,new THREE.Color(.8762,.8911,.0953)],[.9569,new THREE.Color(.8863,.8924,.0954)],[.9608,new THREE.Color(.8963,.8936,.0963)],[.9647,new THREE.Color(.9063,.8949,.0981)],[.9686,new THREE.Color(.9162,.8961,.1007)],[.9725,new THREE.Color(.9261,.8973,.1041)],[.9765,new THREE.Color(.9359,.8986,.1081)],[.9804,new THREE.Color(.9456,.8998,.1128)],[.9843,new THREE.Color(.9553,.9011,.1181)],[.9882,new THREE.Color(.9649,.9023,.1239)],[.9922,new THREE.Color(.9744,.9036,.1302)],[.9961,new THREE.Color(.9839,.9049,.1369)],[1,new THREE.Color(.9932,.9062,.1439)]],Potree.Gradients.REALISTIC=[[0,new THREE.Color(1,1,.9804)],[.0039,new THREE.Color(.9686,.9686,.9804)],[.0078,new THREE.Color(.9373,.9373,.9804)],[.0118,new THREE.Color(.9059,.9059,.9804)],[.0157,new THREE.Color(.8745,.8745,.9765)],[.0196,new THREE.Color(.8431,.8431,.9765)],[.0235,new THREE.Color(.8118,.8118,.9765)],[.0275,new THREE.Color(.7804,.7804,.9765)],[.0314,new THREE.Color(.749,.749,.9725)],[.0353,new THREE.Color(.7176,.7176,.9725)],[.0392,new THREE.Color(.6863,.6863,.9725)],[.0431,new THREE.Color(.6549,.6549,.9686)],[.0471,new THREE.Color(.6235,.6235,.9686)],[.051,new THREE.Color(.5922,.5922,.9647)],[.0549,new THREE.Color(.5608,.5608,.9647)],[.0588,new THREE.Color(.5294,.5294,.9608)],[.0627,new THREE.Color(.498,.498,.9608)],[.0667,new THREE.Color(.4667,.4667,.9608)],[.0706,new THREE.Color(.4353,.4353,.9569)],[.0745,new THREE.Color(.4039,.4039,.9529)],[.0784,new THREE.Color(.3725,.3725,.9529)],[.0824,new THREE.Color(.3412,.3412,.949)],[.0863,new THREE.Color(.3098,.3098,.949)],[.0902,new THREE.Color(.2784,.2784,.9451)],[.0941,new THREE.Color(.2471,.2471,.9412)],[.098,new THREE.Color(.2157,.2157,.9412)],[.102,new THREE.Color(.1843,.1843,.9373)],[.1059,new THREE.Color(.1529,.1529,.9333)],[.1098,new THREE.Color(.1216,.1216,.9294)],[.1137,new THREE.Color(.0902,.0902,.9294)],[.1176,new THREE.Color(.0588,.0588,.9255)],[.1216,new THREE.Color(.0275,.0275,.9216)],[.1255,new THREE.Color(0,0,.9176)],[.1294,new THREE.Color(.0118,.0157,.9137)],[.1333,new THREE.Color(.0235,.0314,.9098)],[.1373,new THREE.Color(.0353,.0471,.9059)],[.1412,new THREE.Color(.051,.0627,.902)],[.1451,new THREE.Color(.0627,.0784,.8941)],[.149,new THREE.Color(.0745,.0941,.8902)],[.1529,new THREE.Color(.0863,.1059,.8863)],[.1569,new THREE.Color(.098,.1216,.8824)],[.1608,new THREE.Color(.1098,.1373,.8745)],[.1647,new THREE.Color(.1216,.1529,.8706)],[.1686,new THREE.Color(.1333,.1686,.8627)],[.1725,new THREE.Color(.1451,.1843,.8588)],[.1765,new THREE.Color(.1569,.2,.851)],[.1804,new THREE.Color(.1725,.2157,.8471)],[.1843,new THREE.Color(.1843,.2275,.8392)],[.1882,new THREE.Color(.1961,.2431,.8314)],[.1922,new THREE.Color(.2078,.2588,.8235)],[.1961,new THREE.Color(.2196,.2745,.8157)],[.2,new THREE.Color(.2314,.2902,.8118)],[.2039,new THREE.Color(.2431,.302,.8039)],[.2078,new THREE.Color(.2549,.3176,.7961)],[.2118,new THREE.Color(.2627,.3333,.7843)],[.2157,new THREE.Color(.2745,.3451,.7765)],[.2196,new THREE.Color(.2863,.3608,.7686)],[.2235,new THREE.Color(.298,.3765,.7608)],[.2275,new THREE.Color(.3098,.3882,.749)],[.2314,new THREE.Color(.3216,.4039,.7412)],[.2353,new THREE.Color(.3333,.4196,.7294)],[.2392,new THREE.Color(.3412,.4314,.7216)],[.2431,new THREE.Color(.3529,.4471,.7098)],[.2471,new THREE.Color(.3647,.4588,.702)],[.251,new THREE.Color(.3765,.4745,.6902)],[.2549,new THREE.Color(.3843,.4863,.6784)],[.2588,new THREE.Color(.3961,.502,.6667)],[.2627,new THREE.Color(.4078,.5137,.6588)],[.2667,new THREE.Color(.4157,.5255,.6471)],[.2706,new THREE.Color(.4275,.5412,.6353)],[.2745,new THREE.Color(.4353,.5529,.6235)],[.2784,new THREE.Color(.4471,.5647,.6118)],[.2824,new THREE.Color(.4549,.5765,.6)],[.2863,new THREE.Color(.4667,.5922,.5882)],[.2902,new THREE.Color(.4745,.6039,.5725)],[.2941,new THREE.Color(.4863,.6157,.5608)],[.298,new THREE.Color(.4941,.6275,.549)],[.302,new THREE.Color(.502,.6392,.5373)],[.3059,new THREE.Color(.5137,.651,.5255)],[.3098,new THREE.Color(.5216,.6627,.5137)],[.3137,new THREE.Color(.5294,.6745,.502)],[.3176,new THREE.Color(.5412,.6863,.4863)],[.3216,new THREE.Color(.549,.698,.4745)],[.3255,new THREE.Color(.5569,.7059,.4627)],[.3294,new THREE.Color(.5647,.7176,.451)],[.3333,new THREE.Color(.5725,.7294,.4392)],[.3373,new THREE.Color(.5804,.7373,.4275)],[.3412,new THREE.Color(.5882,.749,.4118)],[.3451,new THREE.Color(.5961,.7608,.4)],[.349,new THREE.Color(.6039,.7686,.3882)],[.3529,new THREE.Color(.6118,.7804,.3765)],[.3569,new THREE.Color(.6196,.7882,.3647)],[.3608,new THREE.Color(.6275,.7961,.3529)],[.3647,new THREE.Color(.6353,.8078,.3412)],[.3686,new THREE.Color(.6431,.8157,.3333)],[.3725,new THREE.Color(.651,.8235,.3216)],[.3765,new THREE.Color(.6588,.8353,.3098)],[.3804,new THREE.Color(.6627,.8431,.298)],[.3843,new THREE.Color(.6706,.851,.2902)],[.3882,new THREE.Color(.6784,.8588,.2784)],[.3922,new THREE.Color(.6863,.8667,.2706)],[.3961,new THREE.Color(.6902,.8745,.2588)],[.4,new THREE.Color(.698,.8824,.251)],[.4039,new THREE.Color(.702,.8863,.2392)],[.4078,new THREE.Color(.7098,.8941,.2314)],[.4118,new THREE.Color(.7176,.902,.2235)],[.4157,new THREE.Color(.7216,.9098,.2157)],[.4196,new THREE.Color(.7294,.9137,.2039)],[.4235,new THREE.Color(.7333,.9216,.1961)],[.4275,new THREE.Color(.7373,.9255,.1882)],[.4314,new THREE.Color(.7451,.9333,.1843)],[.4353,new THREE.Color(.749,.9373,.1765)],[.4392,new THREE.Color(.7569,.9451,.1686)],[.4431,new THREE.Color(.7608,.949,.1608)],[.4471,new THREE.Color(.7647,.9529,.1529)],[.451,new THREE.Color(.7725,.9569,.149)],[.4549,new THREE.Color(.7765,.9608,.1412)],[.4588,new THREE.Color(.7804,.9647,.1373)],[.4627,new THREE.Color(.7843,.9686,.1294)],[.4667,new THREE.Color(.7882,.9725,.1255)],[.4706,new THREE.Color(.7961,.9765,.1176)],[.4745,new THREE.Color(.8,.9804,.1137)],[.4784,new THREE.Color(.8039,.9843,.1098)],[.4824,new THREE.Color(.8078,.9843,.1059)],[.4863,new THREE.Color(.8118,.9882,.098)],[.4902,new THREE.Color(.8157,.9922,.0941)],[.4941,new THREE.Color(.8196,.9922,.0902)],[.498,new THREE.Color(.8235,.9961,.0863)],[.502,new THREE.Color(.8275,.9961,.0824)],[.5059,new THREE.Color(.8314,.9961,.0784)],[.5098,new THREE.Color(.8353,1,.0745)],[.5137,new THREE.Color(.8392,1,.0706)],[.5176,new THREE.Color(.8431,1,.0706)],[.5216,new THREE.Color(.8471,1,.0667)],[.5255,new THREE.Color(.851,1,.0627)],[.5294,new THREE.Color(.8549,1,.0588)],[.5333,new THREE.Color(.8549,1,.0588)],[.5373,new THREE.Color(.8588,1,.0549)],[.5412,new THREE.Color(.8627,1,.051)],[.5451,new THREE.Color(.8667,.9961,.051)],[.549,new THREE.Color(.8706,.9961,.0471)],[.5529,new THREE.Color(.8706,.9961,.0471)],[.5569,new THREE.Color(.8745,.9922,.0431)],[.5608,new THREE.Color(.8784,.9922,.0392)],[.5647,new THREE.Color(.8824,.9882,.0392)],[.5686,new THREE.Color(.8824,.9843,.0392)],[.5725,new THREE.Color(.8863,.9843,.0353)],[.5765,new THREE.Color(.8902,.9804,.0353)],[.5804,new THREE.Color(.8902,.9765,.0314)],[.5843,new THREE.Color(.8941,.9725,.0314)],[.5882,new THREE.Color(.898,.9686,.0275)],[.5922,new THREE.Color(.898,.9647,.0275)],[.5961,new THREE.Color(.902,.9608,.0275)],[.6,new THREE.Color(.902,.9569,.0235)],[.6039,new THREE.Color(.9059,.9529,.0235)],[.6078,new THREE.Color(.9098,.949,.0235)],[.6118,new THREE.Color(.9098,.9451,.0235)],[.6157,new THREE.Color(.9137,.9373,.0196)],[.6196,new THREE.Color(.9137,.9333,.0196)],[.6235,new THREE.Color(.9176,.9255,.0196)],[.6275,new THREE.Color(.9176,.9216,.0196)],[.6314,new THREE.Color(.9216,.9137,.0157)],[.6353,new THREE.Color(.9216,.9098,.0157)],[.6392,new THREE.Color(.9255,.902,.0157)],[.6431,new THREE.Color(.9255,.8941,.0157)],[.6471,new THREE.Color(.9255,.8863,.0157)],[.651,new THREE.Color(.9294,.8824,.0118)],[.6549,new THREE.Color(.9294,.8745,.0118)],[.6588,new THREE.Color(.9333,.8667,.0118)],[.6627,new THREE.Color(.9333,.8588,.0118)],[.6667,new THREE.Color(.9373,.851,.0118)],[.6706,new THREE.Color(.9373,.8431,.0118)],[.6745,new THREE.Color(.9373,.8353,.0118)],[.6784,new THREE.Color(.9412,.8235,.0078)],[.6824,new THREE.Color(.9412,.8157,.0078)],[.6863,new THREE.Color(.9412,.8078,.0078)],[.6902,new THREE.Color(.9451,.7961,.0078)],[.6941,new THREE.Color(.9451,.7882,.0078)],[.698,new THREE.Color(.9451,.7804,.0078)],[.702,new THREE.Color(.949,.7686,.0078)],[.7059,new THREE.Color(.949,.7608,.0078)],[.7098,new THREE.Color(.949,.749,.0078)],[.7137,new THREE.Color(.9529,.7373,.0078)],[.7176,new THREE.Color(.9529,.7294,.0039)],[.7216,new THREE.Color(.9529,.7176,.0039)],[.7255,new THREE.Color(.9569,.7059,.0039)],[.7294,new THREE.Color(.9569,.698,.0039)],[.7333,new THREE.Color(.9569,.6863,.0039)],[.7373,new THREE.Color(.9569,.6745,.0039)],[.7412,new THREE.Color(.9608,.6627,.0039)],[.7451,new THREE.Color(.9608,.651,.0039)],[.749,new THREE.Color(.9608,.6392,.0039)],[.7529,new THREE.Color(.9608,.6275,.0039)],[.7569,new THREE.Color(.9647,.6157,.0039)],[.7608,new THREE.Color(.9647,.6039,.0039)],[.7647,new THREE.Color(.9647,.5922,.0039)],[.7686,new THREE.Color(.9647,.5765,.0039)],[.7725,new THREE.Color(.9647,.5647,.0039)],[.7765,new THREE.Color(.9686,.5529,.0039)],[.7804,new THREE.Color(.9686,.5412,.0039)],[.7843,new THREE.Color(.9686,.5255,.0039)],[.7882,new THREE.Color(.9686,.5137,.0039)],[.7922,new THREE.Color(.9686,.502,.0039)],[.7961,new THREE.Color(.9725,.4863,.0039)],[.8,new THREE.Color(.9725,.4745,.0039)],[.8039,new THREE.Color(.9725,.4588,0)],[.8078,new THREE.Color(.9725,.4471,0)],[.8118,new THREE.Color(.9725,.4314,0)],[.8157,new THREE.Color(.9725,.4196,0)],[.8196,new THREE.Color(.9765,.4039,0)],[.8235,new THREE.Color(.9765,.3882,0)],[.8275,new THREE.Color(.9765,.3765,0)],[.8314,new THREE.Color(.9765,.3608,0)],[.8353,new THREE.Color(.9765,.3451,0)],[.8392,new THREE.Color(.9765,.3333,0)],[.8431,new THREE.Color(.9765,.3176,0)],[.8471,new THREE.Color(.9804,.302,0)],[.851,new THREE.Color(.9804,.2902,0)],[.8549,new THREE.Color(.9804,.2745,0)],[.8588,new THREE.Color(.9804,.2588,0)],[.8627,new THREE.Color(.9804,.2431,0)],[.8667,new THREE.Color(.9804,.2275,0)],[.8706,new THREE.Color(.9804,.2157,0)],[.8745,new THREE.Color(.9804,.2,0)],[.8784,new THREE.Color(.9843,.1843,0)],[.8824,new THREE.Color(.9843,.1686,0)],[.8863,new THREE.Color(.9843,.1529,0)],[.8902,new THREE.Color(.9843,.1373,0)],[.8941,new THREE.Color(.9843,.1216,0)],[.898,new THREE.Color(.9843,.1059,0)],[.902,new THREE.Color(.9843,.0941,0)],[.9059,new THREE.Color(.9843,.0784,0)],[.9098,new THREE.Color(.9843,.0627,0)],[.9137,new THREE.Color(.9843,.0471,0)],[.9176,new THREE.Color(.9882,.0314,0)],[.9216,new THREE.Color(.9882,.0157,0)],[.9255,new THREE.Color(.9882,0,0)],[.9294,new THREE.Color(.9882,0,0)],[.9333,new THREE.Color(.9882,0,0)],[.9373,new THREE.Color(.9882,0,0)],[.9412,new THREE.Color(.9725,0,0)],[.9451,new THREE.Color(.9569,0,0)],[.949,new THREE.Color(.9412,0,0)],[.9529,new THREE.Color(.9255,0,0)],[.9569,new THREE.Color(.9098,0,0)],[.9608,new THREE.Color(.8941,0,0)],[.9647,new THREE.Color(.8784,0,0)],[.9686,new THREE.Color(.8627,0,0)],[.9725,new THREE.Color(.8471,0,0)],[.9765,new THREE.Color(.8314,0,0)],[.9804,new THREE.Color(.8157,0,0)],[.9843,new THREE.Color(.8,0,0)],[.9882,new THREE.Color(.7843,0,0)],[.9922,new THREE.Color(.7686,0,0)],[.9961,new THREE.Color(.7529,0,0)],[1,new THREE.Color(.7373,0,0)]];

}angular.module("pattyApp.gradients").service("GradientsService",a)}(),angular.module("pattyApp.templates").run(["$templateCache",function(a){"use strict";a.put("scripts/biglegend/biglegend.directive.html",'<div class="interface-visible bigLegendContainer interface-clickthrough" ng-show="blc.PointcloudService.settings.pointColorType == 3">\n  <div ng-hide=\'blc.mobile\' class="bigLegendFlexContainer">\n    <!-- Positioned in css as: left column -->\n    <div class="bigLegendFlexSection">\n      <!-- Positioned in css as: left column elements equidistantly spaced vertically by flex -->\n      <form novalidate>\n        <input ng-model="blc.legendMax" type="number" class="bigLegendFormTextField interface-clickable" ng-model-options="{ updateOn: \'default\', debounce: { default: 10 } }" />\n      </form>\n    </div>\n    <div ng-repeat="text in blc.legendText track by $index" class="bigLegendFlexSection bigLegendFlexText">\n      {{text}}\n    </div>\n\n    <!-- This final element should be on the bottom of the legend, and is therefore not flexed (no div with css class) -->\n    <form novalidate>\n      <input ng-model="blc.legendMin" type="number" class="bigLegendFormTextField interface-clickable" ng-model-options="{ updateOn: \'default\', debounce: { default: 10 } }" />\n    </form>\n  </div>\n\n  <div ng-show=\'blc.mobile\' class="bigLegendFlexMobileContainer">\n    <div class="bigLegendFlexContainer">\n      <div class="bigLegendFlexSection bigLegendFlexText">{{blc.legendMax}}</div>\n      <div ng-repeat="text in blc.legendText track by $index" class="bigLegendFlexSection bigLegendFlexText">\n        {{text}}\n      </div>\n    </div>\n    <div class="bigLegendFlexText">{{blc.legendMin}}</div>\n  </div>\n\n  <div class="bigLegendImg">\n    <!-- Positioned in css as: right column -->\n    <canvas id="bigLegendCanvas"></canvas>\n  </div>\n\n  <div class="bigLegendUnits" title="Meters above sea level">\n    <!-- Positioned in css as: beneath both columns -->\n    {{blc.selectedUnits}}\n  </div>\n</div>\n'),a.put("scripts/earthcontrols/earthcontrols.directive.html",'<span class="controls-box">\n  <button class="giga-octicon octicon icon-big octicon-globe" ng-class="{active: earthcontrols.enabled}" ng-click="earthcontrols.toggleEarthcontrols()" data-step="8" data-intro="Google Earth-like controls" title="Switch to Google Earth-like controls"></button>\n  <button class="giga-octicon octicon icon-big octicon-keyboard" ng-class="{active: !earthcontrols.enabled}" ng-click="earthcontrols.toggleEarthcontrols()" data-step="9" data-intro="Keyboard controls" title="Switch to keyboard controls"></button>\n</span>\n'),a.put("scripts/extract/extraction.directive.html",'<button class="icon-big extract-icon" ng-class="{active: ec.selection.active}" ng-click="ec.togglePanel()" data-step="4" data-intro="Export points" title="Export points"></button>\n<div class="panel panel-default extract-panel" collapse=\'!ec.selection.active\'>\n  <div class="panel-heading">Export points\n    <button aria-label="Close" class="close" ng-click="ec.togglePanel()">\n      <span aria-hidden="true">&times;</span>\n    </button>\n  </div>\n  <div class="panel-body">\n    <div class="extraction-text">\n      There are 3 ways to select a rectangle of points to extract.\n      <ul>\n        <li>Click on the minimap to select points in the red rectangle.</li>\n        <li>Click and drag out a rectangle on the 3D view.</li>\n        <li>Set the extent numbers manually below.</li>\n      </ul>\n    </div>\n    <form class="form-inline" name="extractForm" role="search">\n      <div class="row">\n        <div class="col-xs-12 form-group">\n          <label for="email">Send link to email</label>\n          <input class="form-control" name="email" ng-minlength="4" ng-model="ec.email" placeholder="" type="email">\n        </div>\n      </div>\n      <div class="row">\n        <div class="form-group col-xs-offset-3 col-xs-6">\n          <label for="top">Top</label>\n          <input class="form-control" name="top" ng-model-options="{ debounce: 1000 }" ng-model="ec.selection.top" placeholder="" required step=0.01 type="number">\n        </div>\n      </div>\n      <div class="row">\n        <div class="form-group col-xs-6">\n          <label for="left">Left</label>\n          <input class="form-control" name="left" ng-model-options="{ debounce: 1000 }" ng-model="ec.selection.left" placeholder="" required step=0.01 type="number">\n        </div>\n        <div class="form-group col-xs-6">\n          <label for="right">Right</label>\n          <input class="form-control" name="right" ng-model-options="{ debounce: 1000 }" ng-model="ec.selection.right" placeholder="" required step=0.01 type="number">\n        </div>\n      </div>\n      <div class="row">\n        <div class="form-group col-xs-offset-3 col-xs-6">\n          <label for="bottom">Bottom</label>\n          <input class="form-control" name="bottom" ng-model-options="{ debounce: 1000 }" ng-model="ec.selection.bottom" placeholder="" required step=0.01 type="number">\n        </div>\n      </div>\n      <button class="btn btn-default" ng-click="ec.count()" type="button">Count points</button>\n      <button class="btn btn-primary" ng-click="ec.submit()" ng-disabled="extractForm.$invalid" type="submit">Submit</button>\n      <div class="row">\n        <div class="col-xs-6">\n          Number of points:\n          <span>{{ec.size.rawPoints | number}}</span>\n        </div>\n        <div class="col-xs-6">\n          Coverage (%):\n          <span title="When not all points can be extracted, a percentage is returned">{{ec.size.coverage * 100 | number}}</span>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n</div>\n'),a.put("scripts/help/help.directive.html",'<button data-toggle="modal" data-target="#helpModal" class="icon-big help-icon" data-step="6" data-intro="Help" title="Help"></button>\n'),a.put("scripts/helpModal/helpModal.directive.html",'<div class="modal fade" id="helpModal" role="dialog" aria-labelledby="helpModal" aria-hidden="true">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" ng-click="helpModal.onClose()">\n          <span class="glyphicon glyphicon-remove" aria-hidden="true">\n          </span>\n        </button>\n        <h4 class="modal-title" id="myModalLabel">Welcome to AHN2 point cloud viewer!</h4>\n      </div>\n\n      <div class="modal-body">\n        <div ng-show="!helpModal.mobile&&helpModal.chrome" class="panel-body">\n            <p><input type="checkbox" ng-model="helpModal.doNotShow" ng-change="helpModal.dontShowClicked()"> Do not show this message at refresh again.</p>\n            <p>This software is free and open source (<a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License Version 2.0</a>) developed at the <a href="https://www.esciencecenter.nl/">Netherlands eScience Center</a>. For further details, please refer to the <a href="https://github.com/NLeSC/ahn-pointcloud-viewer">GitHub page</a>.</p>\n            <p>Contributions are welcome! If you have some issues or comments, please report these <a href="https://github.com/NLeSC/ahn-pointcloud-viewer/issues">here</a>.</p>\n            <h2>Graphical User Interface</h2>\n            <button onclick="introJs().start()">User interface step-by-step</button>\n            <p>The point cloud viewer consists of several elements:</p>\n            <ul>\n                <li>at the center: <a onclick="introJs().goToStepNumber(1).start()">main display window</a> for point cloud data,</li>\n                <li>top-left: <a onclick="introJs().goToStepNumber(2).start()">search box for a location</a></li>\n                <li>top-right: <a onclick="introJs().goToStepNumber(3).start()">minimap</a></li>\n                <li>bottom-left:\n                    <ul>\n                        <li><a onclick="introJs().goToStepNumber(4).start()">export points</a>,</li>\n                        <li><a onclick="introJs().goToStepNumber(5).start()">settings</a>,</li>\n                        <li><a onclick="introJs().goToStepNumber(6).start()">help</a>,</li>\n                        <li><a onclick="introJs().goToStepNumber(7).start()">toolbox</a></li>\n                    </ul>\n                <li>bottom-middle: two buttons to switch between Google Earth-like controls and keyboard interaction (see <a href="#navigation">below</a>)</li>\n            </ul>\n\n            <h2 id="navigation">Navigation</h2>\n            <div>\n              <p>\n                <b><span class="octicon octicon-inverted octicon-globe"></span>&nbsp;<a onclick="introJs().goToStepNumber(8).start()">Google Earth-like controls</a></b>\n                  <ul>\n                    <li>use the left/right mouse buttons to move or rotate the camera\n                    <li>use the scroll wheel to zoom in/out\n                  </ul>\n              </p>\n              <p>\n                <b><span class="octicon octicon-inverted octicon-keyboard"></span>&nbsp;<a onclick="introJs().goToStepNumber(9).start()">Keyboard interaction</a></b>\n                  <ul>\n                      <li>use the right mouse button to rotate camera</li>\n                      <li>use the arrow or a/s/d/w keys to move left/backward/right/forward</li>\n                      <li>use the q/z keys to move up or down</li>\n                      <li>use the scroll wheel to increases or decreases the field of view</li>\n                      <li>hold down the spacebar to move faster</li>\n                  </ul>\n              </p>\n            </div>\n\n            <h2 id="extract">\n                <span class="glyphicon glyphicon-download inverted-glyphicon"></span>\n                Export points</h2>\n            <div>\n                Select and export points in the LAZ file format. The download URL will be mailed to you as soon as the processing is completed.\n                Points can be selected by one of the three approaches:\n                <ul>\n                    <li>clicking on two points in the minimap,</li>\n                    <li>drawing a box in the 3D point cloud visualization; this only works in the <i>Keyboard interaction</i> navigation mode,</li>\n                    <li>entering the actual coordinates into the input form.</li>\n                </ul>\n\n                Note that the coordinates are based on the <a href="http://epsg.io/28992">Amersfoort/RD new</a> coordinate system.\n                The number of points in the selected area can be equal to or less than the number indicated.\n                The coverage indicates the percentage of point cloud data available for download.\n                Since the number of points one can download is limited ([N]), the resolution of the point cloud data may differ depending on the size of selected area.\n                Therefore, small areas are more likely to be obtained in full resolution (i.e. 10 points per m<sup>2</sup>) than large areas.\n            </div>\n\n            <h2 id="settings">\n                <div class="icon-inline gear-icon"></div>\n                Settings</h2>\n            <div>\n                Settings are grouped into three tabs.\n                <h4>Point</h4>\n                Configure the "look and feel" of points.\n                <h4>Measurement</h4>\n                Configure how measurements are taken.\n                <h4>Misc(ellaneous)</h4>\n                Adjust other settings.\n            </div>\n\n            <h2 id="search">Search location</h2>\n            <p>\n                Locate a landmark (e.g. city, address) by\n                <span class="glyphicon glyphicon-search inverted-glyphicon"></span>.\n                You can also view the data for your current location\n                <span class="glyphicon glyphicon-home inverted-glyphicon"></span>\n                (geolocation must be enabled in your browser).\n            </p>\n\n            <h2 id="minimap">Minimap</h2>\n            <p>\n                Shows the camera field of view as a red trapezoid. Aerial photos are shown by default.\n                Change to road map using the layer switcher (top right corner).\n                Click <span class="glyphicon glyphicon-resize-full"></span> to enlarge the minimap.\n            </p>\n\n            <h2 id="toolbox">\n                <div class="icon-inline toolbox-icon"></div>\n                Toolbox</h2>\n            <div>\n                <ul><li>right-click mouse to select from different measuring tools</li></ul>\n            </div>\n            <div>\n                <div>\n                    <div class="icon-inline distance-icon"></div>\n                    Distance measurement\n                </div>\n                <ul>\n                  <li>left-click mouse to insert a measurement point</li>\n                  <li>right-click mouse to complete the insertion</li>\n                  <li>drag &amp; drop to move the measurement points</il>\n                </ul>\n            </div>\n            <div>\n                <div>\n                    <div class="icon-inline area-icon"></div>\n                    Surface area measurement\n                </div>\n                <ul>\n                  <li>left-click mouse to insert a measurement point</li>\n                  <li>right-click mouse to complete the insertion</li>\n                  <li>drag &amp; drop to move the measurement points</il>\n                </ul>\n            </div>\n            <div>\n                <div>\n                    <div class="icon-inline volume-icon"></div>\n                    Volume measurement\n                </div>\n                <ul>\n                  <li>left-click mouse to insert volume or select inserted volume</li>\n                  <li>switch between translation (icon), scale (icon) and rotation (icon) mode or\n                    use keyboard shortcuts (T, E or R)</li>\n                </ul>\n            </div>\n            <div>\n                <div>\n                    <div class="icon-inline heightprofile-icon"></div>\n                    Height profile\n                </div>\n                <ul>\n                  <li>left-click mouse to insert a profile marker</li>\n                  <li>right-click mouse to complete the insertion</li>\n                  <li>drag &amp; drop to move the profile markers</li>\n                  <li>ctrl+drag upwards/downwards to increase/decrease the profile width</li>\n                </ul>\n                Note: Depending on the <i>Clip mode</i>, points inside the profile are highlighted while points outside the profile are clipped.\n            </div>\n            <div>\n                <div>\n                    <div class="icon-inline clipvolume-icon"></div>\n                    Clip volume\n                </div>\n                <ul>\n                  <li>left-click mouse to insert volume or select inserted volume</li>\n                  <li>switch between translation (icon), scale (icon) and rotation (icon) mode or\n                    use keyboard shortcuts (T, E or R)</li>\n                <ul>\n            </div>\n        </div>\n        <div ng-show="helpModal.mobile" class="panel-body">\n          <p style="color:red">\n            Warning: This 3D visualization requires WebGL, which is not well suited for most mobile browsers. Please view this website on a non-mobile device for better user experience.</div>\n          </p>\n        <div ng-show="!helpModal.mobile&&!helpModal.chrome" class="panel-body">\n          <p style="color:red">\n            Warning: Unfortunately, your web browser is not supported by this viewer. Please use Google Chrome or Microsoft Edge.\n          </p>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),a.put("scripts/logos/logos.directive.html",'<div class="logobox">\n  <a href="http://www.ahn.nl">\n    <img src="images/logos/ahn_inv.png" title="Actueel Hoogtebestand Nederland" width="150"/>\n  </a>\n  <a href="http://www.esciencecenter.nl">\n    <img src="images/logos/nlesc_inv.png" title="Netherlands eScience Center" width="150"/>\n  </a>\n  <a href="http://www.tudelft.nl">\n    <img src="images/logos/tudelft_inv.png" title="TU Delft" width="120" style="position: relative; bottom: -5px;">\n  </a>\n  <a href="http://www.potree.org">\n    <img src="images/logos/potree_logo.png" title="potree" width="150"/>\n  </a>\n</div>\n'),a.put("scripts/measuring/measuring.directive.html",'<div class="toolbox">\n  <button ng-click="measuring.toggleToolbox()" class="icon-big toolbox-icon" ng-class="{active: measuring.showToolboxTray}" data-step="7" data-intro="Toolbox" title="Toolbox"></button>\n</div>\n\n<div class="toolbox-tray tool-icon" collapse=\'!measuring.showToolboxTray\'>\n  <button ng-click="measuring.toggleToolbox()" class="icon-big toolbox-tray-top-icon"></button>\n  <div class="toolbox-tools">\n    <button ng-click="measuring.startDistance()" ng-class="{active: measuring.distanceActive}" class="icon-small distance-icon" title="Start distance measurement"></button>\n    <button ng-click="measuring.startAngle()" ng-class="{active: measuring.angleActive}" class="icon-small angle-icon" title="Start angle measurement"></button>\n    <button ng-click="measuring.startArea()" ng-class="{active: measuring.areaActive}" class="icon-small area-icon" title="Start area measurement"></button>\n    <button ng-click="measuring.startVolume()" ng-class="{active: measuring.volumeActive}" class="icon-small volume-icon" title="Start volume measurement"></button>\n    <!-- <button ng-click="measuring.startHeightProfile()" ng-class="{active: measuring.heightProfileActive}" class="icon-small heightprofile-icon" title="Start heightprofile measurement"></button> -->\n    <!-- <button ng-click="measuring.startClipVolume()" ng-class="{active: measuring.clipVolumeActive}" class="icon-small clipvolume-icon" title="Start clip volume measurement"></button> -->\n  </div>\n</div>\n\n<div class="transformation-toolbox-tray" collapse=\'!measuring.showTransformationToolboxTray\'>\n  <button ng-click="measuring.toggleRotate()" ng-class="{active: measuring.isTransformationRotate()}" class="icon-tiny rotate-icon" title="Change the rotation of the selected area (\'R\' key)"></button>\n  <button ng-click="measuring.toggleTranslate()" ng-class="{active: measuring.isTransformationTranslate()}" class="icon-tiny translate-icon" title="Change the translation of the selected area (\'T\' key)"></button>\n  <button ng-click="measuring.toggleScale()" ng-class="{active: measuring.isTransformationScale()}" class="icon-tiny scale-icon" title="Change the scale of the selected area (\'E\' key)"></button>\n</div>\n'),a.put("scripts/pointcloud/pointcloud-stats.directive.html","<div ng-show='pcs.PointcloudService.settings.showStats'>\n<div>Visible points: {{ pcs.stats.nrPoints }}</div>\n<div>Visible nodes: {{ pcs.stats.nrNodes }}</div>\n<div>3D Scene coordinates (x/y/z): {{ pcs.stats.sceneCoordinates.x }}/{{ pcs.stats.sceneCoordinates.y }}/{{ pcs.stats.sceneCoordinates.z }}</div>\n<div>{{ pcs.stats.lasCoordinates.crs }} coordinates (x/y/z): {{ pcs.stats.lasCoordinates.x }}/{{ pcs.stats.lasCoordinates.y }}/{{ pcs.stats.lasCoordinates.z }}</div>\n</div>\n"),a.put("scripts/searchbox/searchbox.directive.html",'<div class="form-group clickable">\n    <div class="input-group">\n        <input type="search" class="form-control" placeholder="Search location..." ng-model="sp.query" ng-keypress="sp.onQueryKeyPress($event)">\n        <span class="input-group-btn">\n          <button class="btn btn-default" type="button" ng-click="sp.clear()" ng-show="sp.query" title="Clear"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>\n          <button class="btn btn-default" type="button" ng-click="sp.search()" ng-disabled="!sp.query" title="Search"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>\n          <button class="btn btn-default" type="button" ng-click="sp.gotoCurrentLocation()" ng-show="sp.hasGeoLocation" title="Current location"><span class="glyphicon glyphicon-home" aria-hidden="true"></span></button>\n        </span>\n    </div>\n</div>\n'),a.put("scripts/settings/settings.directive.html",'<button class="icon-big gear-icon" ng-class="{ld:sc.ld, sd:sc.sd, md:sc.md, hd:sc.hd, active: sc.showSettings}" ng-click="sc.toggleSettings()" data-step="5" data-intro="Settings" title="Settings"/>\n<div class="panel panel-default settings-panel" collapse=\'!sc.showSettings\'>\n  <div class="panel-heading">\n    Settings</div>\n  <div class="panel-body">\n    <tabset>\n      <tab heading="Point" data-toggle="tooltip" title="Settings related to the display of the points.">\n        <form class="form-horizontal">\n          <div class="form-group" data-toggle="tooltip" title="Set the number of visible points at one time, in Millions.">\n            <label class="col-sm-4 control-label" for="pointCountTarget">\n              Number of points (M)\n            </label>\n            <div class="col-sm-8">\n              <input class="form-control" id="pointCountTarget" max="10.0" min="0.1" ng-model="sc.PointcloudService.settings.pointCountTarget" step="0.1" type="number"/>\n            </div>\n          </div>\n          <div class="form-group" data-toggle="tooltip" title="Set the size modifier of the individual points.">\n            <label class="col-sm-4 control-label" for="pointSize">\n              Point size\n            </label>\n            <div class="col-sm-8">\n              <input class="form-control" id="pointSize" max="3.0" min="0.01" ng-model="sc.PointcloudService.settings.pointSize" step="0.01" type="number"/>\n            </div>\n          </div>\n          <div class="form-group" data-toggle="tooltip" title="Sdet the type of coloration of the points. Please note that for AHN2 only height is useful.">\n            <label class="col-sm-4 control-label" for="pointColorType">\n              Color by\n            </label>\n            <div class="col-sm-8">\n              <select class="form-control" id="pointColorType" ng-model="sc.PointcloudService.settings.pointColorType" ng-options="value as key|lowercase for (key, value) in sc.PointcloudService.settings.pointColorTypes | orderBy:value"/>\n            </div>\n          </div>\n\n        <div class="form-group" data-toggle="tooltip" title="Select the Quality preset. Higher presets require more graphics power.">\n          <label class="col-sm-4 control-label" for="predefinedSettings">\n            Quality\n          </label>\n          <div class="col-sm-8">\n            <select class="form-control" id="predefinedSettings" ng-model="sc.PointcloudService.settings" ng-change="sc.settingsChanged(value)" ng-options="value as key for (key, value) in sc.PointcloudService.predefinedSettings | orderBy:index" ng-init="sc.PointcloudService.settings=sc.PointcloudService.predefinedSettings.STANDARD"/>\n          </div>\n        </div>\n        </form>\n      </tab>\n      <tab heading="Misc" data-toggle="tooltip" title="Settings for miscellaneous things.">\n        <form class="form-horizontal misc">\n          <div class="form-group" data-toggle="tooltip" title="Show the skybox, or don\'t.">\n            <label class="col-sm-8 control-label" for="showSkybox">Show sky\n            </label>\n            <div class="col-sm-4">\n              <input id="showSkybox" ng-model="sc.PointcloudService.settings.showSkybox" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group" data-toggle="tooltip" title="Show additional info about the points visible.">\n            <label class="col-sm-8 control-label" for="showStats">\n              Show info\n            </label>\n            <div class="col-sm-4">\n              <input id="showStats" ng-model="sc.PointcloudService.settings.showStats" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group" data-toggle="tooltip" title="Show the octree grid (for debugging).">\n            <label class="col-sm-8 control-label" for="showBoundingBox" title="Show bounding box of pointcloud octree nodes">\n              Show grid\n            </label>\n            <div class="col-sm-4">\n              <input id="showBoundingBox" ng-model="sc.PointcloudService.settings.showBoundingBox" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group" data-toggle="tooltip" title="Set the default movement speed in keyboard mode.">\n            <label class="col-sm-8 control-label" for="normalSpeedMultiplier">\n              Hovering speed</br>[use arrow key(s)]\n            </label>\n            <div class="col-sm-4">\n              <input class="form-control" id="normalSpeedMultiplier" ng-model="sc.PathControls.NORMAL_MOVEMENT_SPEED_MULTIPLIER" type="number"/>\n            </div>\n          </div>\n          <div class="form-group" data-toggle="tooltip" title="Set the fast (space held) movement speed in keyboard mode.">\n            <label class="col-sm-8 control-label" for="fastSpeedMultiplier">\n              Fast hovering speed</br>[use spacebar+arrow key(s)]\n            </label>\n            <div class="col-sm-4">\n              <input class="form-control" id="fastSpeedMultiplier" ng-model="sc.PathControls.FAST_MOVEMENT_SPEED_MULTIPLIER" type="number"/>\n            </div>\n          </div>\n        </form>\n      </tab>\n    </tabs>\n  </div>\n</div>\n')}]);