!function(){"use strict";angular.module("pattyApp.three",[]).constant("THREE",THREE),angular.module("pattyApp.potree",[]).constant("Potree",Potree),angular.module("pattyApp",["ngAnimate","ngSanitize","ngTouch","ui.bootstrap","pattyApp.logos","pattyApp.searchbox","pattyApp.minimap","pattyApp.measuring","pattyApp.settings","pattyApp.help","pattyApp.cameramodes","pattyApp.pointcloud","pattyApp.extract","pattyApp.biglegend","pattyApp.earthcontrols"]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/)}]).run(["DrivemapService",function(a){a.load()}]),angular.module("pattyApp.templates",[]),angular.module("pattyApp.logos",[]),angular.module("pattyApp.extract",["pattyApp.core","angular-loading-bar","rt.debounce"]),angular.module("pattyApp.utils",["pattyApp.templates","toastr"]),angular.module("pattyApp.core",["pattyApp.utils"]),angular.module("pattyApp.minimap",["pattyApp.core","pattyApp.three"]),angular.module("pattyApp.measuring",["pattyApp.potree","pattyApp.three"]),angular.module("pattyApp.pointcloud",["pattyApp.core","pattyApp.potree","pattyApp.three","pattyApp.measuring","cfp.loadingBar","pattyApp.extract","pattyApp.earthcontrols","pattyApp.utils"]),angular.module("pattyApp.settings",["pattyApp.pointcloud","ngFileUpload"]),angular.module("pattyApp.help",["pattyApp.templates"]),angular.module("pattyApp.cameramodes",["pattyApp.pointcloud"]),angular.module("pattyApp.searchbox",["pattyApp.core","pattyApp.pointcloud"]),angular.module("pattyApp.biglegend",["pattyApp.utils"]),angular.module("pattyApp.earthcontrols",["pattyApp.utils","pattyApp.three","pattyApp.pointcloud"])}(),Potree.Measure=function(){var a=this;THREE.Object3D.call(this),this.points=[],this._showDistances=!0,this._showArea=!0,this._closed=!0,this.maxMarkers=Number.MAX_SAFE_INTEGER,this.spheres=[],this.edges=[],this.sphereLabels=[],this.edgeLabels=[],this.angleLabels=[],this.areaLabel=new Potree.TextSprite(""),this.areaLabel.setBorderColor({r:0,g:255,b:0,a:0}),this.areaLabel.setBackgroundColor({r:0,g:255,b:0,a:0}),this.areaLabel.setTextColor({r:180,g:220,b:180,a:1}),this.areaLabel.material.depthTest=!1,this.areaLabel.material.opacity=1,this.add(this.areaLabel);var b=new THREE.SphereGeometry(.4,10,10);this.color=new THREE.Color(16711680);var c=function(){var b=new THREE.MeshLambertMaterial({shading:THREE.SmoothShading,color:a.color,ambient:11184810,depthTest:!1,depthWrite:!1});return b},d=function(a){a.target.material.emissive.setHex(8947848)},e=function(a){a.target.material.emissive.setHex(0)},f=function(b){var c=b.tool,d=(c.dragstart,c.mouse,c.getMousePointCloudIntersection());if(d){var e=a.spheres.indexOf(c.dragstart.object);a.setPosition(e,d)}},g=function(){};this.addMarker=function(a){this.points.push(a);var h=new THREE.Mesh(b,c());h.addEventListener("move",d),h.addEventListener("leave",e),h.addEventListener("drag",f),h.addEventListener("drop",g),this.add(h),this.spheres.push(h);var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3,new THREE.Vector3),i.colors.push(this.color,this.color,this.color);var j=new THREE.LineBasicMaterial({linewidth:1});j.depthTest=!1;var k=new THREE.Line(i,j);k.visible=!0,this.add(k),this.edges.push(k);var l=new Potree.TextSprite(0);l.setBorderColor({r:0,g:255,b:0,a:0}),l.setBackgroundColor({r:0,g:255,b:0,a:0}),l.material.depthTest=!1,l.visible=!1,this.edgeLabels.push(l),this.add(l);var m=new Potree.TextSprite;m.setBorderColor({r:0,g:255,b:0,a:0}),m.setBackgroundColor({r:0,g:255,b:0,a:0}),m.material.depthTest=!1,m.material.opacity=1,m.visible=!1,this.angleLabels.push(m),this.add(m);var n={type:"marker_added",measurement:this};this.dispatchEvent(n),this.setPosition(this.points.length-1,a)},this.removeMarker=function(a){this.points.splice(a,1),this.remove(this.spheres[a]);var b=0==a?0:a-1;this.remove(this.edges[b]),this.edges.splice(b,1),this.remove(this.edgeLabels[b]),this.edgeLabels.splice(b,1),this.spheres.splice(a,1),this.update()},this.setPosition=function(a,b){var c=this.points[a];c.copy(b);var d={type:"marker_moved",measure:this,index:a,position:b.clone()};this.dispatchEvent(d),this.update()},this.getArea=function(){for(var a=0,b=this.points.length-1,c=0;c<this.points.length;c++){var d=this.points[c],e=this.points[b];a+=(e.x+d.x)*(d.z-e.z),b=c}return Math.abs(a/2)},this.getAngleBetweenLines=function(a,b,c){var d=(new THREE.Vector3).subVectors(b,a),e=(new THREE.Vector3).subVectors(c,a);return d.angleTo(e)},this.update=function(){if(0!==this.points.length){if(1===this.points.length){var b=this.points[0];return void this.spheres[0].position.copy(b)}for(var c=this.points.length-1,d=new THREE.Vector3,e=0;c>=e;e++){var b=this.points[e];d.add(b)}d.divideScalar(this.points.length);for(var e=0;c>=e;e++){var f=e,g=e+1>c?0:e+1,h=0===e?c:e-1,b=this.points[f],i=this.points[g],j=this.points[h],k=this.spheres[f];k.position.copy(b),k.material.color=a.color;var l=this.edges[f];l.material.color=this.color,l.geometry.vertices[0].copy(b),l.geometry.vertices[1].copy(i),l.geometry.verticesNeedUpdate=!0,l.geometry.computeBoundingSphere(),l.visible=c>f||this.closed;var m=this.edgeLabels[e],n=(new THREE.Vector3).add(b);n.add(i),n=n.multiplyScalar(.5);var o=b.distanceTo(i);m.position.copy(n),m.setText(o.toFixed(2)),m.visible=this.showDistances&&(c>f||this.closed)&&this.points.length>=2&&o>0;var p=this.angleLabels[e],q=this.getAngleBetweenLines(b,j,i),r=i.clone().sub(j);r.multiplyScalar(.5),r=j.clone().add(r).sub(b).normalize();var s=Math.min(b.distanceTo(j),b.distanceTo(i));s/=9;var t=b.clone().add(r.multiplyScalar(s));p.position.copy(t);var u=Potree.utils.addCommas((q*(180/Math.PI)).toFixed(1))+"°";p.setText(u),p.visible=this.showAngles&&(c>f||this.closed)&&this.points.length>=3&&q>0}this.areaLabel.position.copy(d),this.areaLabel.visible=this.showArea&&this.points.length>=3;var u=Potree.utils.addCommas(this.getArea().toFixed(1))+"²";this.areaLabel.setText(u)}},this.raycast=function(a,b){for(var c=0;c<this.points.length;c++){var d=this.spheres[c];d.raycast(a,b)}for(var c=0;c<b.length;c++){var e=b[c];e.distance=a.ray.origin.distanceTo(e.point)}b.sort(function(a,b){return a.distance-b.distance})}},Potree.Measure.prototype=Object.create(THREE.Object3D.prototype),Object.defineProperty(Potree.Measure.prototype,"showArea",{get:function(){return this._showArea},set:function(a){this._showArea=a,this.update()}}),Object.defineProperty(Potree.Measure.prototype,"closed",{get:function(){return this._closed},set:function(a){this._closed=a,this.update()}}),Object.defineProperty(Potree.Measure.prototype,"showDistances",{get:function(){return this._showDistances},set:function(a){this._showDistances=a,this.update()}}),Potree.MeasuringTool=function(a,b,c){function d(a){if(m===l.INSERT){var b=k.getMousePointCloudIntersection();if(b){var c=b.clone();k.activeMeasurement.addMarker(c);var a={type:"newpoint",position:c.clone()};k.dispatchEvent(a),k.activeMeasurement.points.length>k.activeMeasurement.maxMarkers&&k.finishInsertion()}}else if(m===l.EXTERNAL_REQUEST){var d=k.getMousePointCloudIntersection();k.externalRequestCallback?(k.externalRequestCallback(d),m=l.DEFAULT,k.externalRequestCallback=null):console.log("ERR: Measuring tool has No callback registered.")}}function e(a){var b=k.domElement.getBoundingClientRect();if(k.mouse.x=(a.clientX-b.left)/k.domElement.clientWidth*2-1,k.mouse.y=2*-((a.clientY-b.top)/k.domElement.clientHeight)+1,k.dragstart){var c={type:"drag",event:a,tool:k};k.dragstart.object.dispatchEvent(c)}else if(m===l.INSERT&&k.activeMeasurement){var d=k.getMousePointCloudIntersection();if(d){var e=k.activeMeasurement.points.length-1;k.activeMeasurement.setPosition(e,d)}}else if(m===l.DEFAULT||m===l.INSERT&&!k.activeMeasurement){var d=j();d?(d.object.dispatchEvent({type:"move",target:d.object,event:a}),k.hoveredElement&&k.hoveredElement!==d.object&&k.hoveredElement.dispatchEvent({type:"leave",target:k.hoveredElement,event:a}),k.hoveredElement=d.object):(k.hoveredElement&&k.hoveredElement.dispatchEvent({type:"leave",target:k.hoveredElement,event:a}),k.hoveredElement=null)}}function f(){m===l.INSERT&&k.finishInsertion()}function g(a){if(1===a.which){m!==l.DEFAULT&&a.stopImmediatePropagation();var b=j();b&&(k.dragstart={object:b.object,sceneClickPos:b.point,sceneStartPos:k.sceneRoot.position.clone(),mousePos:{x:k.mouse.x,y:k.mouse.y}},a.stopImmediatePropagation())}else 3===a.which&&f(a)}function h(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),k.activeMeasurement&&m===l.INSERT&&(k.activeMeasurement.removeMarker(k.activeMeasurement.points.length-1),k.finishInsertion())}function i(a){k.dragstart&&(k.dragstart.object.dispatchEvent({type:"drop",event:a}),k.dragstart=null)}function j(){var a=new THREE.Vector3(k.mouse.x,k.mouse.y,.5);a.unproject(k.camera);var b=new THREE.Raycaster;b.ray.set(k.camera.position,a.sub(k.camera.position).normalize());for(var c=[],d=0;d<k.measurements.length;d++)for(var e=k.measurements[d],f=0;f<e.spheres.length;f++)c.push(e.spheres[f]);var g=b.intersectObjects(c,!0);return g.length>0?g[0]:!1}var k=this;this.enabled=!1,this.scene=a,this.camera=b,this.renderer=c,this.domElement=c.domElement,this.mouse={x:0,y:0};var l={DEFAULT:0,INSERT:1,EXTERNAL_REQUEST:2},m=l.DEFAULT;this.activeMeasurement,this.measurements=[],this.sceneMeasurement=new THREE.Scene,this.sceneRoot=new THREE.Object3D,this.sceneMeasurement.add(this.sceneRoot),this.light=new THREE.DirectionalLight(16777215,1),this.light.position.set(0,0,10),this.light.lookAt(new THREE.Vector3(0,0,0)),this.sceneMeasurement.add(this.light),this.hoveredElement=null,this.externalRequestCallback=null,this.requestClickLocation=function(a){null===this.externalRequestCallback?(this.externalRequestCallback=a,m=l.EXTERNAL_REQUEST):console.log("WARN: Measuring tool already has an outstanding request. New request ignored.")},this.getState=function(){return m},this.getMousePointCloudIntersection=function(){var a=new THREE.Vector3(k.mouse.x,k.mouse.y,.5);a.unproject(k.camera);var b=a.sub(k.camera.position).normalize(),c=new THREE.Ray(k.camera.position,b),d=[];k.scene.traverse(function(a){(a instanceof Potree.PointCloudOctree||a instanceof Potree.PointCloudArena4D)&&d.push(a)});for(var e=null,f=null,g=0;g<d.length;g++){var h=d[g],i=h.pick(k.renderer,k.camera,c);if(i){var j=k.camera.position.distanceTo(i.position);(!e||f>j)&&(e=i,f=j)}}return e?e.position:null},this.startInsertion=function(a){if(m===l.DEFAULT){m=l.INSERT;var a=a||{},b="undefined"!=typeof a.showDistances?a.showDistances:!0,c="undefined"!=typeof a.showArea?a.showArea:!1,d="undefined"!=typeof a.showAngles?a.showAngles:!1,e="undefined"!=typeof a.closed?a.closed:!1,f=a.maxMarkers||Number.MAX_SAFE_INTEGER,g=new Potree.Measure;g.showDistances=b,g.showArea=c,g.showAngles=d,g.closed=e,g.maxMarkers=f,this.addMeasurement(g),g.addMarker(new THREE.Vector3(0,0,0)),this.activeMeasurement=g}},this.finishInsertion=function(){this.activeMeasurement.removeMarker(this.activeMeasurement.points.length-1);var a={type:"insertion_finished",measurement:this.activeMeasurement};this.dispatchEvent(a),this.activeMeasurement=null,m=l.DEFAULT},this.addMeasurement=function(a){this.sceneMeasurement.add(a),this.measurements.push(a),this.dispatchEvent({type:"measurement_added",measurement:a}),a.addEventListener("marker_added",function(a){k.dispatchEvent(a)}),a.addEventListener("marker_removed",function(a){k.dispatchEvent(a)}),a.addEventListener("marker_moved",function(a){k.dispatchEvent(a)})},this.removeMeasurement=function(a){this.sceneMeasurement.remove(a);var b=this.measurements.indexOf(a);b>=0&&this.measurements.splice(b,1)},this.reset=function(){for(var a=this.measurements.length-1;a>=0;a--){var b=this.measurements[a];this.removeMeasurement(b)}},this.update=function(){for(var a=[],b=0;b<this.measurements.length;b++)a.push(this.measurements[b]);this.activeMeasurement&&a.push(this.activeMeasurement);for(var b=0;b<a.length;b++){for(var d=a[b],e=0;e<d.spheres.length;e++){var f=d.spheres[e],g=k.camera.position.distanceTo(f.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=15/h;f.scale.set(i,i,i)}for(var e=0;e<d.edgeLabels.length;e++){var j=d.edgeLabels[e],g=k.camera.position.distanceTo(j.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=70/h;j.scaleFactor=i/100}for(var e=0;e<d.edgeLabels.length;e++){var j=d.angleLabels[e],g=k.camera.position.distanceTo(j.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=70/h;j.scaleFactor=i/100}var g=k.camera.position.distanceTo(d.areaLabel.getWorldPosition()),h=projectedRadius(1,k.camera.fov*Math.PI/180,g,c.domElement.clientHeight),i=80/h;d.areaLabel.scaleFactor=i/100}this.light.position.copy(this.camera.position),this.light.lookAt(this.camera.getWorldDirection().add(this.camera.position))},this.render=function(){this.update(),c.render(this.sceneMeasurement,this.camera)},this.domElement.addEventListener("click",d,!1),this.domElement.addEventListener("dblclick",h,!1),this.domElement.addEventListener("mousemove",e,!1),this.domElement.addEventListener("mousedown",g,!1),this.domElement.addEventListener("mouseup",i,!0)},Potree.MeasuringTool.prototype=Object.create(THREE.EventDispatcher.prototype),Potree.TextSprite=function(a){THREE.Object3D.call(this);var b=new THREE.Texture;b.minFilter=THREE.LinearFilter,b.magFilter=THREE.LinearFilter;var c=new THREE.SpriteMaterial({map:b,useScreenCoordinates:!1});this.material=c,this.sprite=new THREE.Sprite(c),this.add(this.sprite),this.borderThickness=4,this.fontface="Arial",this.fontsize=28,this.borderColor={r:0,g:0,b:0,a:1},this.backgroundColor={r:255,g:255,b:255,a:1},this.textColor={r:255,g:255,b:255,a:1},this.text="",this.scaleFactor=1,this.setText(a)},Potree.TextSprite.prototype=new THREE.Object3D,Potree.TextSprite.prototype.setText=function(a){this.text=a,this.update()},Potree.TextSprite.prototype.setTextColor=function(a){this.textColor=a,this.update()},Potree.TextSprite.prototype.setBorderColor=function(a){this.borderColor=a,this.update()},Potree.TextSprite.prototype.setBackgroundColor=function(a){this.backgroundColor=a,this.update()},Potree.TextSprite.prototype.update=function(){var a=document.createElement("canvas"),b=a.getContext("2d");b.font="Bold "+this.fontsize+"px "+this.fontface;var c=b.measureText(this.text),d=c.width,e=d+2*this.borderThickness,f=1.4*this.fontsize+2*this.borderThickness,a=document.createElement("canvas"),b=a.getContext("2d");b.canvas.width=e,b.canvas.height=f,b.font="Bold "+this.fontsize+"px "+this.fontface,b.fillStyle="rgba("+this.backgroundColor.r+","+this.backgroundColor.g+","+this.backgroundColor.b+","+this.backgroundColor.a+")",b.strokeStyle="rgba("+this.borderColor.r+","+this.borderColor.g+","+this.borderColor.b+","+this.borderColor.a+")",b.lineWidth=this.borderThickness,this.roundRect(b,this.borderThickness/2,this.borderThickness/2,d+this.borderThickness,1.4*this.fontsize+this.borderThickness,6),b.strokeStyle="rgba(0, 0, 0, 1.0)",b.strokeText(this.text,this.borderThickness,this.fontsize+this.borderThickness),b.fillStyle="rgba("+this.textColor.r+","+this.textColor.g+","+this.textColor.b+","+this.textColor.a+")",b.fillText(this.text,this.borderThickness,this.fontsize+this.borderThickness);var g=new THREE.Texture(a);g.minFilter=THREE.LinearFilter,g.magFilter=THREE.LinearFilter,g.needsUpdate=!0,this.sprite.material.map=g,this.sprite.scale.set(e*this.scaleFactor,f*this.scaleFactor,1)},Potree.TextSprite.prototype.roundRect=function(a,b,c,d,e,f){a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.closePath(),a.fill(),a.stroke()},function(){"use strict";function a(a){this.publish=function(){return a.$emit.apply(a,arguments)},this.subscribe=function(){return a.$on.apply(a,arguments)}}a.$inject=["$rootScope"],angular.module("pattyApp.utils").service("Messagebus",a)}(),function(){"use strict";function a(){return function(a,b){return b=+b,a.slice(b)}}angular.module("pattyApp.utils").filter("startFrom",a)}(),function(){"use strict";function a(a){this.bingMapsKey="Am6kAyf_AScih8y3ElNRSDpQ9xMJ8jn4yeePDKdHzhsNU4u7Jm-Ac8LJooYKmhbY",this.culture="nl",this.boundingBox={minlon:3.37,minlat:50.75,maxlon:7.21,maxlat:53.47},this.geocodeUrl=function(a){var b="http://dev.virtualearth.net/REST/v1/Locations?";return b+="jsonp=JSON_CALLBACK",b=b+"&q="+a,b=b+"&key="+this.bingMapsKey,this.culture&&(b=b+"&c="+this.culture),b},this.geocode=function(b){var c=this.geocodeUrl(b),d=this.boundingBox;return a.jsonp(c).then(function(a){var b=a.data.resourceSets[0].resources,c=b.filter(function(a){var b=a.point.coordinates[0],c=a.point.coordinates[1];return d.minlat<=b&&b<=d.maxlat&&d.minlon<=c&&c<=d.maxlon});return c})}}a.$inject=["$http"],angular.module("pattyApp.utils").service("BingGeoCoderService",a)}(),function(){"use strict";angular.module("pattyApp.core").constant("proj4",proj4).constant("ol",ol).constant("pattyConf",{DRIVEMAP_JSON_URL:"data/drivemap.json",AHN_API_ENDPOINT:"http://ahn2.pointclouds.nl/api"})}(),function(){"use strict";function a(a,b,c,d,e){var f=this;this.data={};var g=b.defer();this.ready=g.promise,this.load=function(){return a.get(e.DRIVEMAP_JSON_URL).success(this.onLoad).error(this.onLoadFailure)},this.onLoad=function(a){f.data=a,f.registerProj4(),g.resolve(a)},this.onLoadFailure=function(){c.log("Failed to load drive map!!"),g.reject.apply(this,arguments)},this.registerProj4=function(){d.defs(this.getCrs(),this.data.features[0].properties.proj4)},this.getPointcloudUrl=function(){return this.data.features[0].properties.pointcloud},this.getCameraPath=function(){return this.data.features[0].geometry.coordinates},this.getLookPath=function(){return this.data.features[0].properties.lookatpath},this.getCrs=function(){return this.data.crs.properties.name}}a.$inject=["$http","$q","$log","proj4","pattyConf"],angular.module("pattyApp.core").service("DrivemapService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/logos/logos.directive.html"}}angular.module("pattyApp.logos").directive("logoBoxDirective",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/searchbox/searchbox.directive.html",controller:"SearchPanelController",controllerAs:"sp"}}angular.module("pattyApp.searchbox").directive("pattySearchPanel",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){this.query="",this.hasGeoLocation="geolocation"in e.navigator,this.clear=function(){this.query=""},this.onLocationResponse=function(a){if(0===a.length)return void f.warning("No results","Location not found");var b=a[0];this.query=b.name.replace(", Nederland","");var c=b.point.coordinates;this.gotoLocation(c[1],c[0])},this.search=function(){a.geocode(this.query).then(this.onLocationResponse.bind(this),function(){f.error("Search failed","for some reason")})},this.onQueryKeyPress=function(a){var b=13;a.keyCode===b&&this.search()},this.gotoLocation=function(a,d){var e=0,f="EPSG:4326",i=[a,d],j="EPSG:28992",k=h(f,j,i),l=new g.Vector3(k[0],k[1],e),m=b.toLocal(l),n=0,o=-1e3,p=1e3,q=[k[0]+n,k[1]+o],r=b.toLocal(new g.Vector3(q[0],q[1],e+p));c.moveTo(r),c.lookat(m)},this.gotoCurrentLocation=function(){e.navigator.geolocation.getCurrentPosition(function(a){var b=a.coords;this.gotoLocation(b.longitude,b.latitude)}.bind(this),function(){f.error("Unable to get current location")})}}a.$inject=["BingGeoCoderService","SceneService","PathControls","Messagebus","$window","toastr","THREE","proj4"],angular.module("pattyApp.searchbox").controller("SearchPanelController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/settings/settings.directive.html",controller:"SettingsController",controllerAs:"sc"}}angular.module("pattyApp.settings").directive("pattySettings",a)}(),function(){"use strict";function a(a,b,c,d){this.showSettings=!1,this.PointcloudService=a,this.PathControls=c,this.RailService=d,this.measure=b,this.settingsChanged=function(){this.sd=!1,this.md=!1,this.hd=!1,this.PointcloudService.settings===this.PointcloudService.predefinedSettings.LOW?this.sd=!0:this.PointcloudService.settings===this.PointcloudService.predefinedSettings.MEDIUM?this.md=!0:this.PointcloudService.settings===this.PointcloudService.predefinedSettings.HIGH&&(this.hd=!0)}.bind(this),this.sd=!0,this.md=!1,this.hd=!1}a.$inject=["PointcloudService","MeasuringService","PathControls","RailService"],angular.module("pattyApp.settings").controller("SettingsController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/help/help.directive.html",controller:"HelpController",controllerAs:"hc"}}angular.module("pattyApp.help").directive("pattyHelp",a)}(),function(){"use strict";function a(){this.showHelp=!1}angular.module("pattyApp.help").controller("HelpController",a)}(),function(){"use strict";function a(a,b){this.camFrustum=new a.geom.LineString([[0,0],[1,0],[0,1]]);var c=new a.source.Vector({features:[new a.Feature(this.camFrustum)]});this.layer=new a.layer.Vector({source:c,style:new a.style.Style({stroke:new a.style.Stroke({color:"red",width:2})})}),this.setColor=function(a){this.layer.style.stroke.color=a},this.getExtent=function(){return c.getExtent()},this.getCameraPosition=function(){var a=1e5,c=this.camFrustum.getCoordinates(),d=new b.Vector3(c[0][0],c[0][1],0),e=new b.Vector3(c[1][0],c[1][1],0),f=new b.Vector3(c[2][0],c[2][1],0),g=new b.Vector3(c[3][0],c[3][1],0),h=d.clone().lerp(e,.5),i=f.clone().lerp(g,.5),j=h.clone().sub(i).length();j>a&&(j=a);var k=1-j/a,l=h.clone().lerp(i,k);return l.toArray().slice(0,2)},this.onCameraMove=function(a,b){var c=a.map(function(a){return[a.x,a.y]});this.layer.getStyle().getStroke().setLineDash(b?[]:[6]),c.push(c[0]),this.camFrustum.setCoordinates(c)}}a.$inject=["ol","THREE"],angular.module("pattyApp.minimap").service("CamFrustumService",a)}(),function(){"use strict";function a(){return{restrict:"E",link:function(a,b){a.vm.map.setTarget(b[0])},controller:"MinimapController",controllerAs:"vm"}}angular.module("pattyApp.minimap").directive("pattyMinimap",a)}(),function(){"use strict";function a(a,b,c,d,e){b.defs("EPSG:28992","+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs");for(var f=a.proj.get("EPSG:28992"),g=[-285401.92,22598.08,595401.9199999999,903401.9199999999],h=[3440.64,1720.32,860.16,430.08,215.04,107.52,53.76,26.88,13.44,6.72,3.36,1.68,.84,.42],i=new Array(14),j=0;15>j;++j)i[j]="EPSG:28992:"+j;for(var k=new Array(14),l=0;15>l;++l)k[l]=10>l?"0"+l:""+l;var m=a.proj.get("EPSG:28992");m.setExtent([646.36,308975.28,276050.82,636456.31]);var n=a.proj.transform([4.451,51.777],"EPSG:4326","EPSG:28992");this.osmLayer={};var o=new a.layer.Group({title:"Base maps",layers:[new a.layer.Tile({title:"NederlandBRT",type:"base",visible:!0,extent:g,source:new a.source.WMTS({url:"http://geodata.nationaalgeoregister.nl/tiles/service/wmts/brtachtergrondkaart",layer:"brtachtergrondkaart",matrixSet:"EPSG:28992",format:"image/png",projection:f,tileGrid:new a.tilegrid.WMTS({origin:a.extent.getTopLeft(g),resolutions:h,matrixIds:i})})}),this.osmLayer=new a.layer.Tile({title:"Luchtfotos",type:"base",visible:!1,source:new a.source.WMTS({url:"http://geodata1.nationaalgeoregister.nl/luchtfoto/wmts",layer:"luchtfoto",matrixSet:"nltilingschema",format:"image/jpeg",projection:f,tileGrid:new a.tilegrid.WMTS({origin:a.extent.getTopLeft(g),resolutions:h,matrixIds:k}),style:"default"})})]});this.map=new a.Map({maxExtent:g,layers:o,theme:null,maxResolution:860.16,numZoomLevels:12,units:"m",displayProjection:f,view:new a.View({center:n,zoom:12,minZoom:6})}),this.setupResizeControl=function(){function b(b){var c=b||{},d=document.createElement("button");d.innerHTML='<span class="glyphicon glyphicon-resize-full"></span>';var e=this,f=!1,g=function(){f=!f,f?(e.getMap().getTarget().classList.add("big-minimap"),d.innerHTML='<span class="glyphicon glyphicon-resize-small"></span>'):(e.getMap().getTarget().classList.remove("big-minimap"),d.innerHTML='<span class="glyphicon glyphicon-resize-full"></span>'),e.getMap().updateSize()};d.addEventListener("click",g,!1),d.addEventListener("touchstart",g,!1);var h=document.createElement("div");h.className="resize-minimap ol-unselectable ol-control",h.appendChild(d),a.control.Control.call(this,{element:h,target:c.target})}a.inherits(b,a.control.Control),this.map.addControl(new b)},this.setupResizeControl();var p=new a.control.LayerSwitcher({tipLabel:"Legend"});this.map.addControl(p),this.map.addLayer(c.layer),this.centerMap=function(a){this.map.getView().setCenter(a)},this.updateFrustrumAndCenterMap=function(a,b,d){c.onCameraMove(b,d);var e=c.getExtent();this.map.getView().fit(e,this.map.getSize(),{padding:[20,20,20,20]});var f=c.getCameraPosition();this.centerMap(f)},d.subscribe("cameraMoved",this.updateFrustrumAndCenterMap.bind(this)),e.init(this.map)}a.$inject=["ol","proj4","CamFrustumService","Messagebus","MinimapExtractionSelectionService"],angular.module("pattyApp.minimap").controller("MinimapController",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){var c=new a.Vector3(z.x,z.y,.5);c.unproject(u);var d=c.sub(u.position).normalize(),e=new a.Ray(u.position,d),f=[];v.traverse(function(a){a instanceof b.PointCloudOctree&&f.push(a)});for(var g=null,h=null,i=0;i<f.length;i++){var j=f[i],k=j.pick(t.renderer,u,e,{accuracy:.5});if(k){var l=u.position.distanceTo(k.position);(!g||h>l)&&(g=k,h=l)}}return g?g.position:null}function q(){if(t.settings.showStats){w?(t.stats.nrPoints=w.numVisiblePoints,t.stats.nrNodes=w.numVisibleNodes):(t.stats.nrPoints="none",t.stats.nrNodes="none");var a=p();if(a){var b=a;t.stats.sceneCoordinates.x=b.x.toFixed(2),t.stats.sceneCoordinates.y=b.y.toFixed(2),t.stats.sceneCoordinates.z=b.z.toFixed(2);var c=g.toGeo(b);t.stats.lasCoordinates.x=c.x.toFixed(2),t.stats.lasCoordinates.y=c.y.toFixed(2),t.stats.lasCoordinates.z=c.z.toFixed(2)}d.$digest()}}function r(a){z.x=a.clientX/t.renderer.domElement.clientWidth*2-1,z.y=2*-(a.clientY/t.renderer.domElement.clientHeight)+1}b.Gradients.VIRIDIS=[[0,new a.Color(.267,.0049,.3294)],[.0039,new a.Color(.2685,.0096,.3354)],[.0078,new a.Color(.2699,.0146,.3414)],[.0118,new a.Color(.2713,.0199,.3473)],[.0157,new a.Color(.2726,.0256,.3531)],[.0196,new a.Color(.2738,.0315,.3589)],[.0235,new a.Color(.275,.0378,.3645)],[.0275,new a.Color(.276,.0442,.3702)],[.0314,new a.Color(.277,.0503,.3757)],[.0353,new a.Color(.2779,.0563,.3812)],[.0392,new a.Color(.2788,.0621,.3866)],[.0431,new a.Color(.2796,.0678,.3919)],[.0471,new a.Color(.2803,.0734,.3972)],[.051,new a.Color(.2809,.0789,.4023)],[.0549,new a.Color(.2814,.0843,.4074)],[.0588,new a.Color(.2819,.0897,.4124)],[.0627,new a.Color(.2823,.095,.4173)],[.0667,new a.Color(.2827,.1002,.4222)],[.0706,new a.Color(.2829,.1054,.4269)],[.0745,new a.Color(.2831,.1106,.4316)],[.0784,new a.Color(.2832,.1157,.4361)],[.0824,new a.Color(.2832,.1208,.4406)],[.0863,new a.Color(.2832,.1258,.445)],[.0902,new a.Color(.2831,.1309,.4492)],[.0941,new a.Color(.2829,.1359,.4534)],[.098,new a.Color(.2826,.1409,.4575)],[.102,new a.Color(.2823,.1459,.4615)],[.1059,new a.Color(.2819,.1509,.4654)],[.1098,new a.Color(.2814,.1558,.4692)],[.1137,new a.Color(.2809,.1608,.4729)],[.1176,new a.Color(.2803,.1657,.4765)],[.1216,new a.Color(.2796,.1706,.48)],[.1255,new a.Color(.2788,.1755,.4834)],[.1294,new a.Color(.278,.1804,.4867)],[.1333,new a.Color(.2771,.1852,.4899)],[.1373,new a.Color(.2762,.1901,.493)],[.1412,new a.Color(.2752,.1949,.496)],[.1451,new a.Color(.2741,.1997,.4989)],[.149,new a.Color(.273,.2045,.5017)],[.1529,new a.Color(.2718,.2093,.5044)],[.1569,new a.Color(.2706,.2141,.5071)],[.1608,new a.Color(.2693,.2188,.5096)],[.1647,new a.Color(.268,.2235,.512)],[.1686,new a.Color(.2666,.2283,.5143)],[.1725,new a.Color(.2651,.233,.5166)],[.1765,new a.Color(.2637,.2376,.5188)],[.1804,new a.Color(.2621,.2423,.5208)],[.1843,new a.Color(.2606,.2469,.5228)],[.1882,new a.Color(.259,.2515,.5247)],[.1922,new a.Color(.2573,.2561,.5266)],[.1961,new a.Color(.2556,.2607,.5283)],[.2,new a.Color(.2539,.2653,.53)],[.2039,new a.Color(.2522,.2698,.5316)],[.2078,new a.Color(.2504,.2743,.5331)],[.2118,new a.Color(.2486,.2788,.5346)],[.2157,new a.Color(.2468,.2832,.5359)],[.2196,new a.Color(.245,.2877,.5373)],[.2235,new a.Color(.2431,.2921,.5385)],[.2275,new a.Color(.2412,.2965,.5397)],[.2314,new a.Color(.2393,.3009,.5408)],[.2353,new a.Color(.2374,.3052,.5419)],[.2392,new a.Color(.2355,.3095,.5429)],[.2431,new a.Color(.2336,.3138,.5439)],[.2471,new a.Color(.2317,.3181,.5448)],[.251,new a.Color(.2297,.3224,.5457)],[.2549,new a.Color(.2278,.3266,.5465)],[.2588,new a.Color(.2259,.3308,.5473)],[.2627,new a.Color(.2239,.335,.5481)],[.2667,new a.Color(.222,.3392,.5488)],[.2706,new a.Color(.2201,.3433,.5494)],[.2745,new a.Color(.2181,.3474,.55)],[.2784,new a.Color(.2162,.3515,.5506)],[.2824,new a.Color(.2143,.3556,.5512)],[.2863,new a.Color(.2124,.3597,.5517)],[.2902,new a.Color(.2105,.3637,.5522)],[.2941,new a.Color(.2086,.3678,.5527)],[.298,new a.Color(.2068,.3718,.5531)],[.302,new a.Color(.2049,.3757,.5535)],[.3059,new a.Color(.2031,.3797,.5539)],[.3098,new a.Color(.2012,.3837,.5543)],[.3137,new a.Color(.1994,.3876,.5546)],[.3176,new a.Color(.1976,.3915,.555)],[.3216,new a.Color(.1959,.3954,.5553)],[.3255,new a.Color(.1941,.3993,.5556)],[.3294,new a.Color(.1924,.4032,.5558)],[.3333,new a.Color(.1906,.4071,.5561)],[.3373,new a.Color(.1889,.4109,.5563)],[.3412,new a.Color(.1872,.4147,.5565)],[.3451,new a.Color(.1856,.4186,.5568)],[.349,new a.Color(.1839,.4224,.5569)],[.3529,new a.Color(.1823,.4262,.5571)],[.3569,new a.Color(.1806,.43,.5573)],[.3608,new a.Color(.179,.4338,.5574)],[.3647,new a.Color(.1774,.4375,.5576)],[.3686,new a.Color(.1758,.4413,.5577)],[.3725,new a.Color(.1743,.445,.5578)],[.3765,new a.Color(.1727,.4488,.5579)],[.3804,new a.Color(.1712,.4525,.558)],[.3843,new a.Color(.1696,.4563,.558)],[.3882,new a.Color(.1681,.46,.5581)],[.3922,new a.Color(.1666,.4637,.5581)],[.3961,new a.Color(.1651,.4674,.5581)],[.4,new a.Color(.1636,.4711,.5581)],[.4039,new a.Color(.1621,.4748,.5581)],[.4078,new a.Color(.1607,.4785,.5581)],[.4118,new a.Color(.1592,.4822,.5581)],[.4157,new a.Color(.1577,.4859,.558)],[.4196,new a.Color(.1563,.4896,.5579)],[.4235,new a.Color(.1548,.4933,.5578)],[.4275,new a.Color(.1534,.497,.5577)],[.4314,new a.Color(.1519,.5007,.5576)],[.4353,new a.Color(.1505,.5044,.5574)],[.4392,new a.Color(.149,.5081,.5573)],[.4431,new a.Color(.1476,.5117,.557)],[.4471,new a.Color(.1462,.5154,.5568)],[.451,new a.Color(.1448,.5191,.5566)],[.4549,new a.Color(.1433,.5228,.5563)],[.4588,new a.Color(.1419,.5265,.556)],[.4627,new a.Color(.1405,.5301,.5557)],[.4667,new a.Color(.1391,.5338,.5553)],[.4706,new a.Color(.1378,.5375,.5549)],[.4745,new a.Color(.1364,.5412,.5545)],[.4784,new a.Color(.1351,.5449,.554)],[.4824,new a.Color(.1337,.5485,.5535)],[.4863,new a.Color(.1324,.5522,.553)],[.4902,new a.Color(.1312,.5559,.5525)],[.4941,new a.Color(.1299,.5596,.5519)],[.498,new a.Color(.1287,.5633,.5512)],[.502,new a.Color(.1276,.5669,.5506)],[.5059,new a.Color(.1265,.5706,.5498)],[.5098,new a.Color(.1254,.5743,.5491)],[.5137,new a.Color(.1244,.578,.5483)],[.5176,new a.Color(.1235,.5817,.5474)],[.5216,new a.Color(.1226,.5854,.5466)],[.5255,new a.Color(.1218,.5891,.5456)],[.5294,new a.Color(.1211,.5927,.5446)],[.5333,new a.Color(.1206,.5964,.5436)],[.5373,new a.Color(.1201,.6001,.5425)],[.5412,new a.Color(.1197,.6038,.5414)],[.5451,new a.Color(.1195,.6075,.5402)],[.549,new a.Color(.1194,.6111,.539)],[.5529,new a.Color(.1195,.6148,.5377)],[.5569,new a.Color(.1197,.6185,.5363)],[.5608,new a.Color(.1201,.6222,.5349)],[.5647,new a.Color(.1206,.6258,.5335)],[.5686,new a.Color(.1214,.6295,.532)],[.5725,new a.Color(.1223,.6332,.5304)],[.5765,new a.Color(.1234,.6368,.5288)],[.5804,new a.Color(.1248,.6405,.5271)],[.5843,new a.Color(.1263,.6441,.5253)],[.5882,new a.Color(.1281,.6477,.5235)],[.5922,new a.Color(.1301,.6514,.5216)],[.5961,new a.Color(.1323,.655,.5197)],[.6,new a.Color(.1347,.6586,.5176)],[.6039,new a.Color(.1373,.6623,.5156)],[.6078,new a.Color(.1402,.6659,.5134)],[.6118,new a.Color(.1433,.6695,.5112)],[.6157,new a.Color(.1466,.673,.5089)],[.6196,new a.Color(.1501,.6766,.5066)],[.6235,new a.Color(.1539,.6802,.5042)],[.6275,new a.Color(.1579,.6838,.5017)],[.6314,new a.Color(.162,.6873,.4991)],[.6353,new a.Color(.1664,.6909,.4965)],[.6392,new a.Color(.1709,.6944,.4938)],[.6431,new a.Color(.1757,.6979,.491)],[.6471,new a.Color(.1807,.7014,.4882)],[.651,new a.Color(.1858,.7049,.4853)],[.6549,new a.Color(.1911,.7084,.4823)],[.6588,new a.Color(.1966,.7118,.4792)],[.6627,new a.Color(.2022,.7153,.4761)],[.6667,new a.Color(.208,.7187,.4729)],[.6706,new a.Color(.214,.7221,.4696)],[.6745,new a.Color(.2201,.7255,.4662)],[.6784,new a.Color(.2264,.7289,.4628)],[.6824,new a.Color(.2328,.7322,.4593)],[.6863,new a.Color(.2394,.7356,.4557)],[.6902,new a.Color(.2461,.7389,.452)],[.6941,new a.Color(.2529,.7422,.4483)],[.698,new a.Color(.2599,.7455,.4445)],[.702,new a.Color(.2669,.7488,.4406)],[.7059,new a.Color(.2741,.752,.4366)],[.7098,new a.Color(.2815,.7552,.4326)],[.7137,new a.Color(.2889,.7584,.4284)],[.7176,new a.Color(.2965,.7616,.4242)],[.7216,new a.Color(.3041,.7647,.4199)],[.7255,new a.Color(.3119,.7678,.4156)],[.7294,new a.Color(.3198,.7709,.4112)],[.7333,new a.Color(.3278,.774,.4066)],[.7373,new a.Color(.3359,.777,.402)],[.7412,new a.Color(.3441,.78,.3974)],[.7451,new a.Color(.3524,.783,.3926)],[.749,new a.Color(.3607,.786,.3878)],[.7529,new a.Color(.3692,.7889,.3829)],[.7569,new a.Color(.3778,.7918,.3779)],[.7608,new a.Color(.3864,.7946,.3729)],[.7647,new a.Color(.3952,.7975,.3678)],[.7686,new a.Color(.404,.8003,.3626)],[.7725,new a.Color(.4129,.803,.3573)],[.7765,new a.Color(.4219,.8058,.3519)],[.7804,new a.Color(.431,.8085,.3465)],[.7843,new a.Color(.4401,.8111,.341)],[.7882,new a.Color(.4494,.8138,.3354)],[.7922,new a.Color(.4587,.8164,.3297)],[.7961,new a.Color(.4681,.8189,.324)],[.8,new a.Color(.4775,.8214,.3182)],[.8039,new a.Color(.487,.8239,.3123)],[.8078,new a.Color(.4966,.8264,.3064)],[.8118,new a.Color(.5063,.8288,.3004)],[.8157,new a.Color(.516,.8312,.2943)],[.8196,new a.Color(.5258,.8335,.2881)],[.8235,new a.Color(.5356,.8358,.2819)],[.8275,new a.Color(.5455,.838,.2756)],[.8314,new a.Color(.5555,.8403,.2693)],[.8353,new a.Color(.5655,.8424,.2629)],[.8392,new a.Color(.5756,.8446,.2564)],[.8431,new a.Color(.5857,.8467,.2499)],[.8471,new a.Color(.5958,.8487,.2433)],[.851,new a.Color(.606,.8507,.2367)],[.8549,new a.Color(.6163,.8527,.2301)],[.8588,new a.Color(.6266,.8546,.2234)],[.8627,new a.Color(.6369,.8565,.2166)],[.8667,new a.Color(.6473,.8584,.2099)],[.8706,new a.Color(.6576,.8602,.2031)],[.8745,new a.Color(.6681,.862,.1963)],[.8784,new a.Color(.6785,.8637,.1895)],[.8824,new a.Color(.6889,.8654,.1827)],[.8863,new a.Color(.6994,.8671,.176)],[.8902,new a.Color(.7099,.8688,.1693)],[.8941,new a.Color(.7204,.8704,.1626)],[.898,new a.Color(.7309,.8719,.156)],[.902,new a.Color(.7414,.8734,.1496)],[.9059,new a.Color(.7519,.875,.1432)],[.9098,new a.Color(.7624,.8764,.1371)],[.9137,new a.Color(.7729,.8779,.1311)],[.9176,new a.Color(.7833,.8793,.1254)],[.9216,new a.Color(.7938,.8807,.12)],[.9255,new a.Color(.8042,.882,.115)],[.9294,new a.Color(.8146,.8834,.1103)],[.9333,new a.Color(.8249,.8847,.1062)],[.9373,new a.Color(.8353,.886,.1026)],[.9412,new a.Color(.8456,.8873,.0997)],[.9451,new a.Color(.8558,.8886,.0975)],[.949,new a.Color(.866,.8899,.096)],[.9529,new a.Color(.8762,.8911,.0953)],[.9569,new a.Color(.8863,.8924,.0954)],[.9608,new a.Color(.8963,.8936,.0963)],[.9647,new a.Color(.9063,.8949,.0981)],[.9686,new a.Color(.9162,.8961,.1007)],[.9725,new a.Color(.9261,.8973,.1041)],[.9765,new a.Color(.9359,.8986,.1081)],[.9804,new a.Color(.9456,.8998,.1128)],[.9843,new a.Color(.9553,.9011,.1181)],[.9882,new a.Color(.9649,.9023,.1239)],[.9922,new a.Color(.9744,.9036,.1302)],[.9961,new a.Color(.9839,.9049,.1369)],[1,new a.Color(.9932,.9062,.1439)]];

var s={Splats:"Splats",Low:"Circle"},t=this;this.elRenderArea=null,t.settings={pointCountTarget:2.5,pointSize:1,opacity:1,showSkybox:!0,interpolate:!1,showStats:!1,highQuality:!1,showBoundingBox:!1,pointColorTypes:b.PointColorType,clipModes:b.ClipMode,pointSizeType:b.PointSizeType.ADAPTIVE,pointColorType:b.PointColorType.HEIGHT,pointShape:b.PointShape.CIRCLE,clipMode:b.ClipMode.HIGHLIGHT_INSIDE,qualities:s,quality:s.Splats,useDEMCollisions:!1,minNodeSize:100,heightMin:-5,heightMax:45,useEDL:!1},t.predefinedSettings={LOW:{pointCountTarget:2,pointSize:1,opacity:1,showSkybox:!0,interpolate:!1,showStats:!1,highQuality:!1,showBoundingBox:!1,pointColorTypes:b.PointColorType,clipModes:b.ClipMode,pointSizeType:b.PointSizeType.ADAPTIVE,pointColorType:b.PointColorType.HEIGHT,pointShape:b.PointShape.CIRCLE,clipMode:b.ClipMode.HIGHLIGHT_INSIDE,quality:s.Low,useDEMCollisions:!1,minNodeSize:100,heightMin:-5,heightMax:45,useEDL:!1},MEDIUM:{pointCountTarget:3,pointSize:1,opacity:1,showSkybox:!0,interpolate:!0,showStats:!1,highQuality:!0,showBoundingBox:!1,pointColorTypes:b.PointColorType,clipModes:b.ClipMode,pointSizeType:b.PointSizeType.ADAPTIVE,pointColorType:b.PointColorType.HEIGHT,pointShape:b.PointShape.CIRCLE,clipMode:b.ClipMode.HIGHLIGHT_INSIDE,quality:s.Splats,useDEMCollisions:!1,minNodeSize:100,heightMin:-5,heightMax:45,useEDL:!1},HIGH:{pointCountTarget:5,pointSize:1,opacity:1,showSkybox:!0,interpolate:!0,showStats:!1,highQuality:!1,showBoundingBox:!1,pointColorTypes:b.PointColorType,clipModes:b.ClipMode,pointSizeType:b.PointSizeType.ATTENUATED,pointColorType:b.PointColorType.HEIGHT,pointShape:b.PointShape.CIRCLE,clipMode:b.ClipMode.HIGHLIGHT_INSIDE,quality:s.Splats,useDEMCollisions:!1,minNodeSize:100,heightMin:-5,heightMax:45,useEDL:!0}},t.stats={nrPoints:0,nrNodes:0,sceneCoordinates:{x:0,y:0,z:0},lasCoordinates:{x:0,y:0,z:0,crs:"unknown"}},t.renderer=null;var u,v,w,x;t.pathMesh=null;var y=g.referenceFrame,z={x:0,y:0};this.orbitControls=null,this.isInOrbitMode=!1;var A,B=new b.PointCloudMaterial;B.gradient=b.Gradients.VIRIDIS,this.initThree=function(){var d=c.innerWidth,h=c.innerHeight;v=g.getScene(),u=f.camera,t.renderer=new a.WebGLRenderer,t.renderer.setSize(d,h),t.renderer.autoClear=!1,t.elRenderArea.appendChild(t.renderer.domElement),t.renderer.domElement.addEventListener("mousemove",r,!1),A=new a.DirectionalLight(16777215,.5),A.position.set(10,10,10),A.lookAt(new a.Vector3(0,0,0)),v.add(A);var j=new a.AmbientLight(5592405);v.add(j),i.init(t.renderer,v,u),m.init(t.renderer,v,u),l.init(t.renderer,v,u),x=b.utils.loadSkybox("images/skybox/"),t.renderer.context.getExtension("EXT_frag_depth"),e.ready.then(this.loadPointcloud)},this.loadPointcloud=function(){var c=e.getPointcloudUrl();t.stats.lasCoordinates.crs=e.getCrs(),b.POCLoader.load(c,function(c){w=new b.PointCloudOctree(c,B),w.material.pointSizeType=b.PointSizeType.ADAPTIVE,w.material.size=t.settings.pointSize,w.visiblePointsTarget=1e3*t.settings.pointCountTarget*1e3,y.add(w),y.updateMatrixWorld(!0),y.position.set(-w.position.x,-w.position.y,0),y.updateMatrixWorld(!0),y.applyMatrix((new a.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1)),y.updateMatrixWorld(!0),k.setCameraAndLookAtWaypoints(e.getCameraPath(),e.getLookPath()),h.init(t.elRenderArea),i.setPointcloud(w),j.init(u,t.renderer,v,w,t.elRenderArea),o.publish("legendTexture change",b.Gradients.VIRIDIS)})},this.disableDrivemap=function(){y.remove(w)},this.enableDrivemap=function(){y.add(w)};var C=new a.Vector3;this.update=function(){b.pointLoadLimit=2*t.settings.pointCountTarget*1e3*1e3,t.settings.useEDL&&(A.position.copy(u.position),A.lookAt(C.set(0,0,0).addVectors(u.position,u.getWorldDirection()))),w?(w.material.clipMode=t.settings.clipMode,w.material.heightMin=t.settings.heightMin,w.material.heightMax=t.settings.heightMax,w.material.intensityMin=0,w.material.intensityMax=65e3,w.showBoundingBox=t.settings.showBoundingBox,w.generateDEM=t.settings.useDEMCollisions,w.minimumNodePixelSize=t.settings.minNodeSize,w.update(u,t.renderer)):n.start(),i.update(),f.update(),w&&(j.enabled?j.update():h.updateInput()),q()};var D=function(){var a=function(a,b){var c=a/b;u.aspect=c,u.updateProjectionMatrix(),t.renderer.setSize(a,b)};this.render=function(){a(t.elRenderArea.clientWidth,t.elRenderArea.clientHeight),t.settings.showSkybox&&(x.camera.rotation.copy(u.rotation),t.renderer.render(x.scene,x.camera)),w&&(w.originalMaterial&&(w.material=w.originalMaterial),w.visiblePointsTarget=1e3*t.settings.pointCountTarget*1e3,w.material.size=t.settings.pointSize,w.material.opacity=t.settings.opacity,w.material.pointColorType=t.settings.pointColorType,w.material.pointSizeType=t.settings.pointSizeType,w.material.pointShape=t.settings.PointShape,w.material.interpolate=t.settings.interpolate,w.material.weighted=!1,w.material.gradient=b.Gradients.VIRIDIS),t.renderer.render(v,u),i.tools.heightprofile.render(),i.tools.volume.render(),t.renderer.clearDepth(),i.tools.measuring.render(),i.tools.transformation.render()}},E=new D,F=null,G=function(){var c,d,e=null,f=null,g=null,h=function(){if(null===e){e=new b.PointCloudMaterial,f=new b.PointCloudMaterial,e.pointColorType=b.PointColorType.DEPTH,e.pointShape=b.PointShape.CIRCLE,e.interpolate=!1,e.weighted=!1,e.minSize=2,f.pointShape=b.PointShape.CIRCLE,f.gradient=b.Gradients.VIRIDIS,f.interpolate=!1,f.weighted=!0,f.minSize=2,c=new a.WebGLRenderTarget(1024,1024,{minFilter:a.NearestFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.FloatType}),d=new a.WebGLRenderTarget(1024,1024,{minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.FloatType});var h={depthMap:{type:"t",value:c},texture:{type:"t",value:d}};g=new a.ShaderMaterial({uniforms:h,vertexShader:b.Shaders["normalize.vs"],fragmentShader:b.Shaders["normalize.fs"]})}},j=function(a,b){(c.width!==a||c.height!==b)&&(c.dispose(),d.dispose(),u.aspect=a/b,u.updateProjectionMatrix(),t.renderer.setSize(a,b),c.setSize(a,b),d.setSize(a,b))};this.render=function(a){var k=t.elRenderArea.clientWidth,l=t.elRenderArea.clientHeight;if(h(),j(k,l),a.clear(),t.settings.showSkybox&&(x.camera.rotation.copy(u.rotation),a.render(x.scene,x.camera)),a.render(v,u),w){e.uniforms.octreeSize.value=w.pcoGeometry.boundingBox.size().x,f.uniforms.octreeSize.value=w.pcoGeometry.boundingBox.size().x,w.visiblePointsTarget=1e3*t.settings.pointCountTarget*1e3;var m=w.material;e.size=t.settings.pointSize,e.pointSizeType=t.settings.pointSizeType,e.screenWidth=k,e.screenHeight=l,e.uniforms.visibleNodes.value=w.material.visibleNodesTexture,e.uniforms.octreeSize.value=w.pcoGeometry.boundingBox.size().x,e.fov=u.fov*(Math.PI/180),e.spacing=w.pcoGeometry.spacing,e.near=u.near,e.far=u.far,e.heightMin=t.settings.heightMin,e.heightMax=t.settings.heightMax,e.uniforms.visibleNodes.value=w.material.visibleNodesTexture,e.uniforms.octreeSize.value=w.pcoGeometry.boundingBox.size().x,e.bbSize=w.material.bbSize,e.treeType=w.material.treeType,v.overrideMaterial=e,a.clearTarget(c,!0,!0,!0),a.render(v,u,c),v.overrideMaterial=null,f.size=t.settings.pointSize,f.pointSizeType=t.settings.pointSizeType,f.screenWidth=k,f.screenHeight=l,f.pointColorType=t.settings.pointColorType,f.depthMap=c,f.uniforms.visibleNodes.value=w.material.visibleNodesTexture,f.uniforms.octreeSize.value=w.pcoGeometry.boundingBox.size().x,f.fov=u.fov*(Math.PI/180),f.spacing=w.pcoGeometry.spacing,f.near=u.near,f.far=u.far,f.heightMin=t.settings.heightMin,f.heightMax=t.settings.heightMax,f.intensityMin=w.material.intensityMin,f.intensityMax=w.material.intensityMax,f.setClipBoxes(w.material.clipBoxes),f.clipMode=w.material.clipMode,f.bbSize=w.material.bbSize,f.treeType=w.material.treeType,v.overrideMaterial=f,a.clearTarget(d,!0,!0,!0),a.render(v,u,d),v.overrideMaterial=null,g.uniforms.depthMap.value=c,g.uniforms.texture.value=d,b.utils.screenPass.render(a,g),w.material=m,i.tools.volume.render(),t.renderer.clearDepth(),i.tools.heightprofile.render(),i.tools.measuring.render(),i.tools.transformation.render()}}},H=null,I=function(){var c=null,d=null,e=null,f=function(){null===c&&(c=new b.EyeDomeLightingMaterial,d=new b.PointCloudMaterial,d.gradient=b.Gradients.VIRIDIS,d.pointShape=b.PointShape.CIRCLE,d.interpolate=!1,d.weighted=!1,d.useLogarithmicDepthBuffer=!1,d.useEDL=!0,e=new a.WebGLRenderTarget(1024,1024,{minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat,type:a.FloatType}))},g=function(){var a=t.elRenderArea.clientWidth,b=t.elRenderArea.clientHeight,c=a/b,d=e.width!==a||e.height!==b;d&&e.dispose(),u.aspect=c,u.updateProjectionMatrix(),t.renderer.setSize(a,b),e.setSize(a,b)};this.render=function(){if(f(),g(),t.renderer.clear(),t.settings.showSkybox&&(x.camera.rotation.copy(u.rotation),t.renderer.render(x.scene,x.camera)),t.renderer.render(v,u),w){var a=t.elRenderArea.clientWidth,h=t.elRenderArea.clientHeight,j=w.pcoGeometry.boundingBox.size().x;w.visiblePointsTarget=1e3*t.settings.pointCountTarget*1e3,d.size=t.settings.pointSize,d.pointSizeType=t.settings.pointSizeType,d.screenWidth=a,d.screenHeight=h,d.pointColorType=t.settings.pointColorType,d.uniforms.visibleNodes.value=w.material.visibleNodesTexture,d.uniforms.octreeSize.value=j,d.fov=u.fov*(Math.PI/180),d.spacing=w.pcoGeometry.spacing,d.near=u.near,d.far=u.far,d.heightMin=t.settings.heightMin,d.heightMax=t.settings.heightMax,d.intensityMin=w.material.intensityMin,d.intensityMax=w.material.intensityMax,d.setClipBoxes(w.material.clipBoxes),d.clipMode=w.material.clipMode,d.bbSize=w.material.bbSize,d.treeType=w.material.treeType,v.overrideMaterial=d,t.renderer.clearTarget(e,!0,!0,!0),t.renderer.render(v,u,e),v.overrideMaterial=null,c.uniforms.screenWidth.value=a,c.uniforms.screenHeight.value=h,c.uniforms.near.value=u.near,c.uniforms.far.value=u.far,c.uniforms.colorMap.value=e,c.uniforms.expScale.value=u.far,b.utils.screenPass.render(t.renderer,c),t.renderer.render(v,u),i.tools.heightprofile.render(),i.tools.volume.render(),t.renderer.clearDepth(),i.tools.measuring.render(),i.tools.transformation.render()}}};this.loop=function(){requestAnimationFrame(t.loop),t.update(),t.settings.useEDL?(H||(H=new I),H.render(t.renderer)):"Splats"===t.settings.quality?(F||(F=new G),F.render(t.renderer)):E.render()},this.attachCanvas=function(a){t.elRenderArea=a,t.initThree();var b=t.renderer.domElement;a.appendChild(b),t.loop()}}a.$inject=["THREE","Potree","$window","$rootScope","DrivemapService","CameraService","SceneService","PathControls","MeasuringService","EarthcontrolsService","RailService","ExtractionDrawingService","PointcloudExtractionSelectionService","cfpLoadingBar","Messagebus"],angular.module("pattyApp.pointcloud").service("PointcloudService",a)}(),function(){"use strict";function a(a){var b=new a.Scene;this.referenceFrame=new a.Object3D,b.add(this.referenceFrame),this.getScene=function(){return b},this.toLocal=function(a){var b=a.clone().applyMatrix4(this.referenceFrame.matrixWorld);return b};var c=new a.Matrix4,d=new a.Box3;this.toGeo=function(b){var e,f=c.identity().getInverse(this.referenceFrame.matrixWorld);if(b instanceof a.Vector3)e=b.clone().applyMatrix4(f);else if(b instanceof a.Box3){var g=b.min.clone().applyMatrix4(f),h=b.max.clone().applyMatrix4(f);e=d.set(g,h)}return e}}a.$inject=["THREE"],angular.module("pattyApp.pointcloud").service("SceneService",a)}();var thecamera;!function(){"use strict";function a(a,b,c,d,e){var f=this,g=75,h=a.innerWidth,i=a.innerHeight,j=h/i,k=.1,l=6e5;this.camera=new c.PerspectiveCamera(g,j,k,l),this.floor=new c.Plane(new c.Vector3(0,1,0),0),a.addEventListener("resize",function(){f.onWindowResize()});var m=new c.Matrix4;this.getCameraOrientation=function(){return m.identity().multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorld).determinant()};var n=this.getCameraOrientation();this.update=function(){var a=this.getCameraOrientation();a!==n&&this.update2DFrustum(),n=a};var o=new c.Vector3,p=new c.Vector3,q=new c.Vector3,r=new c.Vector3,s=new c.Ray,t=new c.Vector3,u=new c.Vector3,v=new c.Vector3,w=new c.Vector3;this.update2DFrustum=function(){o=o.set(1,-1,1).unproject(this.camera).normalize(),p=p.set(-1,-1,1).unproject(this.camera).normalize(),q=q.set(-1,1,1).unproject(this.camera).normalize(),r=r.set(1,1,1).unproject(this.camera).normalize();var a,b,c=[null,null,null,null],f=!0;if(b=this.camera.position.clone(),b.y=-b.y,s=s.set(this.camera.position,o),a=s.intersectPlane(this.floor),a&&(c[0]=a,s=s.set(this.camera.position,p),a=s.intersectPlane(this.floor),c[1]=a),s=s.set(this.camera.position,q),a=s.intersectPlane(this.floor),a&&(c[2]=a,s=s.set(this.camera.position,r),a=s.intersectPlane(this.floor),c[3]=a),null===c[0])null===c[3]?(s=s.set(b,o),a=s.intersectPlane(this.floor),c[2]=a,s=s.set(b,p),a=s.intersectPlane(this.floor),c[3]=a,s=s.set(b,q),a=s.intersectPlane(this.floor),c[0]=a,s=s.set(b,r),a=s.intersectPlane(this.floor),c[1]=a,f=!1):(c[0]=c[2].clone(),c[1]=c[3].clone(),v=v.set(0,0,0).subVectors(c[2],this.camera.position),w=w.set(0,0,0).subVectors(c[3],this.camera.position),c[2]=w.multiplyScalar(1e3),c[3]=v.multiplyScalar(1e3),c[2].y=0,c[3].y=0);else if(null===c[3])t=t.set(0,0,0).subVectors(c[0],this.camera.position),u=u.set(0,0,0).subVectors(c[1],this.camera.position),c[2]=u.multiplyScalar(1e3),c[3]=t.multiplyScalar(1e3),c[2].y=0,c[3].y=0;else if(this.camera.position.y<0){var g=c[0],h=c[1];c[0]=c[2],c[1]=c[3],c[2]=g,c[3]=h}var i=c.map(function(a){return e.toGeo(a)});d.publish("cameraMoved",i,f)},this.onWindowResize=function(){var b=a.innerWidth,c=a.innerHeight,d=b/c;this.camera.aspect=d,this.camera.updateProjectionMatrix()}}a.$inject=["$window","$log","THREE","Messagebus","SceneService"],angular.module("pattyApp.pointcloud").service("CameraService",a)}(),function(){"use strict";function a(a,b,c,d,e){this.waypoints=[],this.cameraCurve=new c.SplineCurve3,this.lookatCurve=new c.SplineCurve3,this.curveSegments=100,this.lookatDistance=100,this.dataUrl=null,this.addCameraLocation=function(){var d=a.camera,e=d.position.clone(),f=b.toGeo(e).toArray(),g=new c.Vector3(0,0,-1*this.lookatDistance).applyQuaternion(d.quaternion).add(d.position),h=b.toGeo(g).toArray();this.waypoints.push(f.concat(h)),this.waypointsChanged()},this.removeLast=function(){this.waypoints.pop(),this.waypointsChanged()},this.waypointsChanged=function(){this.updateSplines(),this.updateRailScene(),this.updateDataUrl()},this.updateSplines=function(){if(!(this.waypoints.length<2)){var a=this.waypoints.map(function(a){return b.toLocal(new c.Vector3(a[0],a[1],a[2]))}),d=new c.SplineCurve3(a);this.cameraCurve=new c.SplineCurve3(d.getSpacedPoints(this.curveSegments));var e=this.waypoints.map(function(a){return b.toLocal(new c.Vector3(a[3],a[4],a[5]))}),f=new c.SplineCurve3(e);this.lookatCurve=new c.SplineCurve3(f.getSpacedPoints(this.curveSegments))}},this.firstCameraPosition=function(){return this.cameraCurve.getPointAt(0)},this.firstLookatPosition=function(){return this.lookatCurve.getPointAt(0)},this.setWaypoints=function(a){this.waypoints=angular.copy(a),this.waypointsChanged()},this.setCameraAndLookAtWaypoints=function(a,b){this.waypoints=[];for(var c=0;c<a.length;c++)this.waypoints.push(a[c].concat(b[c]));this.waypointsChanged()},this.updateRailScene=function(){var a=this.scene.visible;b.getScene().remove(this.scene),this.createRailScene(),this.scene.visible=a},this.createRailScene=function(){if(this.scene=new c.Object3D,this.scene.name="rail",this.scene.visible=!1,this.waypoints.length>=2){var a=this.createTube(this.cameraCurve,"camera",65535,16711680);this.scene.add(a);var d=this.createTube(this.lookatCurve,"lookat",65535,65280);this.scene.add(d)}b.getScene().add(this.scene)},this.createTube=function(a,b,d,e){var f=new c.TubeGeometry(a,1024,.25,8,!1),g=c.SceneUtils.createMultiMaterialObject(f,[new c.MeshLambertMaterial({color:d}),new c.MeshBasicMaterial({color:d,opacity:.3,wireframe:!1,transparent:!1})]);g.name=b;var h=new c.SphereGeometry(.5,32,32),i=new c.MeshBasicMaterial({color:e});return a.points.map(function(a){var b=new c.Mesh(h,i);b.position.copy(a),g.add(b)}.bind(this)),g},this.updateDataUrl=function(){var a=JSON.stringify(this.waypoints),b=new Blob([a],{type:"application/json"});this.dataUrl&&e.URL.revokeObjectURL(this.dataUrl),this.dataUrl=e.URL.createObjectURL(b)},this.onFileUpload=function(a){this.filereader.readyState===FileReader.DONE?(this.setWaypoints(JSON.parse(a.target.result)),d.success("Upload of demo waypoints completed")):d.error("Upload of demo waypoints failed")},this.upload=function(a){if(!(a.length<1)){var b=a[0];this.filereader.readAsText(b)}},this.clear=function(){this.waypoints=[],this.waypointsChanged()},this.filereader=new FileReader,this.filereader.onloadend=this.onFileUpload.bind(this),this.filereader.onerror=function(){d.error("Upload of demo waypoints failed")},this.createRailScene(),this.updateDataUrl()}a.$inject=["CameraService","SceneService","THREE","toastr","$window"],angular.module("pattyApp.pointcloud").service("RailService",a)}(),function(){"use strict";function a(a,b){var c,d=Number.MAX_VALUE,e=0,f=0;for(c=0;c<a.points.length;c++)e=b.distanceTo(a.points[c]),d>e&&(d=e,f=c);return f}function b(b,c){var d=a(b,c),e=Number.MAX_VALUE,f=Number.MAX_VALUE,g=1;0!==d&&(e=c.distanceTo(b.points[d-1])),d<b.points.length-1&&(f=c.distanceTo(b.points[d+1])),e>f?g=d+1:(d-=1,g=d+1);var h=c.clone();h.sub(b.points[d]);var i=b.points[g].clone();i.sub(b.points[d].clone()),i.normalize();var j=h.dot(i)/h.length();return(d+j)/b.points.length*N}function c(a){return Math.min(Math.max(a,0),1)}function d(a){var b=new x.Vector3(Math.sin(C),Math.sin(-D),Math.cos(C));return b.multiplyScalar(-a)}function e(a){var b=new x.Vector3(Math.cos(-C),0,Math.sin(-C));return b.multiplyScalar(-a)}function f(){D=Math.max(Math.min(D,E),F),t.rotation.set(D,C,0,"YXZ")}function g(a){(J[87]||J[38])&&(M+=a),(J[83]||J[40])&&(M-=a),M%=N,0>M&&(M=N+M);var b=y.cameraCurve;t.position.copy(b.getPointAt(M/N))}function h(a){(J[87]||J[119]||J[38])&&w.add(d(a)),(J[83]||J[115]||J[40])&&w.sub(d(a))}function i(a){(J[90]||J[122])&&(w.y-=a),(J[81]||J[113])&&(w.y+=a)}function j(a){(J[65]||J[97]||J[37])&&w.add(a),(J[68]||J[100]||J[39])&&w.sub(a)}function k(a){h(a),i(a),j(e(a))}function l(){var a=1,c=y.lookatCurve,d=b(c,w)/c.points.length,e=y.cameraCurve,f=b(e,w)/e.points.length;return 0!==f&&0!==d&&(a=Math.max(f,d)/Math.min(f,d)),a}function m(a){J[a.keyCode]=!0;var b=32;a.keyCode===b&&a.preventDefault()}function n(a){J[a.keyCode]=!1}function o(){A=!1;var a;for(a=0;a<J.length;a++)J[a]=!1}function p(a){z.mode!==z.modes.OFF&&2===a.button&&(document.activeElement!==v&&v.focus(),a.preventDefault(),G=a.pageX,H=a.pageY,A=!0)}function q(a){z.mode!==z.modes.OFF&&2===a.button&&(a.preventDefault(),A=!1)}function r(a){if(z.mode!==z.modes.OFF){if(!A)return;C-=I*(a.pageX-G)/window.innerWidth,D-=I*(a.pageY-H)/window.innerHeight,G=a.pageX,H=a.pageY}}function s(a){if(z.mode!==z.modes.OFF){a.preventDefault(),a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail),0>b?K+=2.5:K-=2.5,K>L&&(K=L),5>K&&(K=5),t.fov=K,t.updateProjectionMatrix()}}var t,u,v,w,x,y,z,A=!1,B=1.08,C=0,D=0,E=.95*Math.PI/2,F=-.95*Math.PI/2,G=window.innerWidth/2,H=window.innerHeight/2,I=8,J=[],K=45,L=45,M=0,N=240,O=function(a,b,c){z=this,x=a,y=b,this.NORMAL_MOVEMENT_SPEED_MULTIPLIER=30,this.FAST_MOVEMENT_SPEED_MULTIPLIER=50,this.cameraEasing=10;for(var d=0;130>d;d++)J.push(!1);t=c.camera,u=new x.Clock,this.modes={ONRAILS:"onrails",FLY:"fly",DEMO:"demo",OFF:"off"},this.mode=this.modes.FLY};O.prototype.initCamera=function(a){t.position.copy(a),t.up.set(0,1,0),t.rotation.order="YXZ",w=t.position,K=t.fov,L=t.fov},O.prototype.initListeners=function(a){v=a,a.setAttribute("tabindex",1),a.addEventListener("keydown",m,!1),a.addEventListener("keyup",n,!1),a.addEventListener("mouseleave",o,!1),a.addEventListener("mouseout",o,!1),a.addEventListener("mousemove",r,!1),a.addEventListener("mousedown",p,!1),a.addEventListener("mouseup",q,!1),a.addEventListener("mousewheel",s,!1),a.addEventListener("DOMMouseScroll",s,!1)},O.prototype.disableListeners=function(a){a.removeEventListener("keydown",m,!1),a.removeEventListener("keyup",n,!1),a.removeEventListener("mouseleave",o,!1),a.removeEventListener("mouseout",o,!1),a.removeEventListener("mousemove",r,!1),a.removeEventListener("mousedown",p,!1),a.removeEventListener("mouseup",q,!1),a.removeEventListener("mousewheel",s,!1),a.removeEventListener("DOMMouseScroll",s,!1)},O.prototype.init=function(a){this.initCamera(y.firstCameraPosition()),this.lookat(y.firstLookatPosition()),t.updateProjectionMatrix(),this.initListeners(a)},O.prototype.goToPointOnRoad=function(a){var c=y.cameraCurve;M=b(c,a),w.copy(c.getPointAt(M/N))},O.prototype.lookat=function(a){t.up=new x.Vector3(0,1,0),t.lookAt(a),C=t.rotation.y,D=t.rotation.x},O.prototype.moveTo=function(a){w.copy(a)},O.prototype.updateDemoMode=function(a){M+=a,M%=N,0>M&&(M=N+M);var b=y.cameraCurve;t.position.copy(b.getPointAt(M/N)),B=(1-a/this.cameraEasing)*B+a/this.cameraEasing*l();var d=y.lookatCurve,e=M/N*(d.getLength()/b.getLength())*B,f=d.getPointAt(c(e));this.lookat(f)},O.prototype.updateInput=function(){var a=y.cameraCurve;if(a){var b=u.getDelta();b*=this.NORMAL_MOVEMENT_SPEED_MULTIPLIER,J[32]&&(b*=this.FAST_MOVEMENT_SPEED_MULTIPLIER),z.mode!==z.modes.OFF&&f(),this.mode===this.modes.DEMO?this.updateDemoMode(b):this.mode===this.modes.FLY?k(10*b):this.mode===this.modes.ONRAILS?g(b):this.mode===this.modes.OFF||console.log("error: unknown control mode in path.controls")}},O.prototype.enableFlightMode=function(){this.mode=this.modes.FLY},O.prototype.transitionFromFlightMode=function(){this.mode===this.modes.FLY&&this.goToPointOnRoad(w)},O.prototype.enableRailsMode=function(){this.transitionFromFlightMode(),this.mode=this.modes.ONRAILS},O.prototype.enableDemoMode=function(){this.transitionFromFlightMode(),this.mode=this.modes.DEMO},O.prototype.disable=function(){this.previousMode=this.mode,this.mode=this.modes.OFF},O.prototype.enable=function(){this.mode=this.previousMode},angular.module("pattyApp.pointcloud").service("PathControls",["THREE","RailService","CameraService",O])}(),function(){"use strict";function a(){return{restrict:"E",link:function(a,b){a.vm.attachCanvas(b[0])},controller:"PointcloudCanvasController",controllerAs:"vm"}}angular.module("pattyApp.pointcloud").directive("pattyPointcloudCanvas",a)}(),function(){"use strict";function a(a){this.attachCanvas=function(b){a.attachCanvas(b)}}a.$inject=["PointcloudService"],angular.module("pattyApp.pointcloud").controller("PointcloudCanvasController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/pointcloud/pointcloud-stats.directive.html",controller:"PointcloudStatsController",controllerAs:"pcs"}}angular.module("pattyApp.pointcloud").directive("pattyPointcloudStats",a)}(),function(){"use strict";function a(a){this.stats=a.stats,this.PointcloudService=a,this.settings=a.settings}a.$inject=["PointcloudService"],angular.module("pattyApp.pointcloud").controller("PointcloudStatsController",a)}(),function(){"use strict";function a(a,b,c,d){this.tools={measuring:null,volume:null,heightprofile:null,clipvolume:null,transformation:null},this.transformationTools={TRANSLATE:0,ROTATE:1,SCALE:2},this.activeTransformationTool=this.transformationTools.ROTATE,this.pointcloud=null,this.sitePointcloud=null,this.profileWidth=.1,this.initialized=!1,this.onKeyDown=function(b){69===b.keyCode?(this.activeTransformationTool=this.transformationTools.SCALE,a.$digest(),this.tools.transformation.scale()):82===b.keyCode?(this.activeTransformationTool=this.transformationTools.ROTATE,a.$digest(),this.tools.transformation.rotate()):84===b.keyCode&&(this.activeTransformationTool=this.transformationTools.TRANSLATE,a.$digest(),this.tools.transformation.translate())},this.clear=function(){this.clearStandardPotreeMeasurementTool(this.tools.measuring),this.clearVolumes(),this.clearProfile()},this.clearStandardPotreeMeasurementTool=function(a){a.measurements=[],a.sceneMeasurement=new c.Scene,a.sceneRoot=new c.Object3D,a.sceneMeasurement.add(a.sceneRoot),a.light=new c.DirectionalLight(16777215,1),a.light.position.set(0,0,10),a.light.lookAt(new c.Vector3(0,0,0)),a.sceneMeasurement.add(a.light)},this.clearVolumes=function(){this.tools.volume.volumes=[],this.tools.volume.sceneVolume=new c.Scene},this.clearProfile=function(){this.tools.heightprofile.profiles=[],this.tools.heightprofile.sceneProfile=new c.Scene,this.tools.heightprofile.sceneRoot=new c.Object3D,this.tools.heightprofile.sceneProfile.add(this.tools.heightprofile.sceneRoot)},this.init=function(a,c,e){this.tools.measuring=new b.MeasuringTool(c,e,a),this.tools.volume=new b.VolumeTool(c,e,a),this.tools.heightprofile=new b.ProfileTool(c,e,a),this.tools.transformation=new b.TransformationTool(c,e,a),d.transformationTool=this.tools.transformation,d.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.initialized=!0},this.setPointcloud=function(a){this.pointcloud=a},this.setSitePointcloud=function(a){this.sitePointcloud=a},this.startDistance=function(){this.tools.measuring&&this.tools.measuring.startInsertion({showDistances:!0,showArea:!1,closed:!1})},this.startAngle=function(){this.tools.measuring&&this.tools.measuring.startInsertion({showDistances:!1,showAngles:!0,showArea:!1,closed:!0,maxMarkers:3})},this.startArea=function(){this.tools.measuring&&this.tools.measuring.startInsertion({showDistances:!0,showArea:!0,closed:!0})},this.startVolume=function(){this.tools.volume&&this.tools.volume.startInsertion()},this.startHeighProfile=function(){this.tools.heightprofile&&this.tools.heightprofile.startInsertion({width:this.profileWidth})},this.startClipVolume=function(){this.tools.volume&&this.tools.volume.startInsertion({clip:!0})},this.render=function(){this.initialized&&(this.tools.heightprofile.render(),this.tools.volume.render(),this.tools.measuring.renderer.clearDepth(),this.tools.measuring.render(),this.tools.transformation.render())};var e=new c.Matrix4;this.update=function(){if(this.initialized){this.tools.volume.update(),this.tools.transformation.update(),this.tools.heightprofile.update();for(var a=[],b=0;b<this.tools.heightprofile.profiles.length;b++)for(var c=this.tools.heightprofile.profiles[b],d=0;d<c.boxes.length;d++){var f=c.boxes[d];f.updateMatrixWorld();var g=e.identity().getInverse(f.matrixWorld);a.push(g)}for(var h=0;h<this.tools.volume.volumes.length;h++){var i=this.tools.volume.volumes[h];if(i.clip){i.updateMatrixWorld();var j=e.identity().getInverse(i.matrixWorld);a.push(j)}}this.pointcloud&&this.pointcloud.material.setClipBoxes(a),this.sitePointcloud&&this.sitePointcloud.material.setClipBoxes(a)}}}a.$inject=["$rootScope","Potree","THREE","$window"],angular.module("pattyApp.measuring").service("MeasuringService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/measuring/measuring.directive.html",controller:"MeasuringController",controllerAs:"measuring"}}angular.module("pattyApp.measuring").directive("measuringDirective",a)}(),function(){"use strict";function a(a){this.showToolboxTray=!1,this.showTransformationToolboxTray=!1,this.distanceActive=!1,this.angleActive=!1,this.areaActive=!1,this.volumeActive=!1,this.heightProfileActive=!1,this.clipVolumeActive=!1,this.measuringService=a,this.toggleToolbox=function(){this.resetState(),this.showToolboxTray=!this.showToolboxTray,this.measuringService.clear()},this.resetState=function(){this.distanceActive=!1,this.angleActive=!1,this.areaActive=!1,this.volumeActive=!1,this.heightProfileActive=!1,this.clipVolumeActive=!1,this.showTransformationToolboxTray=!1},this.isTransformationRotate=function(){var a=!1;return this.measuringService.activeTransformationTool===this.measuringService.transformationTools.ROTATE&&(a=!0),a},this.isTransformationTranslate=function(){var a=!1;return this.measuringService.activeTransformationTool===this.measuringService.transformationTools.TRANSLATE&&(a=!0),a},this.isTransformationScale=function(){var a=!1;return this.measuringService.activeTransformationTool===this.measuringService.transformationTools.SCALE&&(a=!0),a},this.startDistance=function(){this.resetState(),this.distanceActive=!0,this.measuringService.startDistance()},this.startAngle=function(){this.resetState(),this.angleActive=!0,this.measuringService.startAngle()},this.startArea=function(){this.resetState(),this.areaActive=!0,this.measuringService.startArea()},this.startAngle=function(){this.resetState(),this.angleActive=!0,this.measuringService.startAngle()},this.startVolume=function(){this.resetState(),this.volumeActive=!0,this.showTransformationToolboxTray=!0,this.measuringService.startVolume()},this.startHeightProfile=function(){this.resetState(),this.heightProfileActive=!0,this.measuringService.startHeightProfile()},this.startClipVolume=function(){this.resetState(),this.clipVolumeActive=!0,this.showTransformationToolboxTray=!0,this.measuringService.startClipVolume()},this.toggleRotate=function(){this.measuringService.activeTransformationTool=this.measuringService.transformationTools.ROTATE,this.resetState(),this.showTransformationToolboxTray=!0,this.measuringService.tools.transformation.rotate()},this.toggleTranslate=function(){this.measuringService.activeTransformationTool=this.measuringService.transformationTools.TRANSLATE,this.resetState(),this.showTransformationToolboxTray=!0,this.measuringService.tools.transformation.translate()},this.toggleScale=function(){this.measuringService.activeTransformationTool=this.measuringService.transformationTools.SCALE,this.resetState(),this.showTransformationToolboxTray=!0,this.measuringService.tools.transformation.scale()}}a.$inject=["MeasuringService"],angular.module("pattyApp.measuring").controller("MeasuringController",a)}(),function(){"use strict";function a(a,b){this._active=!1,this._left=93720.22,this._bottom=436899.97,this._right=94428.37,this._top=438334.32,this.debouncedSendUpdate=function(){this.checkSwapCoordinates(),a.publish("extractionSelectionChanged",this.toRequest())}.bind(this),this.sendUpdate=b(500,this.debouncedSendUpdate),this.updateValue=function(a,b){b!==this[a]&&(this[a]=b,this.sendUpdate())},Object.defineProperty(this,"active",{get:function(){return this._active},set:function(b){b!==this._active&&a.publish("extractionSelectionActivationChanged",b),this._active=b}}),Object.defineProperty(this,"left",{get:function(){return this._left},set:function(a){this.updateValue("_left",a)}}),Object.defineProperty(this,"top",{get:function(){return this._top},set:function(a){this.updateValue("_top",a)}}),Object.defineProperty(this,"right",{get:function(){return this._right},set:function(a){this.updateValue("_right",a)}}),Object.defineProperty(this,"bottom",{get:function(){return this._bottom},set:function(a){this.updateValue("_bottom",a)}}),this.checkSwapCoordinates=function(){var a=-1;this._bottom>this._top&&(a=this._top,this._top=this._bottom,this._bottom=a),this._left>this._right&&(a=this._right,this._right=this._left,this._left=a)},this.setBottomLeftCoordinates=function(a){this.bottom=a.lat,this.left=a.lon},this.setTopRightCoordinates=function(a){this.top=a.lat,this.right=a.lon},this.toRequest=function(){var a={left:this._left,bottom:this._bottom,right:this._right,top:this._top};return a}}a.$inject=["Messagebus","debounce"],angular.module("pattyApp.extract").service("ExtractionSelectionService",a)}(),function(){"use strict";function a(a,b,c){this.source=new b.source.Vector({wrapX:!1}),this.layer=new b.layer.Vector({source:this.source,style:new b.style.Style({fill:new b.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new b.style.Stroke({color:"#f00",width:2})}),visible:!1}),this.drawing=!1,this.geometryFunction=function(a,c){c||(c=new b.geom.Polygon(null));var d=a[0],e=a[1];return c.setCoordinates([[d,[d[0],e[1]],e,[e[0],d[1]],d]]),c},this.drawer=new b.interaction.Draw({source:this.source,type:"LineString",geometryFunction:this.geometryFunction,maxPoints:2,style:new b.style.Style({fill:new b.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new b.style.Stroke({color:"#f00",width:3}),image:new b.style.RegularShape({
stroke:new b.style.Stroke({color:"#f00",width:2}),points:4,radius:10,radius2:0,angle:0})})}),this.onDrawStart=function(){this.source.clear(),this.drawing=!0},this.onDrawEnd=function(b){function c(a){return Math.round(100*a)/100}var d=b.feature.getGeometry().getCoordinates(),e={lon:c(d[0][3][0]),lat:c(d[0][3][1])},f={lon:c(d[0][1][0]),lat:c(d[0][1][1])};a.setTopRightCoordinates(e),a.setBottomLeftCoordinates(f),this.drawing=!1},this.remoteSelectionChanged=function(a,b){this.drawing||this.drawSelection(b)},this.drawSelection=function(a){var c=[[[a.left,a.top],[a.left,a.bottom],[a.right,a.bottom],[a.right,a.top],[a.left,a.top]]],d=this.source.getFeatures()[0];if(d){var e=d.getGeometry();e.setCoordinates(c)}else d=new b.Feature({geometry:new b.geom.Polygon(c)}),this.source.addFeature(d)},this.activationChanged=function(b,c){this.layer.setVisible(c),this.drawer.setActive(c),c&&this.drawSelection(a)},this.init=function(a){a.addLayer(this.layer),a.addInteraction(this.drawer)},this.drawer.setActive(!1),this.drawer.on("drawstart",this.onDrawStart.bind(this)),this.drawer.on("drawend",this.onDrawEnd.bind(this)),c.subscribe("extractionSelectionChanged",this.remoteSelectionChanged.bind(this)),c.subscribe("extractionSelectionActivationChanged",this.activationChanged.bind(this))}a.$inject=["ExtractionSelectionService","ol","Messagebus"],angular.module("pattyApp.extract").service("MinimapExtractionSelectionService",a)}(),function(){"use strict";function a(a,b,c,d,e,f){function g(a){j.selectionActive&&1===a.which&&(j.mouseDownLocalPoint=k.getMousePointCloudIntersection(),j.mouseDownLocalPoint&&(j.mouseDownPoint=b.toGeo(j.mouseDownLocalPoint)))}function h(a){if(j.selectionActive&&1===a.which){var d=k.getMousePointCloudIntersection();if(d){j.otherPoint=b.toGeo(d);var e={lat:j.mouseDownPoint.y,lon:j.mouseDownPoint.x},f={lat:j.otherPoint.y,lon:j.otherPoint.x};c.setTopRightCoordinates(e),c.setBottomLeftCoordinates(f),j.mouseDownLocalPoint=null}}}function i(a){if(j.selectionActive){j.mouse.x=a.clientX/j.renderer.domElement.clientWidth*2-1,j.mouse.y=2*-(a.clientY/j.renderer.domElement.clientHeight)+1;var b=k.getMousePointCloudIntersection();j.mouseDownLocalPoint&&b?d.setIntermediate(j.mouseDownLocalPoint,b):d.removeIntermediate()}}var j=this;this.selectionActive=!1,this.mouseDownPoint=null,this.mouseDownLocalPoint=null,this.otherPoint=null,this.renderer=null,this.scene=null,this.camera=null,this.mesh=null,this.mouse={x:0,y:0},this.init=function(a,b,c){this.renderer=a,this.scene=b,this.camera=c,j.renderer.domElement.addEventListener("mousemove",i,!1),j.renderer.domElement.addEventListener("mousedown",g,!1),j.renderer.domElement.addEventListener("mouseup",h,!0)},this.getMousePointCloudIntersection=function(){var b=new a.Vector3(j.mouse.x,j.mouse.y,.5);b.unproject(j.camera);var c=b.sub(j.camera.position).normalize(),d=new a.Ray(j.camera.position,c),e=[];j.scene.traverse(function(a){a instanceof f.PointCloudOctree&&e.push(a)});for(var g=null,h=null,i=0;i<e.length;i++){var k=e[i],l=k.pick(j.renderer,j.camera,d,{accuracy:.5});if(l){var m=j.camera.position.distanceTo(l.position);(!g||h>m)&&(g=l,h=m)}}return g?g.position:null};var k=this;this.activationChanged=function(a,b){this.selectionActive=b,e.publish("earthcontrols suspended",b)},e.subscribe("extractionSelectionActivationChanged",this.activationChanged.bind(this))}a.$inject=["THREE","SceneService","ExtractionSelectionService","ExtractionDrawingService","Messagebus","Potree"],angular.module("pattyApp.extract").service("PointcloudExtractionSelectionService",a)}(),function(){"use strict";function a(a,b,c){this.color=new a.Color(16777215),this.renderer=null,this.scene=null,this.camera=null,this.selectionMesh=null,this.intermediateMesh=null,this.init=function(a,b,c){this.renderer=a,this.scene=b,this.camera=c},this.remoteSelectionChanged=function(c,d){this.scene.remove(this.selectionMesh);var e=b.toLocal(new a.Vector3(d.left,d.top,0)),f=b.toLocal(new a.Vector3(d.right,d.top,0)),g=b.toLocal(new a.Vector3(d.right,d.bottom,0)),h=b.toLocal(new a.Vector3(d.left,d.bottom,0));this.selectionMesh=this.buildSelectionGeometry(e,f,g,h,16711680),this.scene.add(this.selectionMesh)},c.subscribe("extractionSelectionChanged",this.remoteSelectionChanged.bind(this)),this.setIntermediate=function(b,c){this.scene.remove(this.selectionMesh),this.scene.remove(this.intermediateMesh);var d=new a.Vector3(b.x,0,b.z),e=new a.Vector3(c.x,0,b.z),f=new a.Vector3(c.x,0,c.z),g=new a.Vector3(b.x,0,c.z);this.intermediateMesh=this.buildSelectionGeometry(d,e,f,g,16711680),this.scene.add(this.intermediateMesh)},this.removeIntermediate=function(){this.scene.remove(this.intermediateMesh)},this.buildSelectionGeometry=function(b,c,d,e,f){var g=new a.MeshBasicMaterial({color:f,side:a.DoubleSide,transparent:!0,wireframe:!1,opacity:1}),h=new a.Geometry,i=null,j=new a.BoxGeometry(c.x-b.x+200,100,100);i=(new a.Matrix4).setPosition(new a.Vector3(b.x+.5*(c.x-b.x),45,b.z+50)),j.applyMatrix(i);var k=new a.BoxGeometry(100,100,c.z-d.z+200);i=(new a.Matrix4).setPosition(new a.Vector3(d.x+50,45,d.z+.5*(c.z-d.z))),k.applyMatrix(i);var l=new a.BoxGeometry(d.x-e.x+200,100,100);i=(new a.Matrix4).setPosition(new a.Vector3(e.x+.5*(d.x-e.x),45,e.z-50)),l.applyMatrix(i);var m=new a.BoxGeometry(100,100,b.z-e.z+200);i=(new a.Matrix4).setPosition(new a.Vector3(b.x-50,45,e.z+.5*(b.z-e.z))),m.applyMatrix(i),a.GeometryUtils.merge(h,j),a.GeometryUtils.merge(h,k),a.GeometryUtils.merge(h,l),a.GeometryUtils.merge(h,m);var n=new a.Mesh(h,g);return n},this.activationChanged=function(a,b){b?(null!==this.selectionMesh&&this.scene.add(this.selectionMesh),null!==this.intermediateMesh&&this.scene.add(this.intermediateMesh),this.show=!0):(this.scene.remove(this.selectionMesh),this.scene.remove(this.intermediateMesh),this.show=!1)},c.subscribe("extractionSelectionActivationChanged",this.activationChanged.bind(this))}a.$inject=["THREE","SceneService","Messagebus"],angular.module("pattyApp.extract").service("ExtractionDrawingService",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/extract/extraction.directive.html",controller:"ExtractionController",controllerAs:"ec"}}angular.module("pattyApp.extract").directive("extractionPanel",a)}(),function(){"use strict";function a(a,b,c,d){this.selection=a,this.email="",this.size={coverage:1,returnedPoints:0,rawPoints:0,level:14},this.count=function(){var a=this.selection.toRequest(),d=b.AHN_API_ENDPOINT,e=d+"/size";c.post(e,a).success(function(a){this.size=a}.bind(this)).error(function(){console.log(arguments)})},this.submit=function(){var a=this.selection.toRequest();a.email=this.email;var e=b.AHN_API_ENDPOINT,f=e+"/laz";c.post(f,a).success(function(b){this.size=b,d.success('Will send e-mail to "'+a.email+'" when completed',"Point extraction job submitted")}.bind(this)).error(function(){console.log(arguments),d.error("Submit failed","for some reason")}),this.showForm=!1}}a.$inject=["ExtractionSelectionService","pattyConf","$http","toastr"],angular.module("pattyApp.extract").controller("ExtractionController",a)}(),function(){"use strict";function a(){function a(a,b,c){return"undefined"==typeof c||0===+c?Math[a](b):(b=+b,c=+c,isNaN(b)||"number"!=typeof c||c%1!==0?0/0:(b=b.toString().split("e"),b=Math[a](+(b[0]+"e"+(b[1]?+b[1]-c:-c))),b=b.toString().split("e"),+(b[0]+"e"+(b[1]?+b[1]+c:c))))}Math.round10||(Math.round10=function(b,c){return a("round",b,c)}),Math.floor10||(Math.floor10=function(b,c){return a("floor",b,c)}),Math.ceil10||(Math.ceil10=function(b,c){return a("ceil",b,c)}),Math.log10||(Math.log10=Math.log10||function(a){return Math.log(a)/Math.LN10})}angular.module("pattyApp.utils").service("DecimalAdjust",a)}(),function(){"use strict";function a(a){this.isMobile={Android:function(){return a.navigator.userAgent.match(/Android/i)},BlackBerry:function(){return a.navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return a.navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return a.navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return a.navigator.userAgent.match(/IEMobile/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}},this.mobile=this.isMobile.any()?!0:!1}a.$inject=["$window"],angular.module("pattyApp.utils").service("UserAgent",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/biglegend/biglegend.directive.html",controller:"BigLegendController",controllerAs:"blc"}}angular.module("pattyApp.biglegend").directive("bigLegendDirective",a)}(),function(){"use strict";function a(a,b,c,d,e){this.PointcloudService=e,this.mobile=d.mobile,this.logarithmic=!1,c.subscribe("logarithmicChange",function(a,b){this.logarithmic=b,this.setLegendText()}.bind(this)),this.legendText=[40,30,20,10],this.legendMin=e.settings.heightMin,a.$watch("blc.legendMin",function(a,b){a===b||(this.setLegendText(),e.settings.heightMin=a)}.bind(this)),this.legendMax=e.settings.heightMax,a.$watch("blc.legendMax",function(a,b){a===b||(this.setLegendText(),e.settings.heightMax=a)}.bind(this)),c.subscribe("ncwmsPaletteSelected",function(a,b){this.setOnload(b.graphic)}.bind(this)),this.selectedUnits="meters above sea level",c.subscribe("ncwmsUnitsChange",function(a,b){this.selectedUnits=b}.bind(this)),this.setLegendText=function(){var a=this.legendMax-this.legendMin,b=.2*a;if(this.logarithmic){var c=Math.log10(this.legendMin),d=Math.log10(this.legendMax);this.legendText[3]=Math.round10(Math.pow(10,.8*c+.2*d),-2),this.legendText[2]=Math.round10(Math.pow(10,.6*c+.4*d),-2),this.legendText[1]=Math.round10(Math.pow(10,.4*c+.6*d),-2),this.legendText[0]=Math.round10(Math.pow(10,.2*c+.8*d),-2)}else this.legendText[3]=Math.round10(this.legendMin+b,-2),this.legendText[2]=Math.round10(this.legendMin+2*b,-2),this.legendText[1]=Math.round10(this.legendMin+3*b,-2),this.legendText[0]=Math.round10(this.legendMin+4*b,-2)}.bind(this),this.setOnload=function(a){var b=document.getElementById("bigLegendCanvas").getContext("2d"),c=new Image;c.src=a,c.onload=function(){b.canvas.width=5,b.canvas.height=255,b.drawImage(c,0,0)}},this.generateLegendTexture=function(a,b,c){var d=document.createElement("canvas");d.width=b,d.height=c;var e=d.getContext("2d");e.rect(0,0,b,c);for(var f=e.createLinearGradient(0,c,b,0),g=0;g<a.length;g++){var h=a[g];f.addColorStop(h[0],"#"+h[1].getHexString())}return e.fillStyle=f,e.fill(),e},this.setTexture=function(a){var b=document.getElementById("bigLegendCanvas").getContext("2d"),c=new Image,d=this.generateLegendTexture(a,1,255);c.src=d.canvas.toDataURL(),c.onload=function(){b.canvas.width=1,b.canvas.height=255,b.drawImage(c,0,0)}},c.subscribe("legendTexture change",function(a,b){this.setTexture(b)}.bind(this))}a.$inject=["$scope","DecimalAdjust","Messagebus","UserAgent","PointcloudService"],angular.module("pattyApp.biglegend").controller("BigLegendController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/earthcontrols/earthcontrols.directive.html",controller:"EarthcontrolsController",controllerAs:"earthcontrols"}}angular.module("pattyApp.earthcontrols").directive("earthcontrolsDirective",a)}(),function(){"use strict";function a(a){this.enabled=!0,this.toggleEarthcontrols=function(){this.enabled=!this.enabled,a.publish("earthcontrols enabled",this.enabled)}}a.$inject=["Messagebus"],angular.module("pattyApp.earthcontrols").controller("EarthcontrolsController",a)}(),function(){"use strict";function a(a,b,c){this.enabled=!0,this.earthControls=null,this.pathcontrols=c,this.elementRenderArea=null;var d=new b.Clock;this.init=function(a,c,d,e,f){this.earthControls=new b.EarthControls(a,c,d),this.earthControls.addEventListener("proposeTransform",function(){}),this.earthControls.pointclouds.push(e),this.enabled?this.pathcontrols.disable():this.pathcontrols.enable(),this.elementRenderArea=f,this.elementRenderArea.addEventListener("mousedown",this.mousedown.bind(this),!1)},this.update=function(){this.enabled&&this.earthControls.update(d.getDelta())},this.mousedown=function(){document.activeElement!==this.elementRenderArea&&this.elementRenderArea.focus()},a.subscribe("earthcontrols suspended",function(a,b){this.earthControls.enabled=!b}.bind(this)),a.subscribe("earthcontrols enabled",function(a,b){this.enabled=b,b?this.pathcontrols.disable():this.pathcontrols.enable(),this.earthControls.enabled=b}.bind(this))}a.$inject=["Messagebus","THREE","PathControls"],angular.module("pattyApp.earthcontrols").service("EarthcontrolsService",a)}(),angular.module("pattyApp.templates").run(["$templateCache",function(a){"use strict";a.put("scripts/biglegend/biglegend.directive.html",'<div class="interface-visible bigLegendContainer interface-clickthrough" ng-show="blc.PointcloudService.settings.pointColorType == 3">\n  <div ng-hide=\'blc.mobile\' class="bigLegendFlexContainer">\n    <!-- Positioned in css as: left column -->\n    <div class="bigLegendFlexSection">\n      <!-- Positioned in css as: left column elements equidistantly spaced vertically by flex -->\n      <form novalidate>\n        <input ng-model="blc.legendMax" type="number" class="bigLegendFormTextField interface-clickable" ng-model-options="{ updateOn: \'default\', debounce: { default: 10 } }" />\n      </form>\n    </div>\n    <div ng-repeat="text in blc.legendText track by $index" class="bigLegendFlexSection bigLegendFlexText">\n      {{text}}\n    </div>\n\n    <!-- This final element should be on the bottom of the legend, and is therefore not flexed (no div with css class) -->\n    <form novalidate>\n      <input ng-model="blc.legendMin" type="number" class="bigLegendFormTextField interface-clickable" ng-model-options="{ updateOn: \'default\', debounce: { default: 10 } }" />\n    </form>\n  </div>\n\n  <div ng-show=\'blc.mobile\' class="bigLegendFlexMobileContainer">\n    <div class="bigLegendFlexContainer">\n      <div class="bigLegendFlexSection bigLegendFlexText">{{blc.legendMax}}</div>\n      <div ng-repeat="text in blc.legendText track by $index" class="bigLegendFlexSection bigLegendFlexText">\n        {{text}}\n      </div>\n    </div>\n    <div class="bigLegendFlexText">{{blc.legendMin}}</div>\n  </div>\n\n  <div class="bigLegendImg">\n    <!-- Positioned in css as: right column -->\n    <canvas id="bigLegendCanvas"></canvas>\n  </div>\n\n  <div class="bigLegendUnits">\n    <!-- Positioned in css as: beneath both columns -->\n    {{blc.selectedUnits}}\n  </div>\n</div>\n'),a.put("scripts/earthcontrols/earthcontrols.directive.html",'<span class="controls-box">\r\n  <button class="giga-octicon octicon icon-big octicon-globe" ng-class="{active: earthcontrols.enabled}" ng-click="earthcontrols.toggleEarthcontrols()" title="Switch to Earth Controls"></button>\r\n  <button class="giga-octicon octicon icon-big octicon-keyboard" ng-class="{active: !earthcontrols.enabled}" ng-click="earthcontrols.toggleEarthcontrols()" title="Switch to Keyboard Controls"></button>\r\n</span>\r\n'),a.put("scripts/extract/extraction.directive.html",'<button class="icon-big extract-icon" ng-class="{active: ec.selection.active}" ng-click="ec.selection.active=!ec.selection.active" title="Extract points"></button>\r\n<div class="panel panel-default extract-panel" collapse=\'!ec.selection.active\'>\r\n  <div class="panel-heading">Extract points   &nbsp<span style="color:red;">(please note, while selection is active, camera controls are disabled)</span>\r\n    <button aria-label="Close" class="close" ng-click="ec.selection.active=!ec.selection.active">\r\n      <span aria-hidden="true">&times;</span>\r\n    </button>\r\n  </div>\r\n  <div class="panel-body">\r\n    <div class="extraction-text">\r\n      To select points, please click on the minimap, or drag to select in the 3d view.\r\n    </div>\r\n    <form class="form-inline" name="extractForm" role="search">\r\n      <div class="row">\r\n        <div class="col-xs-12 form-group">\r\n          <label for="email">Email</label>\r\n          <input class="form-control" name="email" ng-minlength="4" ng-model="ec.email" placeholder="" type="email">\r\n        </div>\r\n      </div>\r\n      <div class="row">\r\n        <div class="form-group col-xs-offset-3 col-xs-6">\r\n          <label for="top">Top</label>\r\n          <input class="form-control" name="top" ng-model-options="{ debounce: 1000 }" ng-model="ec.selection.top" placeholder="" required step=0.01 type="number">\r\n        </div>\r\n      </div>\r\n      <div class="row">\r\n        <div class="form-group col-xs-6">\r\n          <label for="left">Left</label>\r\n          <input class="form-control" name="left" ng-model-options="{ debounce: 1000 }" ng-model="ec.selection.left" placeholder="" required step=0.01 type="number">\r\n        </div>\r\n        <div class="form-group col-xs-6">\r\n          <label for="right">Right</label>\r\n          <input class="form-control" name="right" ng-model-options="{ debounce: 1000 }" ng-model="ec.selection.right" placeholder="" required step=0.01 type="number">\r\n        </div>\r\n      </div>\r\n      <div class="row">\r\n        <div class="form-group col-xs-offset-3 col-xs-6">\r\n          <label for="bottom">Bottom</label>\r\n          <input class="form-control" name="bottom" ng-model-options="{ debounce: 1000 }" ng-model="ec.selection.bottom" placeholder="" required step=0.01 type="number">\r\n        </div>\r\n      </div>\r\n      <button class="btn btn-default" ng-click="ec.count()" type="button">Count points</button>\r\n      <button class="btn btn-primary" ng-click="ec.submit()" ng-disabled="extractForm.$invalid" type="submit">Submit</button>\r\n      <div class="row">\r\n        <div class="col-xs-6">\r\n          Selected number of points:\r\n          <span>{{ec.size.rawPoints | number}}</span>\r\n        </div>\r\n        <div class="col-xs-6">\r\n          Coverage (%):\r\n          <span title="When not all points can be extracted, a percentage is returned">{{ec.size.coverage * 100 | number}}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </form>\r\n</div>\r\n</div>\r\n'),a.put("scripts/help/help.directive.html",'<button class="icon-big help-icon" ng-class="{active: hc.showHelp}" ng-click="hc.showHelp=!hc.showHelp" title="Help"></button>\r\n<div class="panel panel-default help-panel" collapse=\'!hc.showHelp\'>\r\n    <div class="panel-heading">Help</div>\r\n    <div class="panel-body">\r\n        <p>\r\n            Pointcloud visualization of the\r\n            <a href="http://www.ahn.nl/">Actuele Hoogtekaart Nederland (2)</a></br>\r\n            made by the <a href="http://www.esciencecenter.nl/">Netherlands eScience Center</a>.\r\n        </p>\r\n        <p>If you have comments or issues, please leave them at: <a href="https://github.com/NLeSC/ahn-pointcloud-viewer/issues">our issue tracker</a>.</p>\r\n        <p>This software is free and open source. Please refer to <a href="https://github.com/NLeSC/ahn-pointcloud-viewer">our github page</a> for more information.</p>\r\n\r\n        <h2>The Pointcloud viewer</h2>\r\n        <p>The viewer consists of several elements:</p>\r\n        <ul>\r\n            <li>Center, point cloud visualization</li>\r\n            <li>Top-left,\r\n                <a href="#search">search location</a>\r\n            </li>\r\n            <li>Top-right,\r\n                <a href="#minimap">minimap</a>\r\n            </li>\r\n            <li>Bottom-left,\r\n                <a href="#extract">extract points</a>,\r\n                <a href="#settings">settings</a>,\r\n                this help,\r\n                and <a href="#measure">measure</a>\r\n                </li>\r\n            <li>Bottom-middle,\r\n                two buttons to switch between interaction modes. As further explained in <a href="#navigation">Navigation</a>\r\n            </li>\r\n        </ul>\r\n\r\n        <h2 id="navigation">Navigation</h2>\r\n        <div>\r\n          <p>\r\n            <b><span class="octicon octicon-inverted octicon-globe"></span> Google Earth -like controls</b>\r\n              Use the left and right mouse buttons to move and rotate the camera. Zoom with the scroll wheel.\r\n          </p>\r\n          <p>\r\n            <b><span class="octicon octicon-inverted octicon-keyboard"></span> Keyboard interaction</b>\r\n              <ul>\r\n                  <li>Right click mouse, rotates camera</li>\r\n                  <li>a/s/d/w keys or arrow keys, to move left, backward, right or forward</li>\r\n                  <li>q/z keys, to move up or down</li>\r\n                  <li>Mouse scrollwheel, increases or decreases field of view</li>\r\n                  <li>Hold spacebar, to move faster</li>\r\n              </ul>\r\n          </p>\r\n        </div>\r\n\r\n        <h2 id="extract">\r\n            <span class="glyphicon glyphicon-download inverted-glyphicon"></span>\r\n            Extract points</h2>\r\n        <div>\r\n            Download the selected points as a laz-file. The download url will be mailed when it is ready. The selection of points can done in several ways:\r\n            <ol>\r\n                <li>By clicking 2 points in the minimap</li>\r\n                <li>By drawing a box in the 3D point cloud visualization. This currently only works for the "Keyboard interaction" navigation mode</li>\r\n                <li>Filling in coordinates into the form</li>\r\n            </ol>\r\n            The coordinates are in\r\n            <a href="http://epsg.io/28992">Amersfoort/RD new</a>\r\n            coordinate system. \r\n            Before submiting the job request you can also get an approximation of the number of points in your selected area. Coverage indicates the percentage of that data that you are allowed to download. There is a limit in the number of points that you can download. Depending on the extent of your selection you will download different resolutions of the point cloud. For small areas you can download the data up to its full resolution, i.e. 10 points/m2, but the larger the area the lower the density you get. \r\n            Getting the approximation of number of points can take a few seconds depending on the selected area and the server load, so be patient.\r\n        </div>\r\n\r\n        <h2 id="settings">\r\n            <div class="icon-inline gear-icon"></div>\r\n            Settings</h2>\r\n        <div>\r\n            Settings are grouped in tabs.\r\n            <h4>Point</h4>\r\n            Here you can configure the look and feel of points of the point cloud.\r\n            <h4>Measurement</h4>\r\n            Adjust how measurements are performed.\r\n            <h4>Demo</h4>\r\n            Pressing play will automatically move the camera along a set of predefined waypoints. The waypoints can be added, deleted, downloaded or uploaded.\r\n            <h4>Miscellaneous</h4>\r\n            For miscellaneous settings.\r\n        </div>\r\n\r\n        <h2 id="search">Search Location</h2>\r\n        <p>\r\n            Locate a landmark or adress by\r\n            <span class="glyphicon glyphicon-search inverted-glyphicon"></span>\r\n            (searching) for it. Or use the\r\n            <span class="glyphicon glyphicon-home inverted-glyphicon"></span>\r\n            to locate your location.\r\n        </p>\r\n\r\n        <h2 id="minimap">Minimap</h2>\r\n        <p>\r\n            Shows the location of camera and it\'s field of view as a white triangle. By default aerial photos are shown, change to road map using the layer switcher in the top right corner. Click\r\n            <span class="glyphicon glyphicon-resize-full"></span>\r\n            to enlarge minimap.\r\n        </p>\r\n\r\n        <h2 id="measure">Measurement</h2>\r\n        <div>\r\n            <div>\r\n                <div class="icon-inline toolbox-icon"></div>\r\n                Toolkit\r\n            </div>\r\n            Click to open measuring instruments\r\n        </div>\r\n        <div>\r\n            <div>\r\n                <div class="icon-inline distance-icon"></div>\r\n                Distance\r\n            </div>\r\n            Left Mouse: Insert Measurement Point Right Mouse: Finish insertion Drag&Drop: Move Measurement Points Distance between measurement points will be displayed on the edge.\r\n\r\n        </div>\r\n        <div>\r\n            <div>\r\n                <div class="icon-inline area-icon"></div>\r\n                Surface Area\r\n            </div>\r\n            Left Mouse: Insert Measurement Point Right Mouse: Finish insertion Drag&Drop: Move Measurement Points Distance between measurement points will be displayed on the edge and the total area on the centroid. The area is calculated on the ground plane. The height does not affect the result. Crossings should be avoided.\r\n        </div>\r\n        <div>\r\n            <div>\r\n                <div class="icon-inline volume-icon"></div>\r\n                Volume\r\n            </div>\r\n            Left Mouse: Insert Volume or Select Inserted Volume Switch between translation (icon), scale (icon) and rotation (icon) mode Keyboard shortcut: T, E, R Volume will be displayed on the objects centroid.\r\n        </div>\r\n        <div>\r\n            <div>\r\n                <div class="icon-inline heightprofile-icon"></div>\r\n                Height Profile\r\n            </div>\r\n            Left Mouse: Insert Profile Marker Right Mouse: Finish insertion Drag&amp;Drop: Move Profile Marker ctrl + Drag&amp;Drop: Drag upwards to increase or downwards to decrease the profile width Depending on the Clip Mode, points inside the profile will be highlighted or points outside the profile will be clipped.\r\n        </div>\r\n        <div>\r\n            <div>\r\n                <div class="icon-inline clipvolume-icon"></div>\r\n                Clip Volume\r\n            </div>\r\n            Left Mouse: Insert Volume or Select Inserted Volume Switch between translation (icon), scale (icon) and rotation (icon) mode Keyboard shortcut: T, E, R\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>\r\n'),a.put("scripts/logos/logos.directive.html",'<div class="logobox">\n  <a href="http://www.ahn.nl">\n    <img src="images/logos/ahn_inv.png" title="Actueel Hoogtebestand Nederland" width="150"/>\n  </a>\n  <a href="http://www.esciencecenter.nl">\n    <img src="images/logos/nlesc_inv.png" title="Netherlands eScience Center" width="150"/>\n  </a>\n  <a href="http://www.tudelft.nl">\n    <img src="images/logos/tudelft_inv.png" title="TU Delft" width="120" style="position: relative; bottom: -5px;">\n  </a>\n  <a href="http://www.potree.org">\n    <img src="images/logos/potree_logo.png" title="potree" width="150"/>\n  </a>\n</div>\n'),a.put("scripts/measuring/measuring.directive.html",'<div class="toolbox">\r\n  <button ng-click="measuring.toggleToolbox()" class="icon-big toolbox-icon" ng-class="{active: measuring.showToolboxTray}"></button>\r\n</div>\r\n\r\n<div class="toolbox-tray tool-icon" collapse=\'!measuring.showToolboxTray\'>\r\n  <button ng-click="measuring.toggleToolbox()" class="icon-big toolbox-tray-top-icon"></button>\r\n  <div class="toolbox-tools">\r\n    <button ng-click="measuring.startDistance()" ng-class="{active: measuring.distanceActive}" class="icon-small distance-icon" title="Start distance measurement"></button>\r\n    <button ng-click="measuring.startAngle()" ng-class="{active: measuring.angleActive}" class="icon-small angle-icon" title="Start angle measurement"></button>\r\n    <button ng-click="measuring.startArea()" ng-class="{active: measuring.areaActive}" class="icon-small area-icon" title="Start area measurement"></button>\r\n    <button ng-click="measuring.startVolume()" ng-class="{active: measuring.volumeActive}" class="icon-small volume-icon" title="Start volume measurement"></button>\r\n    <button ng-click="measuring.startHeightProfile()" ng-class="{active: measuring.heightProfileActive}" class="icon-small heightprofile-icon" title="Start heightprofile measurement"></button>\r\n    <button ng-click="measuring.startClipVolume()" ng-class="{active: measuring.clipVolumeActive}" class="icon-small clipvolume-icon" title="Start clip volume measurement"></button>\r\n  </div>\r\n</div>\r\n\r\n<div class="transformation-toolbox-tray" collapse=\'!measuring.showTransformationToolboxTray\'>\r\n  <button ng-click="measuring.toggleRotate()" ng-class="{active: measuring.isTransformationRotate()}" class="icon-tiny rotate-icon" title="Change the rotation of the selected area (\'R\' key)"></button>\r\n  <button ng-click="measuring.toggleTranslate()" ng-class="{active: measuring.isTransformationTranslate()}" class="icon-tiny translate-icon" title="Change the translation of the selected area (\'T\' key)"></button>\r\n  <button ng-click="measuring.toggleScale()" ng-class="{active: measuring.isTransformationScale()}" class="icon-tiny scale-icon" title="Change the scale of the selected area (\'E\' key)"></button>\r\n</div>\r\n'),a.put("scripts/pointcloud/pointcloud-stats.directive.html","<div ng-show='pcs.PointcloudService.settings.showStats'>\n<div>Visible points: {{ pcs.stats.nrPoints }}</div>\n<div>Visible nodes: {{ pcs.stats.nrNodes }}</div>\n<div>3D Scene coordinates (x/y/z): {{ pcs.stats.sceneCoordinates.x }}/{{ pcs.stats.sceneCoordinates.y }}/{{ pcs.stats.sceneCoordinates.z }}</div>\n<div>{{ pcs.stats.lasCoordinates.crs }} coordinates (x/y/z): {{ pcs.stats.lasCoordinates.x }}/{{ pcs.stats.lasCoordinates.y }}/{{ pcs.stats.lasCoordinates.z }}</div>\n</div>\n"),a.put("scripts/searchbox/searchbox.directive.html",'<div class="form-group clickable">\r\n    <div class="input-group">\r\n        <input type="search" class="form-control" placeholder="Search location..." ng-model="sp.query" ng-keypress="sp.onQueryKeyPress($event)">\r\n        <span class="input-group-btn">\r\n          <button class="btn btn-default" type="button" ng-click="sp.clear()" ng-show="sp.query" title="Clear"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>\r\n          <button class="btn btn-default" type="button" ng-click="sp.search()" ng-disabled="!sp.query" title="Search"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>\r\n          <button class="btn btn-default" type="button" ng-click="sp.gotoCurrentLocation()" ng-show="sp.hasGeoLocation" title="Current location"><span class="glyphicon glyphicon-home" aria-hidden="true"></span></button>\r\n        </span>\r\n    </div>\r\n</div>\r\n'),a.put("scripts/settings/settings.directive.html",'<button class="icon-big gear-icon" ng-class="{sd:sc.sd, md:sc.md, hd:sc.hd, active: sc.showSettings}" ng-click="sc.showSettings=!sc.showSettings" title="Settings"/>\n<div class="panel panel-default settings-panel" collapse=\'!sc.showSettings\'>\n  <div class="panel-heading">\n    Settings</div>\n  <div class="panel-body">\n    <tabset>\n      <tab heading="Point">\n        <form class="form-horizontal">\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="pointCountTarget">\n              Points(m)\n            </label>\n            <div class="col-sm-8">\n              <input class="form-control" id="pointCountTarget" max="10.0" min="0.1" ng-model="sc.PointcloudService.settings.pointCountTarget" step="0.1" type="number"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="pointSize">\n              PointSize\n            </label>\n            <div class="col-sm-8">\n              <input class="form-control" id="pointSize" max="3.0" min="0.01" ng-model="sc.PointcloudService.settings.pointSize" step="0.01" type="number"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="pointColorType">\n              Color type\n            </label>\n            <div class="col-sm-8">\n              <select class="form-control" id="pointColorType" ng-model="sc.PointcloudService.settings.pointColorType" ng-options="value as key|lowercase for (key, value) in sc.PointcloudService.settings.pointColorTypes | orderBy:value"/>\n            </div>\n          </div>\n\n        <div class="form-group">\n          <label class="col-sm-4 control-label" for="predefinedSettings">\n            Quality\n          </label>\n          <div class="col-sm-8">\n            <select class="form-control" id="predefinedSettings" ng-model="sc.PointcloudService.settings" ng-change="sc.settingsChanged(value)" ng-options="value as key for (key, value) in sc.PointcloudService.predefinedSettings" ng-init="sc.PointcloudService.settings=sc.PointcloudService.predefinedSettings.LOW"/>\n          </div>\n        </div>\n        </form>\n      </tab>\n      <tab heading="Measurement">\n        <form class="form-horizontal">\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="clipMode">\n              Clip mode\n            </label>\n            <div class="col-sm-8">\n              <select class="form-control" id="clipMode" ng-model="sc.PointcloudService.settings.clipMode" ng-options="value as key|lowercase for (key, value) in sc.PointcloudService.settings.clipModes | orderBy:value"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-4 control-label" for="profileWidth">Profile width\n            </label>\n            <div class="col-sm-8">\n              <input class="form-control" id="profileWidth" max="50" min="0.1" ng-model="sc.measure.profileWidth" step="0.1" type="number"/>\n            </div>\n          </div>\n        </form>\n      </tab>\n      <tab heading="Demo">\n        <form class="form-horizontal demo">\n          <div class="form-group">\n            <label class="col-sm-3 control-label">\n              Play\n            </label>\n            <div class="col-sm-7">\n              <button ng-disabled="sc.PathControls.mode == sc.PathControls.modes.DEMO" class="btn btn-default glyphicon glyphicon-play" ng-click="sc.PathControls.enableDemoMode()" title="Play demo"/>\n              <button ng-disabled="sc.PathControls.mode != sc.PathControls.modes.DEMO" class="btn btn-default glyphicon glyphicon-stop" ng-click="sc.PathControls.enableFlightMode()" title="Stop demo"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-3 control-label" for="show-demo-path">\n              Show</label>\n            <div class="col-sm-9">\n              <input id="show-demo-path" ng-model="sc.RailService.scene.visible" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-3 control-label">\n              Edit\n            </label>\n            <div class="col-sm-9">\n              <button class="btn btn-default glyphicon glyphicon-plus" ng-click="sc.RailService.addCameraLocation()" title="Add current camera location"/>\n              <button class="btn btn-default glyphicon glyphicon-minus" ng-click="sc.RailService.removeLast()" title="Remove last location"/>\n              <button class="btn btn-default glyphicon glyphicon-trash" ng-click="sc.RailService.clear()" title="Clear"/>\n              <a class="btn btn-default" role="button" title="Download" download="demo-waypoints.json" draggable="true" data-downloadurl="demo-waypoints.json" target="_blank" ng-href="{{sc.RailService.dataUrl}}"><span class="glyphicon glyphicon-download"></span><a/>\n              <button ngf-select class="btn btn-default glyphicon glyphicon-upload" title="Upload" ngf-change="sc.RailService.upload($files, $event)"/>\n            </div>\n          </div>\n        <div class="form-group">\n          <label class="col-sm-3 control-label" for="look-at-distance">\n            Look at distance</label>\n          <div class="col-sm-9">\n            <input id="look-at-distance" ng-model="sc.RailService.lookatDistance" type="number">\n          </div>\n        </div>\n      <div class="form-group">\n        <label class="col-sm-3 control-label" for="camera-easing" title="How fast the camera rotates to the next location">\n          Camera easing</label>\n        <div class="col-sm-9">\n          <input id="camera-easing" ng-model="sc.PathControls.cameraEasing" type="number">\n        </div>\n      </div>\n        </form>\n      </tab>\n      <tab heading="Misc">\n        <form class="form-horizontal misc">\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="showSkybox">Sky box\n            </label>\n            <div class="col-sm-4">\n              <input id="showSkybox" ng-model="sc.PointcloudService.settings.showSkybox" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="showStats">\n              Show statistics\n            </label>\n            <div class="col-sm-4">\n              <input id="showStats" ng-model="sc.PointcloudService.settings.showStats" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="showBoundingBox" title="Show bounding box of pointcloud octree nodes">\n              Bounding boxes\n            </label>\n            <div class="col-sm-4">\n              <input id="showBoundingBox" ng-model="sc.PointcloudService.settings.showBoundingBox" type="checkbox">\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="normalSpeedMultiplier">\n              Normal Movement Speed multipier\n            </label>\n            <div class="col-sm-4">\n              <input class="form-control" id="normalSpeedMultiplier" ng-model="sc.PathControls.NORMAL_MOVEMENT_SPEED_MULTIPLIER" type="number"/>\n            </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-8 control-label" for="fastSpeedMultiplier">\n              Fast Movement Speed multipier\n            </label>\n            <div class="col-sm-4">\n              <input class="form-control" id="fastSpeedMultiplier" ng-model="sc.PathControls.FAST_MOVEMENT_SPEED_MULTIPLIER" type="number"/>\n            </div>\n          </div>\n        </form>\n      </tab>\n    </tabs>\n  </div>\n</div>\n');

}]);